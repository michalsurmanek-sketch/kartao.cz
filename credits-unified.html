<!DOCTYPE html>
<html lang="cs">
<head>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao.cz – Kreditní systém</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
            emerald: tailwind.colors.emerald,
            sky: tailwind.colors.sky,
            rose: tailwind.colors.rose
          },
          boxShadow: {
            soft: "0 18px 45px rgba(15,23,42,0.85)"
          }
        }
      }
    };
  </script>

  <!-- Ikony -->
  <!-- Lucide ikony - unified system -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-neutral-950 via-neutral-950 to-neutral-900 text-white">
  <!-- HLAVIČKA -->
  <header class="sticky top-0 z-30 border-b border-white/10 bg-neutral-950/80 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <a href="#" class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center shadow-soft">
          <i data-lucide="crown" class="w-5 h-5"></i>
        </div>
        <div>
          <div class="flex items-center gap-2">
            <span class="font-semibold text-lg">Kartao.cz</span>
            <span class="px-2 py-0.5 rounded-full text-xs bg-emerald-500/15 text-emerald-300 border border-emerald-400/40">Kreditní zóna</span>
          </div>
          <p class="text-xs text-white/60">K-Coins · gamifikace pro tvůrce</p>
        </div>
      </a>
      <div class="flex items-center gap-3">
        <div class="hidden sm:flex flex-col items-end text-xs">
          <span class="text-white/60">Tvoje současné kredity</span>
          <span class="font-semibold text-amber-300 text-sm"><span id="creditsValue">2350</span> K-Coins</span>
        </div>
        <button class="inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 rounded-full bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-medium shadow-soft">
          <i data-lucide="shopping-bag" class="w-4 h-4"></i>
          <span>Dobít kredity</span>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8 space-y-8">
    <!-- HERO -->
    <section class="rounded-3xl border border-white/10 bg-neutral-950/80 p-6 shadow-soft text-center">
      <h1 class="text-3xl font-semibold mb-2">Kreditní systém <span class="text-amber-300">K-Coins</span></h1>
      <p class="text-white/70 max-w-xl mx-auto mb-6">Plň úkoly, dokončuj kampaně a získávej kredity. Za kredity můžeš kupovat VIP, zvýraznění profilu, mystery boxy a další bonusy.</p>

      <div class="grid sm:grid-cols-3 gap-4 max-w-3xl mx-auto">
        <div class="rounded-2xl bg-white/5 border border-white/10 p-4">
          <p class="text-xs text-white/60">Kredity</p>
          <p class="text-2xl font-semibold text-amber-300">
            <span id="creditsValueHero">2 350</span>
          </p>
        </div>
        <div class="rounded-2xl bg-white/5 border border-white/10 p-4">
          <p class="text-xs text-white/60">Streak</p>
          <p class="text-2xl font-semibold text-emerald-300">12 dní</p>
        </div>
        <div class="rounded-2xl bg-white/5 border border-white/10 p-4">
          <p class="text-xs text-white/60">Level</p>
          <p class="text-2xl font-semibold text-fuchsia-300">18</p>
        </div>
      </div>
    </section>

    <!-- REKLAMNÍ ODMĚNY -->
    <section class="rounded-3xl border border-amber-400/30 bg-amber-500/5 p-6 shadow-soft">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
        <i data-lucide="play" class="w-5 h-5 text-amber-300"></i>
        Reklamní odměny
      </h2>

      <p class="text-white/70 text-sm mb-4 max-w-2xl">
        Sleduj krátké reklamy (cca 10 sekund) a získej okamžité kredity. Každá reklama dává
        <span class="text-amber-300 font-semibold">+4 K-Coins</span>. Limit je 5 reklam denně (max. 20 K-Coins).
      </p>

      <div class="rounded-2xl bg-white/5 border border-white/10 p-4 flex items-center justify-between gap-4 flex-col sm:flex-row">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center">
            <i data-lucide="play-circle" class="w-6 h-6 text-amber-300"></i>
          </div>
          <div>
            <p class="font-medium text-sm">Sleduj reklamu a získej kredity</p>
            <p class="text-xs text-white/60">Limit: 5 reklam denně · 20 K-Coins maximálně</p>
          </div>
        </div>
        <button id="watchAdButton" class="px-4 py-2 rounded-xl bg-gradient-to-r from-amber-400 to-fuchsia-500 font-semibold text-neutral-900 text-sm shadow-soft w-full sm:w-auto">
          Spustit reklamu
        </button>
      </div>

      <div id="adStatus" class="mt-4 text-xs text-white/70 flex items-center justify-between gap-3 flex-col sm:flex-row">
        <span id="adMessage">Připraveno ke spuštění reklamy.</span>
        <span id="adCounter" class="text-amber-300">Dnes: 0 / 5</span>
      </div>

      <div class="mt-2 flex justify-end">
        <button id="resetAdsButton" class="text-[11px] text-white/40 hover:text-white underline underline-offset-2">
          Resetovat denní limit (test)
        </button>
      </div>

      <!-- OVERLAY S VIDEEM -->
      <div id="adOverlay" class="fixed inset-0 z-50 bg-neutral-950/95 backdrop-blur-sm flex flex-col items-center justify-center p-4 gap-4 hidden">
        <div class="w-full max-w-5xl">
          <div class="relative w-full rounded-2xl overflow-hidden bg-black shadow-soft border border-white/10">
            <video id="adVideo" class="w-full h-auto max-h-[90vh] object-contain" muted playsinline>
              <source id="adSrc" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4" />
            </video>

            <!-- Odpočet -->
            <div class="absolute top-4 right-4 flex items-center gap-2 px-3 py-2 rounded-full bg-neutral-950/80 border border-amber-300/70 shadow-soft text-xs">
              <div class="w-5 h-5 rounded-full border-2 border-amber-300 border-t-transparent animate-spin"></div>
              <div class="text-right">
                <p class="font-medium text-white/90">Reklama běží…</p>
                <p class="text-[11px] text-white/70"><span id="adCountdown">10</span></p>
              </div>
            </div>

            <!-- Další / Zavřít -->
            <button id="nextAdButton" class="hidden absolute bottom-4 right-4 flex items-center gap-2 px-3 py-2 rounded-full bg-neutral-950/80 border border-amber-300/70 shadow-soft text-xs text-amber-300 font-medium">
              <i data-lucide="skip-forward" class="w-4 h-4 text-amber-300"></i>
              <span>Další reklama</span>
            </button>
          </div>
        </div>

        <!-- OVLÁDACÍ PANEL VIDEA -->
        <div id="adControlPanel" class="flex items-center gap-3 mt-2">
          <button id="adMuteToggle" class="px-3 py-1.5 rounded-full bg-white/10 border border-white/20 text-xs text-white flex items-center gap-1">
            <i data-lucide="volume-2" class="w-4 h-4"></i>
            Zvuk
          </button>
          <button id="adPauseToggle" class="px-3 py-1.5 rounded-full bg-white/10 border border-white/20 text-xs text-white flex items-center gap-1">
            <i data-lucide="pause" class="w-4 h-4"></i>
            Zastavit
          </button>
          <button id="adCloseButton" class="px-3 py-1.5 rounded-full bg-red-500/80 text-neutral-900 text-xs flex items-center gap-1">
            <i data-lucide="x" class="w-4 h-4"></i>
            Zavřít
          </button>
        </div>
      </div>
    </section>

    <!-- DENNÍ ÚKOLY -->
    <section id="dailyTasksSection" class="rounded-3xl border border-white/10 bg-neutral-950/80 p-6 shadow-soft">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="list-checks" class="w-5 h-5 text-amber-300"></i> Denní úkoly</h2>
      <ul class="space-y-3 text-sm">
        <!-- Přihlášení – vždy splněno, protože bez loginu se sem nedostane -->
        <li class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
          <span>Přihlas se dnes</span>
          <span class="text-emerald-300 text-xs flex items-center gap-1">
            +2 <i data-lucide="coins" class="w-3 h-3"></i>
            <span class="text-emerald-300 text-[11px] font-medium ml-2">Splněno ✓</span>
          </span>
        </li>

        <!-- Aktualizuj statistiky -->
        <li id="taskStats" class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer">
          <span>Aktualizuj statistiky</span>
          <span id="taskStatsBadge" class="text-red-400 text-xs flex items-center gap-1">
            +5 <i data-lucide="coins" class="w-3 h-3"></i>
          </span>
        </li>

        <!-- Odpověz na kampaň -->
        <li id="taskCampaign" class="p-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer">
          <div class="flex items-center justify-between gap-2">
            <span>Odpověz na kampaň</span>
            <span id="taskCampaignBadge" class="text-red-400 text-xs flex items-center gap-1">
              +6 <i data-lucide="coins" class="w-3 h-3"></i>
            </span>
          </div>
          <!-- Rozbalená nabídka dvou kampaní -->
          <div id="campaignList" class="mt-3 hidden w-full text-xs text-white/80 space-y-2">
            <div class="rounded-xl border border-white/10 bg-white/5 p-3 flex items-start justify-between gap-3">
              <div>
                <p class="font-semibold text-sm">Kampaň #1 – Produktová spolupráce</p>
                <p class="text-[11px] text-white/60">Story + 1 feed post · rozpočet 3 000 Kč</p>
              </div>
              <button class="campaign-respond px-3 py-1.5 rounded-full bg-emerald-500/90 text-neutral-900 text-[11px] font-semibold">
                Odpovědět
              </button>
            </div>
            <div class="rounded-xl border border-white/10 bg-white/5 p-3 flex items-start justify-between gap-3">
              <div>
                <p class="font-semibold text-sm">Kampaň #2 – Uvedení nového e‑shopu</p>
                <p class="text-[11px] text-white/60">Reels + swipe up · barter + odměna</p>
              </div>
              <button class="campaign-respond px-3 py-1.5 rounded-full bg-emerald-500/90 text-neutral-900 text-[11px] font-semibold">
                Odpovědět
              </button>
            </div>
          </div>
        </li>

        <!-- Sleduj krátkou reklamu -->
        <li id="taskWatchAd" class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
          <span class="flex items-center gap-2">
            <i data-lucide="play-circle" class="w-4 h-4 text-amber-300"></i>
            <span>Sleduj krátkou reklamu (10 s)</span>
          </span>
          <span id="taskWatchAdBadge" class="text-red-400 text-xs flex flex-col items-end gap-0.5">
            <span class="inline-flex items-center gap-1">+4 <i data-lucide="coins" class="w-3 h-3"></i></span>
            <span class="text-[10px] text-white/60">Max. 5× denně</span>
            <span id="taskWatchAdDone" class="hidden text-[11px] font-medium mt-0.5">Splněno ✓</span>
          </span>
        </li>
      </ul>
    </section>

    <!-- ODMĚNY ZA KREDITY -->
    <section class="rounded-3xl border border-white/10 bg-neutral-950/80 p-6 shadow-soft">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="gift" class="w-5 h-5 text-fuchsia-300"></i> Odměny za kredity</h2>
      <div class="grid sm:grid-cols-2 gap-4">
        <div class="rounded-xl border border-amber-400/40 bg-amber-500/10 p-4 text-sm">
          <p class="font-semibold mb-1">Zvýraznění karty</p>
          <p class="text-xs text-white/70 mb-2">24 hodin top pozice v Marketplace.</p>
          <span class="inline-flex items-center gap-1 bg-neutral-950/40 px-2 py-1 rounded-full text-amber-300 text-xs">40 <i data-lucide="coins" class="w-3 h-3"></i></span>
        </div>
        <div class="rounded-xl border border-fuchsia-400/40 bg-fuchsia-500/10 p-4 text-sm">
          <p class="font-semibold mb-1">VIP profil 7 dní</p>
          <p class="text-xs text-white/70 mb-2">Lepší pozice & VIP styl.</p>
          <span class="inline-flex items-center gap-1 bg-neutral-950/40 px-2 py-1 rounded-full text-fuchsia-300 text-xs">300 <i data-lucide="coins" class="w-3 h-3"></i></span>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t border-white/10 text-center text-white/50 py-4 text-xs">
    © 2025 Kartao.cz – Kreditní systém K-Coins
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (window.lucide) {
        window.lucide.createIcons();
      }

      // Klíče pro localStorage
      var maxAdsPerDay = 5;
      var rewardPerAd = 4;
      var adStateKey = "kartao_ad_state";
      var creditsKey = "kartao_credits_total";
      var tasksStateKey = "kartao_tasks_state";

      // DOM prvky
      var watchAdButton = document.getElementById("watchAdButton");
      var adOverlay = document.getElementById("adOverlay");
      var adCountdownSpan = document.getElementById("adCountdown");
      var adMessage = document.getElementById("adMessage");
      var adCounter = document.getElementById("adCounter");
      var creditsValueEl = document.getElementById("creditsValue");
      var creditsValueHeroEl = document.getElementById("creditsValueHero");
      var adVideo = document.getElementById("adVideo");
      var adSrc = document.getElementById("adSrc");
      var nextAdButton = document.getElementById("nextAdButton");
      var resetButton = document.getElementById("resetAdsButton");

      var adCloseButton = document.getElementById("adCloseButton");
      var adPauseToggle = document.getElementById("adPauseToggle");
      var adMuteToggle = document.getElementById("adMuteToggle");

      var taskStatsItem = document.getElementById("taskStats");
      var taskStatsBadge = document.getElementById("taskStatsBadge");
      var taskCampaignItem = document.getElementById("taskCampaign");
      var taskCampaignBadge = document.getElementById("taskCampaignBadge");
      var campaignList = document.getElementById("campaignList");
      var taskWatchAdBadge = document.getElementById("taskWatchAdBadge");
      var taskWatchAdDone = document.getElementById("taskWatchAdDone");
      var campaignRespondButtons = document.querySelectorAll(".campaign-respond");
      var dailyTasksSection = document.getElementById("dailyTasksSection");

      // Stavové proměnné
      var adTimer = null;
      var adInProgress = false;

      // Pomocná funkce na formátování čísel (mezery po tisících)
      function formatNumber(num) {
        var s = String(num);
        var out = "";
        var count = 0;
        for (var i = s.length - 1; i >= 0; i--) {
          out = s[i] + out;
          count++;
          if (count === 3 && i > 0) {
            out = " " + out;
            count = 0;
          }
        }
        return out;
      }

      // KREDITY – načtení + uložení
      var credits = 0;
      try {
        var storedCredits = localStorage.getItem(creditsKey);
        if (storedCredits !== null) {
          credits = parseInt(storedCredits, 10) || 0;
        }
      } catch (e) {}

      if (!credits && creditsValueEl) {
        var base = creditsValueEl.textContent.replace(/[^0-9]/g, "");
        credits = parseInt(base, 10) || 0;
      }

      function syncCreditsDisplay() {
        var formatted = formatNumber(credits);
        if (creditsValueEl) creditsValueEl.textContent = formatted;
        if (creditsValueHeroEl) creditsValueHeroEl.textContent = formatted;
      }

      function saveCredits() {
        try {
          localStorage.setItem(creditsKey, String(credits));
        } catch (e) {}
      }

      syncCreditsDisplay();

      // Datum jako YYYY-MM-DD
      function todayStr() {
        var d = new Date();
        var m = String(d.getMonth() + 1);
        var day = String(d.getDate());
        if (m.length < 2) m = "0" + m;
        if (day.length < 2) day = "0" + day;
        return d.getFullYear() + "-" + m + "-" + day;
      }

      // Reklamy – stav (s verzováním)
      function loadAdState() {
        try {
          var raw = localStorage.getItem(adStateKey);
          if (!raw) return { date: todayStr(), adsWatchedToday: 0, v: 1 };
          var parsed = JSON.parse(raw);
          if (!parsed.date || parsed.date !== todayStr() || parsed.v !== 1) {
            return { date: todayStr(), adsWatchedToday: 0, v: 1 };
          }
          if (typeof parsed.adsWatchedToday !== "number") {
            parsed.adsWatchedToday = 0;
          }
          return parsed;
        } catch (e) {
          return { date: todayStr(), adsWatchedToday: 0, v: 1 };
        }
      }

      function saveAdState(state) {
        try {
          state.v = 1;
          localStorage.setItem(adStateKey, JSON.stringify(state));
        } catch (e) {}
      }

      var adState = loadAdState();

      // Úkoly – stav (s verzováním)
      function loadTasksState() {
        try {
          var raw = localStorage.getItem(tasksStateKey);
          if (!raw) return { date: todayStr(), statsDone: false, campaignDone: false, v: 1 };
          var parsed = JSON.parse(raw);
          if (!parsed.date || parsed.date !== todayStr() || parsed.v !== 1) {
            return { date: todayStr(), statsDone: false, campaignDone: false, v: 1 };
          }
          return {
            date: parsed.date,
            statsDone: !!parsed.statsDone,
            campaignDone: !!parsed.campaignDone,
            v: 1
          };
        } catch (e) {
          return { date: todayStr(), statsDone: false, campaignDone: false, v: 1 };
        }
      }

      var tasksState = loadTasksState();

      function saveTasksState() {
        try {
          if (!tasksState.date) tasksState.date = todayStr();
          tasksState.v = 1;
          localStorage.setItem(tasksStateKey, JSON.stringify(tasksState));
        } catch (e) {}
      }

      // Barvy a "Splněno" pro badge
      function setTaskBadgeState(badgeEl, done) {
        if (!badgeEl) return;
        badgeEl.classList.remove("text-red-400", "text-emerald-300");
        var doneLabel = badgeEl.querySelector(".task-done-label");
        if (done) {
          badgeEl.classList.add("text-emerald-300");
          if (!doneLabel) {
            var label = document.createElement("span");
            label.className = "task-done-label text-emerald-300 text-[11px] font-medium ml-2";
            label.textContent = "Splněno ✓";
            badgeEl.appendChild(label);
          }
        } else {
          badgeEl.classList.add("text-red-400");
          if (doneLabel) doneLabel.remove();
        }
      }

      function applyTasksState() {
        setTaskBadgeState(taskStatsBadge, tasksState.statsDone);
        setTaskBadgeState(taskCampaignBadge, tasksState.campaignDone);
      }

      // Update UI podle stavu reklam
      function updateUIFromState() {
        if (adCounter) {
          adCounter.textContent = "Dnes: " + adState.adsWatchedToday + " / " + maxAdsPerDay;
        }
        if (watchAdButton) {
          var reachedLimit = adState.adsWatchedToday >= maxAdsPerDay;
          watchAdButton.disabled = reachedLimit || adInProgress;
          watchAdButton.classList.toggle("opacity-60", watchAdButton.disabled);
          watchAdButton.classList.toggle("cursor-not-allowed", watchAdButton.disabled);
        }
        // Denní úkol "Sleduj reklamu" – červená / zelená + Splněno
        if (taskWatchAdBadge && taskWatchAdDone) {
          taskWatchAdBadge.classList.remove("text-red-400", "text-emerald-300");
          if (adState.adsWatchedToday >= maxAdsPerDay) {
            taskWatchAdBadge.classList.add("text-emerald-300");
            taskWatchAdDone.classList.remove("hidden");
          } else {
            taskWatchAdBadge.classList.add("text-red-400");
            taskWatchAdDone.classList.add("hidden");
          }
        }
      }

      function scrollToDailyTasks() {
        if (dailyTasksSection) {
          dailyTasksSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }

      applyTasksState();
      updateUIFromState();

      // Seznam videí pro reklamy
      var videos = [
        "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
        "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
        "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
        "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4",
        "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4"
      ];

      if (adVideo) {
        adVideo.addEventListener("ended", function () {
          try {
            adVideo.pause();
          } catch (e) {}
        });
      }

      if (resetButton) {
        resetButton.addEventListener("click", function () {
          localStorage.removeItem(adStateKey);
          adState = { date: todayStr(), adsWatchedToday: 0, v: 1 };
          if (adMessage) adMessage.textContent = "Denní limit byl resetován (test).";
          updateUIFromState();
        });
      }

      // Spuštění reklamy
      function startAd() {
        if (!watchAdButton || !adOverlay || !adCountdownSpan) return;
        if (adState.adsWatchedToday >= maxAdsPerDay || adInProgress) return;

        adInProgress = true;
        var remaining = 10;
        adCountdownSpan.textContent = String(remaining);
        adOverlay.classList.remove("hidden");
        if (nextAdButton) nextAdButton.classList.add("hidden");
        if (adMessage) adMessage.textContent = "Reklama běží…";

        if (adVideo && adSrc) {
          try {
            var index = adState.adsWatchedToday % videos.length;
            adSrc.src = videos[index];
            adVideo.load();
            adVideo.currentTime = 0;
            var playPromise = adVideo.play();
            if (playPromise && playPromise.catch) playPromise.catch(function () {});
          } catch (e) {}
        }

        updateUIFromState();

        if (adTimer) {
          window.clearInterval(adTimer);
        }

        adTimer = window.setInterval(function () {
          remaining -= 1;

          if (remaining <= 0) {
            window.clearInterval(adTimer);
            adTimer = null;
            adInProgress = false;

            adState.adsWatchedToday = Math.min(maxAdsPerDay, adState.adsWatchedToday + 1);
            saveAdState(adState);

            if (adCountdownSpan) {
              adCountdownSpan.innerHTML = "<span style='color:#4ade80;font-weight:600'>připsáno&nbsp;+4&nbsp;K-Coins</span>";
            }

            credits += rewardPerAd;
            syncCreditsDisplay();
            saveCredits();

            if (nextAdButton) {
              if (adState.adsWatchedToday < maxAdsPerDay) {
                nextAdButton.innerHTML = "<i data-lucide='skip-forward' class='w-4 h-4 text-amber-300'></i><span>Další reklama</span>";
              } else {
                nextAdButton.innerHTML = "<i data-lucide='x' class='w-4 h-4 text-amber-300'></i><span>Zavřít</span>";
              }
              nextAdButton.classList.remove("hidden");
              if (window.lucide) window.lucide.createIcons();
            }

            if (adMessage) adMessage.textContent = "Reklama dokončena. Kredity připsány.";

            updateUIFromState();
          } else {
            if (adCountdownSpan) adCountdownSpan.textContent = String(remaining);
          }
        }, 1000);
      }

      // Zrušení reklamy
      function cancelAd() {
        if (adTimer) {
          window.clearInterval(adTimer);
          adTimer = null;
        }
        adInProgress = false;
        if (adOverlay) adOverlay.classList.add("hidden");
        if (adVideo) {
          try {
            adVideo.pause();
            adVideo.currentTime = 0;
          } catch (e) {}
        }
        if (adMessage) adMessage.textContent = "Reklama zrušena. Kredity nebyly připsány.";
        updateUIFromState();
      }

      // Klik na "Spustit reklamu"
      if (watchAdButton) {
        watchAdButton.addEventListener("click", function () {
          adState = loadAdState();
          if (adState.adsWatchedToday >= maxAdsPerDay) {
            if (adMessage) adMessage.textContent = "Dnešní limit sledování reklam je vyčerpán.";
            updateUIFromState();
            scrollToDailyTasks();
            return;
          }
          startAd();
        });
      }

      // Ovládací panel videa
      if (adCloseButton) {
        adCloseButton.addEventListener("click", function () {
          cancelAd();
        });
      }

      if (adPauseToggle && adVideo) {
        adPauseToggle.addEventListener("click", function () {
          if (adVideo.paused) {
            adVideo.play();
            adPauseToggle.innerHTML = "<i data-lucide='pause' class='w-4 h-4'></i> Zastavit";
          } else {
            adVideo.pause();
            adPauseToggle.innerHTML = "<i data-lucide='play' class='w-4 h-4'></i> Pokračovat";
          }
          if (window.lucide) window.lucide.createIcons();
        });
      }

      if (adMuteToggle && adVideo) {
        adMuteToggle.addEventListener("click", function () {
          adVideo.muted = !adVideo.muted;
          adMuteToggle.innerHTML = adVideo.muted
            ? "<i data-lucide='volume-x' class='w-4 h-4'></i> Zvuk"
            : "<i data-lucide='volume-2' class='w-4 h-4'></i> Zvuk";
          if (window.lucide) window.lucide.createIcons();
        });
      }

      if (nextAdButton) {
        nextAdButton.addEventListener("click", function () {
          adState = loadAdState();

          if (adState.adsWatchedToday >= maxAdsPerDay) {
            if (adOverlay) adOverlay.classList.add("hidden");
            if (adVideo) {
              try {
                adVideo.pause();
                adVideo.currentTime = 0;
              } catch (e) {}
            }
            adInProgress = false;
            if (adMessage) adMessage.textContent = "Dnešní limit reklam je splněn. Kredity máš připsané.";
            updateUIFromState();
            scrollToDailyTasks();
            return;
          }

          startAd();
        });
      }

      // ÚKOL: Aktualizuj statistiky
      if (taskStatsItem && taskStatsBadge) {
        taskStatsItem.addEventListener("click", function () {
          if (!tasksState.statsDone) {
            tasksState.statsDone = true;
            applyTasksState();
            saveTasksState();
            credits += 5;
            syncCreditsDisplay();
            saveCredits();
          }
        });
      }

      // ÚKOL: Odpověz na kampaň – jen rozbalení seznamu
      if (taskCampaignItem && taskCampaignBadge) {
        taskCampaignItem.addEventListener("click", function () {
          if (tasksState.campaignDone) return;
          if (campaignList) campaignList.classList.toggle("hidden");
        });
      }

      // Odpovědi na konkrétní kampaně
      if (campaignRespondButtons && campaignRespondButtons.length) {
        campaignRespondButtons.forEach(function (btn) {
          btn.addEventListener("click", function (e) {
            e.preventDefault();
            if (!tasksState.campaignDone) {
              tasksState.campaignDone = true;
              applyTasksState();
              saveTasksState();
              credits += 6;
              syncCreditsDisplay();
              saveCredits();
            }
            if (campaignList) campaignList.classList.add("hidden");
          });
        });
      }
    });
  </script>
</body>
</html>
