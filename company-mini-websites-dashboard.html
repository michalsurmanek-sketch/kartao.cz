<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Správa Mini Webů | Kartáo.cz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <i data-lucide="globe" class="h-6 w-6 text-blue-600"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900">Správa Mini Webů</h1>
                    <p class="text-sm text-gray-500">Vytvořte a spravujte firemní weby</p>
                </div>
            </div>
            <button onclick="createNewWebsite()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center space-x-2">
                <i data-lucide="plus" class="h-4 w-4"></i>
                <span>Nový Web</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <i data-lucide="globe" class="h-5 w-5 text-blue-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Celkem webů</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalWebsites">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-green-100 rounded-lg">
                        <i data-lucide="eye" class="h-5 w-5 text-green-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Celkové návštěvy</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalVisits">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <i data-lucide="rocket" class="h-5 w-5 text-purple-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Publikované</p>
                        <p class="text-2xl font-bold text-gray-900" id="publishedWebsites">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-orange-100 rounded-lg">
                        <i data-lucide="trending-up" class="h-5 w-5 text-orange-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Průměrná návštěvnost</p>
                        <p class="text-2xl font-bold text-gray-900" id="avgVisits">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex space-x-1 mb-6">
            <button onclick="switchTab('websites')" id="websitesTab" class="px-4 py-2 text-sm font-medium rounded-lg bg-blue-100 text-blue-700">
                Moje Weby
            </button>
            <button onclick="switchTab('templates')" id="templatesTab" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-500 hover:text-gray-700">
                Šablony
            </button>
            <button onclick="switchTab('analytics')" id="analyticsTab" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-500 hover:text-gray-700">
                Analytika
            </button>
            <button onclick="switchTab('settings')" id="settingsTab" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-500 hover:text-gray-700">
                Nastavení
            </button>
        </div>

        <!-- Websites Tab -->
        <div id="websitesContent" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-medium text-gray-900">Vaše weby</h3>
                    <div class="flex space-x-2">
                        <input type="text" id="websiteSearch" placeholder="Hledat weby..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <select id="statusFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Všechny stavy</option>
                            <option value="draft">Návrh</option>
                            <option value="published">Publikované</option>
                            <option value="archived">Archivované</option>
                        </select>
                    </div>
                </div>
                <div id="websitesList" class="divide-y divide-gray-200">
                    <!-- Websites will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Templates Tab -->
        <div id="templatesContent" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Templates will be loaded here -->
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analyticsContent" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Global Analytics -->
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-medium text-gray-900">Celková analýza</h3>
                        <select id="analyticsTimeRange" onchange="updateAnalytics()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            <option value="7d">Posledních 7 dní</option>
                            <option value="30d" selected>Posledních 30 dní</option>
                            <option value="90d">Posledních 90 dní</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <canvas id="visitsChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <canvas id="trafficSourcesChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Top Performing Websites -->
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-medium text-gray-900 mb-6">Nejlepší weby</h3>
                    <div id="topWebsites" class="space-y-4">
                        <!-- Top websites will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsContent" class="tab-content hidden">
            <div class="space-y-6">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-medium text-gray-900 mb-6">Globální nastavení</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vlastní doména</label>
                            <input type="text" id="customDomain" placeholder="vase-domena.cz" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <p class="text-sm text-gray-500 mt-1">Nastavte vlastní doménu pro vaše mini weby</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Analytics tracking</label>
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="enableAnalytics" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Povolit sledování návštěvnosti</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">SEO optimalizace</label>
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="autoSEO" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Automatická SEO optimalizace</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="saveSettings()" class="mt-6 bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        Uložit nastavení
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Website Modal -->
    <div id="createWebsiteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 m-4 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-900">Vytvořit nový web</h2>
                <button onclick="closeCreateModal()" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            
            <form id="createWebsiteForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Název webu *</label>
                    <input type="text" id="websiteName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Popis</label>
                    <textarea id="websiteDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Vyberte šablonu</label>
                    <div id="templateSelection" class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Barevné schéma</label>
                    <select id="colorScheme" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="blue">Modrá</option>
                        <option value="green">Zelená</option>
                        <option value="purple">Fialová</option>
                        <option value="orange">Oranžová</option>
                        <option value="gray">Šedá</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeCreateModal()" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Zrušit
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Vytvořit web
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Website Detail Modal -->
    <div id="websiteDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 m-4 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-900" id="detailWebsiteName"></h2>
                    <p class="text-sm text-gray-500" id="detailWebsiteUrl"></p>
                </div>
                <button onclick="closeDetailModal()" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Website Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-2xl font-bold text-gray-900" id="detailVisits">0</div>
                        <div class="text-sm text-gray-500">Návštěvy (30d)</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-2xl font-bold text-gray-900" id="detailUniqueVisitors">0</div>
                        <div class="text-sm text-gray-500">Unikátní návštěvníci</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-2xl font-bold text-gray-900" id="detailBounceRate">0%</div>
                        <div class="text-sm text-gray-500">Bounce rate</div>
                    </div>
                </div>
                
                <!-- Pages Management -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Stránky webu</h3>
                        <button onclick="addNewPage()" class="bg-blue-600 text-white px-3 py-1.5 rounded-lg text-sm hover:bg-blue-700">
                            <i data-lucide="plus" class="h-4 w-4 inline mr-1"></i>
                            Přidat stránku
                        </button>
                    </div>
                    <div id="websitePages" class="space-y-2">
                        <!-- Pages will be loaded here -->
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="flex flex-wrap gap-3">
                    <button onclick="editWebsite()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">
                        <i data-lucide="edit" class="h-4 w-4 inline mr-2"></i>
                        Upravit web
                    </button>
                    <button onclick="previewWebsite()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
                        <i data-lucide="eye" class="h-4 w-4 inline mr-2"></i>
                        Náhled
                    </button>
                    <button onclick="publishWebsite()" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700">
                        <i data-lucide="rocket" class="h-4 w-4 inline mr-2"></i>
                        Publikovat
                    </button>
                    <button onclick="duplicateWebsite()" class="bg-gray-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-700">
                        <i data-lucide="copy" class="h-4 w-4 inline mr-2"></i>
                        Duplikovat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="firebase-init.js"></script>
  <script src="auth.js"></script>
  <script src="auth-header.js"></script>
    <script src="company-mini-websites-system.js"></script>
    
    <script>
        let miniWebsiteSystem;
        let currentWebsiteId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Initialize mini website system
            miniWebsiteSystem = new CompanyMiniWebsiteSystem();
            
            // Load initial data
            await loadDashboardData();
            
            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Search functionality
            document.getElementById('websiteSearch').addEventListener('input', filterWebsites);
            document.getElementById('statusFilter').addEventListener('change', filterWebsites);
            
            // Form submission
            document.getElementById('createWebsiteForm').addEventListener('submit', handleCreateWebsite);
        }

        async function loadDashboardData() {
            try {
                await Promise.all([
                    loadWebsites(),
                    loadTemplates(),
                    loadStats()
                ]);
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadWebsites() {
            // Mock data pro demo
            const mockWebsites = [
                {
                    id: '1',
                    name: 'Naše Agentura',
                    description: 'Kreativní reklamní agentura',
                    urlSlug: 'nase-agentura',
                    status: 'published',
                    template: { name: 'Creative Agency' },
                    stats: { views: 1250, uniqueVisitors: 890 },
                    updatedAt: { toDate: () => new Date('2024-12-15') },
                    publicUrl: 'https://kartao.cz/company/nase-agentura'
                },
                {
                    id: '2',
                    name: 'Tech Solutions',
                    description: 'IT řešení pro firmy',
                    urlSlug: 'tech-solutions',
                    status: 'draft',
                    template: { name: 'Corporate Professional' },
                    stats: { views: 0, uniqueVisitors: 0 },
                    updatedAt: { toDate: () => new Date('2024-12-14') },
                    publicUrl: 'https://kartao.cz/company/tech-solutions'
                }
            ];

            renderWebsites(mockWebsites);
        }

        function renderWebsites(websites) {
            const container = document.getElementById('websitesList');
            
            if (websites.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i data-lucide="globe" class="h-12 w-12 text-gray-400 mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Žádné weby</h3>
                        <p class="text-gray-500 mb-4">Zatím nemáte žádné mini weby</p>
                        <button onclick="createNewWebsite()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            Vytvořit první web
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            container.innerHTML = websites.map(website => `
                <div class="p-6 hover:bg-gray-50 cursor-pointer" onclick="openWebsiteDetail('${website.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="globe" class="h-6 w-6 text-blue-600"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h3 class="text-lg font-medium text-gray-900">${website.name}</h3>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusBadgeClass(website.status)}">
                                        ${getStatusText(website.status)}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-500">${website.description}</p>
                                <div class="flex items-center space-x-4 mt-2 text-sm text-gray-500">
                                    <span>Šablona: ${website.template.name}</span>
                                    <span>•</span>
                                    <span>Upraveno: ${formatDate(website.updatedAt.toDate())}</span>
                                    <span>•</span>
                                    <span>${website.stats.views} návštěv</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            ${website.status === 'published' ? `
                                <a href="${website.publicUrl}" target="_blank" class="p-2 text-blue-600 hover:bg-blue-100 rounded-lg" onclick="event.stopPropagation()">
                                    <i data-lucide="external-link" class="h-4 w-4"></i>
                                </a>
                            ` : ''}
                            <button class="p-2 text-gray-500 hover:bg-gray-100 rounded-lg" onclick="event.stopPropagation(); showWebsiteMenu('${website.id}')">
                                <i data-lucide="more-horizontal" class="h-4 w-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            lucide.createIcons();
        }

        function loadTemplates() {
            const container = document.getElementById('templatesContent');
            const templates = [
                {
                    id: 'corporate',
                    name: 'Corporate Professional',
                    description: 'Elegantní firemní šablona pro B2B společnosti',
                    preview: '/templates/corporate-preview.jpg',
                    features: ['Kontaktní formulář', 'Portfolio', 'Team sekce']
                },
                {
                    id: 'creative',
                    name: 'Creative Agency',
                    description: 'Kreativní šablona pro agentury a designéry',
                    preview: '/templates/creative-preview.jpg',
                    features: ['Galerie', 'Animace', 'Portfolio']
                },
                {
                    id: 'ecommerce',
                    name: 'E-commerce Store',
                    description: 'Obchodní šablona s katalohem produktů',
                    preview: '/templates/ecommerce-preview.jpg',
                    features: ['Produkty', 'Košík', 'Reviews']
                }
            ];

            container.innerHTML = templates.map(template => `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="h-48 bg-gradient-to-br from-blue-100 to-purple-100"></div>
                    <div class="p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">${template.name}</h3>
                        <p class="text-sm text-gray-600 mb-4">${template.description}</p>
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${template.features.map(feature => `
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">${feature}</span>
                            `).join('')}
                        </div>
                        <button onclick="useTemplate('${template.id}')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Použít šablonu
                        </button>
                    </div>
                </div>
            `).join('');

            // Update template selection in modal
            const selectionContainer = document.getElementById('templateSelection');
            selectionContainer.innerHTML = templates.map(template => `
                <label class="cursor-pointer">
                    <input type="radio" name="template" value="${template.id}" class="sr-only peer">
                    <div class="p-3 border rounded-lg peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:border-gray-300">
                        <div class="text-sm font-medium text-gray-900">${template.name}</div>
                        <div class="text-xs text-gray-500">${template.description}</div>
                    </div>
                </label>
            `).join('');
        }

        async function loadStats() {
            // Mock stats
            document.getElementById('totalWebsites').textContent = '2';
            document.getElementById('totalVisits').textContent = '1,250';
            document.getElementById('publishedWebsites').textContent = '1';
            document.getElementById('avgVisits').textContent = '625';
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.classList.remove('bg-blue-100', 'text-blue-700');
                tab.classList.add('text-gray-500', 'hover:text-gray-700');
            });

            // Show selected content
            document.getElementById(tabName + 'Content').classList.remove('hidden');

            // Add active class to selected tab
            const activeTab = document.getElementById(tabName + 'Tab');
            activeTab.classList.add('bg-blue-100', 'text-blue-700');
            activeTab.classList.remove('text-gray-500', 'hover:text-gray-700');

            if (tabName === 'analytics') {
                loadAnalytics();
            }
        }

        function loadAnalytics() {
            // Mock analytics charts
            const ctx1 = document.getElementById('visitsChart').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Pondělí', 'Úterý', 'Středa', 'Čtvrtek', 'Pátek', 'Sobota', 'Neděle'],
                    datasets: [{
                        label: 'Návštěvy',
                        data: [65, 85, 90, 81, 56, 100, 120],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            const ctx2 = document.getElementById('trafficSourcesChart').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Organické vyhledávání', 'Sociální sítě', 'Přímá návštěva', 'Email'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Website creation
        function createNewWebsite() {
            document.getElementById('createWebsiteModal').classList.remove('hidden');
            document.getElementById('createWebsiteModal').classList.add('flex');
        }

        function closeCreateModal() {
            document.getElementById('createWebsiteModal').classList.add('hidden');
            document.getElementById('createWebsiteModal').classList.remove('flex');
            document.getElementById('createWebsiteForm').reset();
        }

        async function handleCreateWebsite(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const websiteData = {
                name: formData.get('websiteName') || document.getElementById('websiteName').value,
                description: document.getElementById('websiteDescription').value,
                templateId: document.querySelector('input[name="template"]:checked')?.value,
                colorScheme: document.getElementById('colorScheme').value
            };

            try {
                // Mock company ID - v reálné aplikaci by se získalo z auth
                const companyId = 'mock-company-id';
                
                console.log('Vytvářím web:', websiteData);
                // await miniWebsiteSystem.createMiniWebsite(companyId, websiteData);
                
                closeCreateModal();
                await loadWebsites();
                
                showNotification('Web byl úspěšně vytvořen!', 'success');
                
            } catch (error) {
                console.error('Error creating website:', error);
                showNotification('Chyba při vytváření webu: ' + error.message, 'error');
            }
        }

        function useTemplate(templateId) {
            createNewWebsite();
            document.querySelector(`input[value="${templateId}"]`).checked = true;
        }

        // Website detail modal
        function openWebsiteDetail(websiteId) {
            currentWebsiteId = websiteId;
            
            // Mock data
            document.getElementById('detailWebsiteName').textContent = 'Naše Agentura';
            document.getElementById('detailWebsiteUrl').textContent = 'https://kartao.cz/company/nase-agentura';
            document.getElementById('detailVisits').textContent = '1,250';
            document.getElementById('detailUniqueVisitors').textContent = '890';
            document.getElementById('detailBounceRate').textContent = '45%';
            
            loadWebsitePages(websiteId);
            
            document.getElementById('websiteDetailModal').classList.remove('hidden');
            document.getElementById('websiteDetailModal').classList.add('flex');
        }

        function closeDetailModal() {
            document.getElementById('websiteDetailModal').classList.add('hidden');
            document.getElementById('websiteDetailModal').classList.remove('flex');
            currentWebsiteId = null;
        }

        function loadWebsitePages(websiteId) {
            // Mock pages
            const pages = [
                { title: 'Domů', slug: 'home', isHomePage: true, isPublished: true },
                { title: 'O nás', slug: 'o-nas', isHomePage: false, isPublished: true },
                { title: 'Služby', slug: 'sluzby', isHomePage: false, isPublished: false },
                { title: 'Kontakt', slug: 'kontakt', isHomePage: false, isPublished: true }
            ];

            const container = document.getElementById('websitePages');
            container.innerHTML = pages.map(page => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="file-text" class="h-4 w-4 text-gray-400"></i>
                        <div>
                            <div class="font-medium text-gray-900">${page.title}</div>
                            <div class="text-sm text-gray-500">/${page.slug}</div>
                        </div>
                        ${page.isHomePage ? '<span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">Domovská</span>' : ''}
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="px-2 py-1 text-xs rounded-full ${page.isPublished ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'}">
                            ${page.isPublished ? 'Publikováno' : 'Návrh'}
                        </span>
                        <button class="p-1 text-gray-500 hover:bg-gray-100 rounded" onclick="editPage('${page.slug}')">
                            <i data-lucide="edit" class="h-4 w-4"></i>
                        </button>
                        ${!page.isHomePage ? `
                            <button class="p-1 text-red-500 hover:bg-red-50 rounded" onclick="deletePage('${page.slug}')">
                                <i data-lucide="trash-2" class="h-4 w-4"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            lucide.createIcons();
        }

        // Website actions
        function editWebsite() {
            console.log('Edit website:', currentWebsiteId);
            showNotification('Funkce editace bude dostupná brzy', 'info');
        }

        function previewWebsite() {
            console.log('Preview website:', currentWebsiteId);
            window.open('https://kartao.cz/company/nase-agentura', '_blank');
        }

        function publishWebsite() {
            console.log('Publish website:', currentWebsiteId);
            showNotification('Web byl publikován!', 'success');
        }

        function duplicateWebsite() {
            console.log('Duplicate website:', currentWebsiteId);
            showNotification('Web byl duplikován', 'success');
        }

        // Page actions
        function addNewPage() {
            console.log('Add new page to website:', currentWebsiteId);
            showNotification('Funkce přidání stránky bude dostupná brzy', 'info');
        }

        function editPage(pageSlug) {
            console.log('Edit page:', pageSlug);
            showNotification('Funkce editace stránky bude dostupná brzy', 'info');
        }

        function deletePage(pageSlug) {
            if (confirm('Opravdu chcete smazat tuto stránku?')) {
                console.log('Delete page:', pageSlug);
                showNotification('Stránka byla smazána', 'success');
            }
        }

        // Filtering
        function filterWebsites() {
            const search = document.getElementById('websiteSearch').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            
            console.log('Filtering websites:', { search, status });
            // Implementace filtrace
        }

        // Settings
        function saveSettings() {
            const customDomain = document.getElementById('customDomain').value;
            const enableAnalytics = document.getElementById('enableAnalytics').checked;
            const autoSEO = document.getElementById('autoSEO').checked;
            
            console.log('Saving settings:', { customDomain, enableAnalytics, autoSEO });
            showNotification('Nastavení bylo uloženo', 'success');
        }

        // Utility functions
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'published': return 'bg-green-100 text-green-700';
                case 'draft': return 'bg-yellow-100 text-yellow-700';
                case 'archived': return 'bg-gray-100 text-gray-700';
                default: return 'bg-gray-100 text-gray-700';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'published': return 'Publikováno';
                case 'draft': return 'Návrh';
                case 'archived': return 'Archivováno';
                default: return 'Neznámý';
            }
        }

        function formatDate(date) {
            return new Intl.DateTimeFormat('cs-CZ', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            }).format(date);
        }

        function showNotification(message, type = 'info') {
            // Simple notification - in real app would use proper notification system
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 rounded-lg shadow-lg z-50`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>