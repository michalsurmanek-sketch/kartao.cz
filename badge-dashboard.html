<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badge Syst√©m - Kartao.cz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="firebase-init.js"></script>
    <script src="badge-system.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header with User Level -->
        <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white py-8">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-bold mb-2 flex items-center">
                            <i data-lucide="award" class="w-10 h-10 mr-4"></i>
                            Badge Syst√©m
                        </h1>
                        <p class="text-xl text-purple-100">Z√≠sk√°vej odznaky, stoupej v √∫rovn√≠ch a sta≈à se legendou!</p>
                    </div>
                    
                    <!-- User Level Display -->
                    <div class="text-center bg-white bg-opacity-20 rounded-xl p-6">
                        <div id="userLevelIcon" class="text-4xl mb-2">üå±</div>
                        <div id="userLevelName" class="text-lg font-bold">Nov√°ƒçek</div>
                        <div class="text-sm text-purple-200 mb-2">Level <span id="userLevel">1</span></div>
                        <div class="w-32 h-2 bg-white bg-opacity-30 rounded-full">
                            <div id="userLevelProgress" class="h-2 bg-white rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-1">
                            <span id="userPoints">0</span>/<span id="nextLevelPoints">100</span> bod≈Ø
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white shadow-sm sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-6">
                <nav class="flex space-x-8 py-4">
                    <button id="tabMyBadges" class="tab-btn active flex items-center px-4 py-2 rounded-lg font-semibold transition">
                        <i data-lucide="star" class="w-5 h-5 mr-2"></i>
                        Moje Odznaky
                    </button>
                    <button id="tabAllBadges" class="tab-btn flex items-center px-4 py-2 rounded-lg font-semibold transition">
                        <i data-lucide="grid-3x3" class="w-5 h-5 mr-2"></i>
                        V≈°echny Odznaky
                    </button>
                    <button id="tabLeaderboard" class="tab-btn flex items-center px-4 py-2 rounded-lg font-semibold transition">
                        <i data-lucide="trophy" class="w-5 h-5 mr-2"></i>
                        ≈Ωeb≈ô√≠ƒçek Bod≈Ø
                    </button>
                    <button id="tabStatistics" class="tab-btn flex items-center px-4 py-2 rounded-lg font-semibold transition">
                        <i data-lucide="bar-chart" class="w-5 h-5 mr-2"></i>
                        Statistiky
                    </button>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-6 py-8">

            <!-- My Badges Section -->
            <div id="myBadgesSection" class="tab-content">
                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                        <div class="text-2xl font-bold text-blue-600" id="myBadgeCount">0</div>
                        <div class="text-sm text-blue-700">Z√≠skan√© odznaky</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 text-center">
                        <div class="text-2xl font-bold text-green-600" id="myTotalPoints">0</div>
                        <div class="text-sm text-green-700">Celkem bod≈Ø</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 text-center">
                        <div class="text-2xl font-bold text-purple-600" id="myRareBadges">0</div>
                        <div class="text-sm text-purple-700">Vz√°cn√© odznaky</div>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-6 text-center">
                        <div class="text-2xl font-bold text-yellow-600" id="myRank">-</div>
                        <div class="text-sm text-yellow-700">Pozice v ≈æeb≈ô√≠ƒçku</div>
                    </div>
                </div>

                <!-- My Badges Grid -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üèÜ Moje Odznaky</h2>
                    <div id="myBadgesGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- My badges will be populated here -->
                    </div>
                    <div id="noBadgesMessage" class="hidden text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üéØ</div>
                        <h3 class="text-xl font-bold mb-2">Zat√≠m nem√°≈° ≈æ√°dn√© odznaky</h3>
                        <p class="text-gray-600">Zaƒçni plnit √∫koly a z√≠sk√°vej sv√© prvn√≠ odznaky!</p>
                        <button onclick="showTab('allBadges')" class="mt-4 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition">
                            Prozkoumat dostupn√© odznaky
                        </button>
                    </div>
                </div>

                <!-- Recent Achievements -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìÖ Ned√°vn√° √∫spƒõchy</h3>
                    <div id="recentAchievements" class="space-y-3">
                        <!-- Recent achievements will be populated here -->
                    </div>
                </div>
            </div>

            <!-- All Badges Section -->
            <div id="allBadgesSection" class="tab-content hidden">
                <!-- Category Filter -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <h2 class="text-2xl font-bold text-gray-800">üéÆ V≈°echny Odznaky</h2>
                        <div class="flex space-x-4">
                            <select id="categoryFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="all">V≈°echny kategorie</option>
                                <option value="performance">Performance</option>
                                <option value="social">Social</option>
                                <option value="achievement">Achievement</option>
                                <option value="special">Special</option>
                                <option value="loyalty">Loyalty</option>
                                <option value="expertise">Expertise</option>
                            </select>
                            <select id="rarityFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="all">V≈°echny rarity</option>
                                <option value="common">Common</option>
                                <option value="rare">Rare</option>
                                <option value="epic">Epic</option>
                                <option value="legendary">Legendary</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Badge Categories -->
                <div id="badgeCategoriesContainer">
                    <!-- Categories will be populated here -->
                </div>
            </div>

            <!-- Leaderboard Section -->
            <div id="leaderboardSection" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üèÜ ≈Ωeb≈ô√≠ƒçek Nejlep≈°√≠ch</h2>
                    
                    <!-- Top 3 Podium -->
                    <div id="badgeLeaderboardPodium" class="mb-8">
                        <!-- Podium will be populated here -->
                    </div>

                    <!-- Full Leaderboard -->
                    <div id="badgeLeaderboard" class="space-y-3">
                        <!-- Leaderboard entries will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div id="statisticsSection" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Category Statistics -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">üìä Statistiky podle kategori√≠</h3>
                        <div id="categoryStatistics" class="space-y-4">
                            <!-- Category stats will be populated here -->
                        </div>
                    </div>

                    <!-- Rarity Statistics -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">üíé Statistiky podle vz√°cnosti</h3>
                        <div id="rarityStatistics" class="space-y-4">
                            <!-- Rarity stats will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Global Badge Stats -->
                <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">üåç Glob√°ln√≠ statistiky</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-blue-600" id="totalBadgeTypes">0</div>
                            <div class="text-sm text-gray-600">Typ≈Ø odznak≈Ø</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-600" id="totalBadgesAwarded">0</div>
                            <div class="text-sm text-gray-600">Udƒõlen√Ωch odznak≈Ø</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-purple-600" id="averageBadgesPerUser">0</div>
                            <div class="text-sm text-gray-600">Pr≈Ømƒõr na u≈æivatele</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Badge Detail Modal -->
        <div id="badgeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <div class="text-center">
                    <div id="modalBadgeIcon" class="text-6xl mb-4">üèÜ</div>
                    <h3 id="modalBadgeName" class="text-2xl font-bold text-gray-800 mb-2">Badge Name</h3>
                    <div id="modalBadgeCategory" class="inline-block px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full mb-3">Category</div>
                    <p id="modalBadgeDescription" class="text-gray-600 mb-4">Badge description</p>
                    <div class="flex items-center justify-center space-x-6 mb-6">
                        <div class="text-center">
                            <div id="modalBadgePoints" class="text-xl font-bold text-purple-600">0</div>
                            <div class="text-sm text-gray-600">Bod≈Ø</div>
                        </div>
                        <div class="text-center">
                            <div id="modalBadgeRarity" class="text-xl font-bold">Common</div>
                            <div class="text-sm text-gray-600">Vz√°cnost</div>
                        </div>
                    </div>
                    <div id="modalBadgeRequirements" class="text-left bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold text-gray-800 mb-2">Po≈æadavky:</h4>
                        <p class="text-sm text-gray-600">Requirements will be shown here</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="closeBadgeModal()" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">
                            Zav≈ô√≠t
                        </button>
                        <button id="modalShareBtn" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
                            Sd√≠let
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Badge Unlock Animation Modal -->
        <div id="badgeUnlockModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-sm w-full mx-4 text-center">
                <div class="animate-bounce mb-4">
                    <div id="unlockBadgeIcon" class="text-8xl">üèÜ</div>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Nov√Ω odznak!</h3>
                <h4 id="unlockBadgeName" class="text-xl text-purple-600 font-semibold mb-2">Badge Name</h4>
                <p id="unlockBadgeDescription" class="text-gray-600 mb-4">Badge description</p>
                <div class="text-lg font-bold text-green-600 mb-6">+<span id="unlockBadgePoints">0</span> bod≈Ø</div>
                <button onclick="closeBadgeUnlockModal()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition">
                    Awesome!
                </button>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-sm w-full mx-4 text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Naƒç√≠t√°m odznaky...</h3>
                <p class="text-sm text-gray-600">Kontroluji tv√© √∫spƒõchy</p>
            </div>
        </div>
    </div>

    <script>
        let badgeSystem = null;
        let currentUserId = null;
        let userBadges = [];
        let currentTab = 'myBadges';

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Inicializuji Badge System Dashboard...');
            
            lucide.createIcons();
            
            firebase.auth().onAuthStateChanged(async (user) => {
                if (user) {
                    currentUserId = user.uid;
                    await initializeSystem();
                } else {
                    console.log('üë§ U≈æivatel nen√≠ p≈ôihl√°≈°en');
                }
            });
        });

        async function initializeSystem() {
            try {
                badgeSystem = new BadgeSystem();
                setupEventListeners();
                await loadInitialData();
                console.log('‚úÖ Badge System inicializov√°n');
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi inicializaci:', error);
            }
        }

        function setupEventListeners() {
            // Tab navigation
            document.getElementById('tabMyBadges').addEventListener('click', () => showTab('myBadges'));
            document.getElementById('tabAllBadges').addEventListener('click', () => showTab('allBadges'));
            document.getElementById('tabLeaderboard').addEventListener('click', () => showTab('leaderboard'));
            document.getElementById('tabStatistics').addEventListener('click', () => showTab('statistics'));

            // Filters
            document.getElementById('categoryFilter').addEventListener('change', filterAllBadges);
            document.getElementById('rarityFilter').addEventListener('change', filterAllBadges);
        }

        async function loadInitialData() {
            showLoading(true);
            
            try {
                await Promise.all([
                    loadUserLevel(),
                    loadMyBadges(),
                    loadUserStats()
                ]);
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
            } finally {
                showLoading(false);
            }
        }

        async function loadUserLevel() {
            try {
                const userDoc = await firebase.firestore().collection('creators').doc(currentUserId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    const levelData = badgeSystem.getLevelByPoints(userData.totalPoints || 0);
                    
                    displayUserLevel(levelData, userData.totalPoints || 0);
                }
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ user levelu:', error);
            }
        }

        function displayUserLevel(levelData, totalPoints) {
            document.getElementById('userLevelIcon').textContent = levelData.icon;
            document.getElementById('userLevelName').textContent = levelData.name;
            document.getElementById('userLevel').textContent = levelData.level;
            document.getElementById('userPoints').textContent = totalPoints;
            document.getElementById('nextLevelPoints').textContent = levelData.maxPoints;

            // Progress bar
            const progress = ((totalPoints - levelData.minPoints) / (levelData.maxPoints - levelData.minPoints)) * 100;
            document.getElementById('userLevelProgress').style.width = `${Math.min(100, progress)}%`;
        }

        async function loadMyBadges() {
            try {
                userBadges = await badgeSystem.getUserBadges(currentUserId);
                displayMyBadges(userBadges);
                displayRecentAchievements(userBadges.slice(0, 5));
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ badges:', error);
            }
        }

        function displayMyBadges(badges) {
            const container = document.getElementById('myBadgesGrid');
            const noMessage = document.getElementById('noBadgesMessage');
            
            if (badges.length === 0) {
                container.classList.add('hidden');
                noMessage.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            noMessage.classList.add('hidden');

            container.innerHTML = badges.map(badgeData => {
                const badge = badgeData.badge;
                return `
                    <div class="badge-card bg-gradient-to-br from-white to-gray-50 rounded-xl p-4 border-2 border-gray-200 hover:border-purple-300 hover:shadow-lg transition cursor-pointer" 
                         onclick="showBadgeDetail('${badge.id}', true)">
                        <div class="text-center">
                            <div class="text-4xl mb-2">${badge.icon}</div>
                            <h3 class="font-bold text-gray-800 text-sm mb-1">${badge.name}</h3>
                            <div class="text-xs text-gray-600 mb-2">${badge.category}</div>
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-semibold px-2 py-1 rounded-full ${getRarityStyle(badge.rarity)}">${badge.rarity}</span>
                                <span class="text-xs font-bold text-purple-600">+${badge.points}</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">${new Date(badgeData.awardedAt).toLocaleDateString('cs-CZ')}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayRecentAchievements(recentBadges) {
            const container = document.getElementById('recentAchievements');
            
            if (recentBadges.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">Zat√≠m ≈æ√°dn√© √∫spƒõchy</div>';
                return;
            }

            container.innerHTML = recentBadges.map(badgeData => {
                const badge = badgeData.badge;
                return `
                    <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">${badge.icon}</div>
                            <div>
                                <h4 class="font-semibold text-gray-800">${badge.name}</h4>
                                <p class="text-sm text-gray-600">${badge.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-green-600">+${badge.points}</div>
                            <div class="text-xs text-gray-500">${timeAgo(badgeData.awardedAt)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function loadUserStats() {
            try {
                const rareBadges = userBadges.filter(b => b.badge.rarity === 'epic' || b.badge.rarity === 'legendary').length;
                const totalPoints = userBadges.reduce((sum, b) => sum + b.badge.points, 0);

                document.getElementById('myBadgeCount').textContent = userBadges.length;
                document.getElementById('myTotalPoints').textContent = totalPoints;
                document.getElementById('myRareBadges').textContent = rareBadges;

                // Load rank (simulace)
                document.getElementById('myRank').textContent = Math.floor(Math.random() * 100) + 1;
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ user stats:', error);
            }
        }

        function showTab(tabName) {
            currentTab = tabName;
            
            // Hide all sections
            document.querySelectorAll('.tab-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-600', 'text-white');
                btn.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            
            // Show selected section
            document.getElementById(`${tabName}Section`).classList.remove('hidden');
            
            // Activate current tab
            const activeTab = document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            activeTab.classList.add('active', 'bg-purple-600', 'text-white');
            activeTab.classList.remove('text-gray-600', 'hover:bg-gray-100');
            
            // Load tab data
            loadTabData(tabName);
        }

        async function loadTabData(tabName) {
            try {
                switch (tabName) {
                    case 'allBadges':
                        await loadAllBadges();
                        break;
                    case 'leaderboard':
                        await loadBadgeLeaderboard();
                        break;
                    case 'statistics':
                        await loadBadgeStatistics();
                        break;
                }
            } catch (error) {
                console.error(`‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat pro tab ${tabName}:`, error);
            }
        }

        async function loadAllBadges() {
            const badgeDefinitions = badgeSystem.getBadgeDefinitions();
            const categories = badgeSystem.getBadgeCategories();
            
            displayAllBadgesByCategory(badgeDefinitions, categories);
        }

        function displayAllBadgesByCategory(badges, categories) {
            const container = document.getElementById('badgeCategoriesContainer');
            
            container.innerHTML = Object.entries(categories).map(([categoryId, categoryData]) => {
                const categoryBadges = Object.values(badges).filter(badge => badge.category === categoryId);
                
                return `
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-3">${categoryData.icon}</span>
                            ${categoryData.name}
                            <span class="text-sm text-gray-500 font-normal ml-2">(${categoryBadges.length} odznak≈Ø)</span>
                        </h3>
                        <p class="text-gray-600 text-sm mb-4">${categoryData.description}</p>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            ${categoryBadges.map(badge => {
                                const hasEarned = userBadges.some(ub => ub.badgeId === badge.id);
                                return `
                                    <div class="badge-card ${hasEarned ? 'earned' : 'not-earned'} bg-gradient-to-br from-white to-gray-50 rounded-xl p-4 border-2 hover:shadow-lg transition cursor-pointer" 
                                         onclick="showBadgeDetail('${badge.id}', ${hasEarned})">
                                        <div class="text-center ${hasEarned ? '' : 'opacity-60'}">
                                            <div class="text-4xl mb-2">${badge.icon}</div>
                                            <h4 class="font-bold text-gray-800 text-sm mb-1">${badge.name}</h4>
                                            <div class="text-xs text-gray-600 mb-2">${badge.category}</div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-xs font-semibold px-2 py-1 rounded-full ${getRarityStyle(badge.rarity)}">${badge.rarity}</span>
                                                <span class="text-xs font-bold text-purple-600">+${badge.points}</span>
                                            </div>
                                            ${hasEarned ? '<div class="text-xs text-green-600 font-semibold mt-1">‚úì Z√≠sk√°no</div>' : '<div class="text-xs text-gray-400 mt-1">Nez√≠sk√°no</div>'}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function loadBadgeLeaderboard() {
            try {
                const topUsers = await badgeSystem.getTopBadgeHolders(20);
                displayBadgeLeaderboard(topUsers);
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ leaderboardu:', error);
            }
        }

        function displayBadgeLeaderboard(users) {
            const container = document.getElementById('badgeLeaderboard');
            const podium = document.getElementById('badgeLeaderboardPodium');

            if (users.length >= 3) {
                // Display top 3 podium
                const top3 = users.slice(0, 3);
                podium.innerHTML = `
                    <div class="flex justify-center items-end space-x-4 mb-8">
                        <!-- 2nd place -->
                        <div class="text-center">
                            <div class="bg-gray-100 rounded-xl p-4 h-24 flex flex-col justify-end">
                                <div class="w-12 h-12 bg-gray-300 rounded-full mx-auto mb-2">
                                    <img src="${top3[1].avatar || 'https://via.placeholder.com/48'}" alt="${top3[1].displayName}" class="w-full h-full rounded-full object-cover">
                                </div>
                                <h3 class="font-bold text-xs">${top3[1].displayName}</h3>
                                <div class="text-xs text-gray-600">${top3[1].totalPoints} bod≈Ø</div>
                            </div>
                            <div class="text-3xl mt-2">ü•à</div>
                        </div>

                        <!-- 1st place -->
                        <div class="text-center">
                            <div class="bg-gradient-to-br from-yellow-100 to-yellow-200 rounded-xl p-4 h-32 flex flex-col justify-end">
                                <div class="w-16 h-16 bg-yellow-300 rounded-full mx-auto mb-2">
                                    <img src="${top3[0].avatar || 'https://via.placeholder.com/64'}" alt="${top3[0].displayName}" class="w-full h-full rounded-full object-cover">
                                </div>
                                <h3 class="font-bold text-sm">${top3[0].displayName}</h3>
                                <div class="text-sm text-gray-600">${top3[0].totalPoints} bod≈Ø</div>
                                <div class="text-xs text-gray-500">${top3[0].badgeCount} odznak≈Ø</div>
                            </div>
                            <div class="text-4xl mt-2">ü•á</div>
                        </div>

                        <!-- 3rd place -->
                        <div class="text-center">
                            <div class="bg-orange-100 rounded-xl p-4 h-20 flex flex-col justify-end">
                                <div class="w-10 h-10 bg-orange-300 rounded-full mx-auto mb-1">
                                    <img src="${top3[2].avatar || 'https://via.placeholder.com/40'}" alt="${top3[2].displayName}" class="w-full h-full rounded-full object-cover">
                                </div>
                                <h3 class="font-bold text-xs">${top3[2].displayName}</h3>
                                <div class="text-xs text-gray-600">${top3[2].totalPoints} bod≈Ø</div>
                            </div>
                            <div class="text-2xl mt-2">ü•â</div>
                        </div>
                    </div>
                `;
            }

            // Display full leaderboard
            container.innerHTML = users.map((user, index) => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 flex items-center justify-center font-bold text-lg ${index < 3 ? 'text-yellow-600' : 'text-gray-500'}">
                            ${index + 1}
                        </div>
                        <div class="w-12 h-12 bg-gray-200 rounded-full overflow-hidden">
                            <img src="${user.avatar || 'https://via.placeholder.com/48'}" alt="${user.displayName}" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${user.displayName}</h4>
                            <p class="text-sm text-gray-600">Level ${user.level} ‚Ä¢ ${user.badgeCount} odznak≈Ø</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-purple-600">${user.totalPoints}</div>
                        <div class="text-sm text-gray-600">bod≈Ø</div>
                        ${user.rareBadges > 0 ? `<div class="text-xs text-yellow-600">‚ú® ${user.rareBadges} vz√°cn√Ωch</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function loadBadgeStatistics() {
            try {
                const stats = await badgeSystem.getBadgeStatistics();
                displayBadgeStatistics(stats);
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ statistik:', error);
            }
        }

        function displayBadgeStatistics(stats) {
            // Global stats
            document.getElementById('totalBadgeTypes').textContent = stats.totalBadges;
            document.getElementById('totalBadgesAwarded').textContent = stats.totalAwarded;
            document.getElementById('averageBadgesPerUser').textContent = Math.round(stats.totalAwarded / 100); // Simulace

            // Category stats
            const categoryContainer = document.getElementById('categoryStatistics');
            categoryContainer.innerHTML = Object.values(stats.categoryStats || {}).map(stat => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">${stat.category.icon}</div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${stat.category.name}</h4>
                            <p class="text-sm text-gray-600">${stat.badgeCount} typ≈Ø odznak≈Ø</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-blue-600">${stat.totalAwarded}</div>
                        <div class="text-sm text-gray-600">udƒõleno</div>
                    </div>
                </div>
            `).join('');

            // Rarity stats
            const rarityContainer = document.getElementById('rarityStatistics');
            rarityContainer.innerHTML = Object.values(stats.rarityStats || {}).map(stat => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 rounded-full" style="background-color: ${badgeSystem.getRarityColor(stat.rarity)}"></div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${stat.rarity.charAt(0).toUpperCase() + stat.rarity.slice(1)}</h4>
                            <p class="text-sm text-gray-600">Vz√°cnost</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-purple-600">${stat.count}</div>
                        <div class="text-sm text-gray-600">udƒõleno</div>
                    </div>
                </div>
            `).join('');
        }

        function filterAllBadges() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const rarityFilter = document.getElementById('rarityFilter').value;
            
            const badgeCards = document.querySelectorAll('.badge-card');
            
            badgeCards.forEach(card => {
                const shouldShow = true; // Placeholder for filter logic
                card.style.display = shouldShow ? 'block' : 'none';
            });
        }

        function showBadgeDetail(badgeId, hasEarned) {
            const badge = badgeSystem.getBadgeDefinitions()[badgeId];
            if (!badge) return;

            document.getElementById('modalBadgeIcon').textContent = badge.icon;
            document.getElementById('modalBadgeName').textContent = badge.name;
            document.getElementById('modalBadgeCategory').textContent = badge.category;
            document.getElementById('modalBadgeDescription').textContent = badge.description;
            document.getElementById('modalBadgePoints').textContent = badge.points;
            document.getElementById('modalBadgeRarity').textContent = badge.rarity;
            
            // Requirements
            const requirements = formatBadgeRequirements(badge.requirements);
            document.getElementById('modalBadgeRequirements').innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-2">Po≈æadavky:</h4>
                <p class="text-sm text-gray-600">${requirements}</p>
            `;

            // Update modal colors based on rarity
            const rarityStyle = getRarityStyle(badge.rarity);
            document.getElementById('modalBadgeCategory').className = `inline-block px-3 py-1 text-sm rounded-full ${rarityStyle}`;
            
            document.getElementById('badgeModal').classList.remove('hidden');
        }

        function formatBadgeRequirements(requirements) {
            switch (requirements.type) {
                case 'campaign_completed':
                    return `Dokonƒçit ${requirements.count} kampan√≠${requirements.min_rating ? ` s hodnocen√≠m ${requirements.min_rating}+` : ''}`;
                case 'engagement_rate':
                    return `Dos√°hnout ${requirements.min_value}% engagement rate`;
                case 'followers':
                    return `Z√≠skat ${requirements.min_value.toLocaleString()} follower≈Ø`;
                case 'verified_account':
                    return 'M√≠t ovƒõ≈ôen√Ω √∫ƒçet';
                case 'account_age':
                    return `B√Ωt aktivn√≠ ${Math.round(requirements.min_days / 30)} mƒõs√≠c≈Ø`;
                default:
                    return 'Speci√°ln√≠ po≈æadavky';
            }
        }

        function closeBadgeModal() {
            document.getElementById('badgeModal').classList.add('hidden');
        }

        function closeBadgeUnlockModal() {
            document.getElementById('badgeUnlockModal').classList.add('hidden');
        }

        function showBadgeUnlock(badge) {
            document.getElementById('unlockBadgeIcon').textContent = badge.icon;
            document.getElementById('unlockBadgeName').textContent = badge.name;
            document.getElementById('unlockBadgeDescription').textContent = badge.description;
            document.getElementById('unlockBadgePoints').textContent = badge.points;
            
            document.getElementById('badgeUnlockModal').classList.remove('hidden');
        }

        function getRarityStyle(rarity) {
            const styles = {
                'common': 'bg-gray-100 text-gray-800',
                'rare': 'bg-blue-100 text-blue-800',
                'epic': 'bg-purple-100 text-purple-800',
                'legendary': 'bg-yellow-100 text-yellow-800'
            };
            return styles[rarity] || styles['common'];
        }

        function timeAgo(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 60) return `${diffInMinutes}m`;
            if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h`;
            return `${Math.floor(diffInMinutes / 1440)}d`;
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        // CSS for tabs and animations
        const style = document.createElement('style');
        style.textContent = `
            .tab-btn {
                transition: all 0.3s ease;
                color: #6b7280;
            }
            .tab-btn:hover {
                background-color: #f3f4f6;
            }
            .tab-btn.active {
                background-color: #9333ea;
                color: white;
            }
            .badge-card.earned {
                border-color: #10b981;
                background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            }
            .badge-card.not-earned:hover {
                border-color: #d1d5db;
            }
            @keyframes badgeUnlock {
                0% { transform: scale(0.5) rotate(-180deg); opacity: 0; }
                50% { transform: scale(1.1) rotate(-90deg); opacity: 1; }
                100% { transform: scale(1) rotate(0deg); opacity: 1; }
            }
            .animate-badge-unlock {
                animation: badgeUnlock 0.6s ease-out;
            }
        `;
        document.head.appendChild(style);

        // Simulace z√≠sk√°n√≠ badge pro demo
        setTimeout(() => {
            if (currentUserId && Math.random() > 0.7) {
                const demoBadge = {
                    icon: 'üöÄ',
                    name: 'Prvn√≠ kroky',
                    description: 'Dokonƒçil jsi svou prvn√≠ kampa≈à',
                    points: 10
                };
                showBadgeUnlock(demoBadge);
            }
        }, 3000);
    </script>
</body>
</html>