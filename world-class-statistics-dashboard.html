<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svƒõtov√° t≈ô√≠da statistik - Kartao.cz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="firebase-init.js"></script>
  <script src="auth.js"></script>
  <script src="auth-header.js"></script>
    <script src="world-class-statistics.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white py-8">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-bold mb-2 flex items-center">
                            <i data-lucide="bar-chart-3" class="w-10 h-10 mr-4"></i>
                            Svƒõtov√° t≈ô√≠da statistik
                        </h1>
                        <p class="text-xl text-purple-100">Pokroƒçil√© analytics a real-time insights pro v√°≈° business</p>
                    </div>
                    
                    <!-- Real-time Status -->
                    <div class="text-center bg-white bg-opacity-20 rounded-xl p-4">
                        <div class="flex items-center justify-center mb-2">
                            <div id="realTimeIndicator" class="w-3 h-3 bg-green-400 rounded-full animate-pulse mr-2"></div>
                            <span class="text-sm font-semibold">LIVE DATA</span>
                        </div>
                        <div class="text-xs text-purple-200">Posledn√≠ aktualizace: <span id="lastUpdate">pr√°vƒõ teƒè</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats Bar -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    <div class="text-center">
                        <div id="liveUsers" class="text-2xl font-bold text-blue-600">892</div>
                        <div class="text-xs text-gray-600">Aktivn√≠ u≈æivatel√©</div>
                    </div>
                    <div class="text-center">
                        <div id="liveRevenue" class="text-2xl font-bold text-green-600">45,230</div>
                        <div class="text-xs text-gray-600">Dne≈°n√≠ tr≈æby (Kƒç)</div>
                    </div>
                    <div class="text-center">
                        <div id="liveCampaigns" class="text-2xl font-bold text-purple-600">23</div>
                        <div class="text-xs text-gray-600">Aktivn√≠ kampanƒõ</div>
                    </div>
                    <div class="text-center">
                        <div id="liveConversion" class="text-2xl font-bold text-orange-600">12.8%</div>
                        <div class="text-xs text-gray-600">Konverze</div>
                    </div>
                    <div class="text-center">
                        <div id="liveEngagement" class="text-2xl font-bold text-pink-600">5.7%</div>
                        <div class="text-xs text-gray-600">Engagement</div>
                    </div>
                    <div class="text-center">
                        <div id="liveSatisfaction" class="text-2xl font-bold text-indigo-600">4.6</div>
                        <div class="text-xs text-gray-600">Spokojenost</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center space-x-4">
                        <h2 class="text-xl font-bold text-gray-800">Analytics Dashboard</h2>
                        <div class="flex items-center space-x-2 text-sm text-gray-500">
                            <i data-lucide="clock" class="w-4 h-4"></i>
                            <span>Auto-refresh: 30s</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Time Range Selector -->
                        <select id="timeRangeSelector" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="7d">Posledn√≠ch 7 dn√≠</option>
                            <option value="30d" selected>Posledn√≠ch 30 dn√≠</option>
                            <option value="90d">Posledn√≠ch 90 dn√≠</option>
                            <option value="1y">Posledn√≠ rok</option>
                        </select>
                        
                        <!-- Comparison -->
                        <select id="comparisonSelector" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">Bez porovn√°n√≠</option>
                            <option value="previous_period">P≈ôedchoz√≠ obdob√≠</option>
                            <option value="last_year">Stejn√© obdob√≠ loni</option>
                        </select>
                        
                        <!-- Export -->
                        <button id="exportBtn" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            Export
                        </button>
                        
                        <!-- Refresh -->
                        <button id="refreshBtn" class="bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Overview Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Users -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border border-blue-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-blue-800">Celkem u≈æivatel≈Ø</h3>
                        <i data-lucide="users" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div class="text-3xl font-bold text-blue-900 mb-2" id="totalUsers">1,250</div>
                    <div class="flex items-center text-sm">
                        <span id="userGrowth" class="text-green-600 font-semibold mr-2">+15.2%</span>
                        <span class="text-blue-700">vs. minul√© obdob√≠</span>
                    </div>
                    <div class="mt-4 h-2 bg-blue-200 rounded-full">
                        <div class="h-2 bg-blue-600 rounded-full" style="width: 76%"></div>
                    </div>
                </div>

                <!-- Revenue -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-green-800">Celkov√© tr≈æby</h3>
                        <i data-lucide="dollar-sign" class="w-6 h-6 text-green-600"></i>
                    </div>
                    <div class="text-3xl font-bold text-green-900 mb-2" id="totalRevenue">1,847,650 Kƒç</div>
                    <div class="flex items-center text-sm">
                        <span id="revenueGrowth" class="text-green-600 font-semibold mr-2">+23.8%</span>
                        <span class="text-green-700">vs. minul√© obdob√≠</span>
                    </div>
                    <div class="mt-4 h-2 bg-green-200 rounded-full">
                        <div class="h-2 bg-green-600 rounded-full" style="width: 89%"></div>
                    </div>
                </div>

                <!-- Campaigns -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border border-purple-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-purple-800">Kampanƒõ</h3>
                        <i data-lucide="target" class="w-6 h-6 text-purple-600"></i>
                    </div>
                    <div class="text-3xl font-bold text-purple-900 mb-2" id="totalCampaigns">234</div>
                    <div class="flex items-center text-sm">
                        <span id="campaignSuccess" class="text-purple-600 font-semibold mr-2">85.7%</span>
                        <span class="text-purple-700">√∫spƒõ≈°nost</span>
                    </div>
                    <div class="mt-4 h-2 bg-purple-200 rounded-full">
                        <div class="h-2 bg-purple-600 rounded-full" style="width: 86%"></div>
                    </div>
                </div>

                <!-- Satisfaction -->
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 border border-orange-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-orange-800">Spokojenost</h3>
                        <i data-lucide="star" class="w-6 h-6 text-orange-600"></i>
                    </div>
                    <div class="text-3xl font-bold text-orange-900 mb-2" id="customerSatisfaction">4.6/5</div>
                    <div class="flex items-center text-sm">
                        <span id="satisfactionTrend" class="text-green-600 font-semibold mr-2">+0.3</span>
                        <span class="text-orange-700">vs. minul√© obdob√≠</span>
                    </div>
                    <div class="mt-4 h-2 bg-orange-200 rounded-full">
                        <div class="h-2 bg-orange-600 rounded-full" style="width: 92%"></div>
                    </div>
                </div>
            </div>

            <!-- Main Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Revenue Chart -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">V√Ωvoj tr≈æeb</h3>
                        <div class="flex space-x-2">
                            <button class="chart-period-btn active text-sm px-3 py-1 bg-purple-100 text-purple-600 rounded-lg" data-period="daily">Den</button>
                            <button class="chart-period-btn text-sm px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-lg" data-period="weekly">T√Ωden</button>
                            <button class="chart-period-btn text-sm px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-lg" data-period="monthly">Mƒõs√≠c</button>
                        </div>
                    </div>
                    <div class="h-64">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- User Growth Chart -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">R≈Øst u≈æivatel≈Ø</h3>
                        <div class="text-sm text-gray-500">
                            <span id="userGrowthIndicator" class="inline-flex items-center">
                                <i data-lucide="trending-up" class="w-4 h-4 mr-1 text-green-500"></i>
                                Rostouc√≠ trend
                            </span>
                        </div>
                    </div>
                    <div class="h-64">
                        <canvas id="userGrowthChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Analytics Sections -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Campaign Performance -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Performance kampan√≠</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Aktivn√≠ kampanƒõ</span>
                            <span class="font-bold text-purple-600" id="activeCampaigns">45</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Dokonƒçen√©</span>
                            <span class="font-bold text-green-600" id="completedCampaigns">189</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Pr≈Ømƒõrn√° hodnota</span>
                            <span class="font-bold text-blue-600" id="avgCampaignValue">12,450 Kƒç</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">ROI</span>
                            <span class="font-bold text-orange-600" id="campaignROI">420%</span>
                        </div>
                    </div>
                    
                    <!-- Mini Chart -->
                    <div class="mt-6 h-32">
                        <canvas id="campaignTrendChart"></canvas>
                    </div>
                </div>

                <!-- Top Creators -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Top tv≈Ørci</h3>
                    <div id="topCreatorsList" class="space-y-4">
                        <!-- Top creators will be populated here -->
                    </div>
                </div>

                <!-- Market Trends -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Trendy trhu</h3>
                    <div class="space-y-4">
                        <div class="trend-item">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-semibold">Fashion & Beauty</span>
                                <span class="text-sm text-green-600">+18%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-pink-400 to-purple-600 h-2 rounded-full" style="width: 85%"></div>
                            </div>
                        </div>
                        
                        <div class="trend-item">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-semibold">Tech & Gaming</span>
                                <span class="text-sm text-green-600">+24%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-400 to-cyan-600 h-2 rounded-full" style="width: 72%"></div>
                            </div>
                        </div>
                        
                        <div class="trend-item">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-semibold">Lifestyle</span>
                                <span class="text-sm text-green-600">+12%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-400 to-emerald-600 h-2 rounded-full" style="width: 68%"></div>
                            </div>
                        </div>
                        
                        <div class="trend-item">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-semibold">Travel</span>
                                <span class="text-sm text-orange-600">-3%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-orange-400 to-red-500 h-2 rounded-full" style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Predictions Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i data-lucide="crystal-ball" class="w-5 h-5 mr-2 text-purple-600"></i>
                    AI Predikce a Trendy
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Revenue Prediction -->
                    <div class="prediction-card bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-bold text-green-800">Predikce tr≈æeb</h4>
                            <div class="confidence-indicator text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Spolehlivost: 68%</div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-green-700">P≈ô√≠≈°t√≠ mƒõs√≠c:</span>
                                <span class="font-bold text-green-900">2,134,000 Kƒç</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-green-700">P≈ô√≠≈°t√≠ ƒçtvrtlet√≠:</span>
                                <span class="font-bold text-green-900">6,890,000 Kƒç</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-green-700">R≈Øst:</span>
                                <span class="font-bold text-green-600">+15.6%</span>
                            </div>
                        </div>
                    </div>

                    <!-- User Growth Prediction -->
                    <div class="prediction-card bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-bold text-blue-800">R≈Øst u≈æivatel≈Ø</h4>
                            <div class="confidence-indicator text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Spolehlivost: 75%</div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-blue-700">P≈ô√≠≈°t√≠ mƒõs√≠c:</span>
                                <span class="font-bold text-blue-900">1,440 u≈æivatel≈Ø</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-blue-700">P≈ô√≠≈°t√≠ ƒçtvrtlet√≠:</span>
                                <span class="font-bold text-blue-900">2,150 u≈æivatel≈Ø</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-blue-700">Trend:</span>
                                <span class="font-bold text-green-600">Pozitivn√≠</span>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Analysis -->
                    <div class="prediction-card bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border border-orange-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-bold text-orange-800">Anal√Ωza rizik</h4>
                            <div class="risk-indicator text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">N√≠zk√© riziko</div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-orange-700">Churn riziko:</span>
                                <span class="font-bold text-green-600">8.5%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-orange-700">Konkurenƒçn√≠ riziko:</span>
                                <span class="font-bold text-yellow-600">St≈ôedn√≠</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-orange-700">Sez√≥nn√≠ dopad:</span>
                                <span class="font-bold text-blue-600">Pozitivn√≠</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Analytics -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Engagement Heatmap -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Engagement Heatmap</h3>
                    <div id="engagementHeatmap" class="h-64 flex items-center justify-center">
                        <!-- Heatmap visualization -->
                        <div class="grid grid-cols-7 gap-1 text-xs">
                            <!-- Days of week -->
                            <div class="text-center font-semibold text-gray-600">Po</div>
                            <div class="text-center font-semibold text-gray-600">√öt</div>
                            <div class="text-center font-semibold text-gray-600">St</div>
                            <div class="text-center font-semibold text-gray-600">ƒåt</div>
                            <div class="text-center font-semibold text-gray-600">P√°</div>
                            <div class="text-center font-semibold text-gray-600">So</div>
                            <div class="text-center font-semibold text-gray-600">Ne</div>
                            
                            <!-- Heat cells for hours -->
                            <!-- This would be generated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Geographic Distribution -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Geografick√© rozlo≈æen√≠</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="w-4 h-4 bg-blue-500 rounded"></span>
                                <span class="text-gray-700">ƒåesk√° republika</span>
                            </div>
                            <span class="font-bold">67.8%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="w-4 h-4 bg-green-500 rounded"></span>
                                <span class="text-gray-700">Slovensko</span>
                            </div>
                            <span class="font-bold">18.5%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="w-4 h-4 bg-purple-500 rounded"></span>
                                <span class="text-gray-700">Ostatn√≠ EU</span>
                            </div>
                            <span class="font-bold">10.2%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="w-4 h-4 bg-orange-500 rounded"></span>
                                <span class="text-gray-700">Zbytek svƒõta</span>
                            </div>
                            <span class="font-bold">3.5%</span>
                        </div>
                    </div>
                    <div class="mt-6">
                        <canvas id="geoChart" class="h-40"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="exportModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Export Analytics</h3>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Form√°t</label>
                        <select id="exportFormat" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="pdf">PDF Report</option>
                            <option value="excel">Excel (.xlsx)</option>
                            <option value="csv">CSV Data</option>
                            <option value="json">JSON Data</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Obsah</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2">
                                <span class="text-sm">Overview metriky</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2">
                                <span class="text-sm">Grafy a vizualizace</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">Detailn√≠ data</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">Predikce a trendy</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="cancelExport" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        Zru≈°it
                    </button>
                    <button id="confirmExport" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
                        Exportovat
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-sm w-full mx-4 text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Naƒç√≠t√°m analytics...</h3>
                <p class="text-sm text-gray-600">Zpracov√°v√°m real-time data</p>
            </div>
        </div>
    </div>

    <script>
        let statisticsSystem = null;
        let charts = {};
        let realTimeInterval = null;
        let currentTimeRange = '30d';

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Inicializuji World-Class Statistics...');
            
            lucide.createIcons();
            statisticsSystem = new WorldClassStatistics();
            
            setupEventListeners();
            await initializeCharts();
            await loadInitialData();
            startRealTimeUpdates();
            
            console.log('‚úÖ Statistics Dashboard inicializov√°n');
        });

        function setupEventListeners() {
            // Time range selector
            document.getElementById('timeRangeSelector').addEventListener('change', (e) => {
                currentTimeRange = e.target.value;
                loadAnalyticsData();
            });

            // Comparison selector
            document.getElementById('comparisonSelector').addEventListener('change', loadAnalyticsData);

            // Export
            document.getElementById('exportBtn').addEventListener('click', showExportModal);
            document.getElementById('cancelExport').addEventListener('click', hideExportModal);
            document.getElementById('confirmExport').addEventListener('click', exportAnalytics);

            // Refresh
            document.getElementById('refreshBtn').addEventListener('click', refreshData);

            // Chart period buttons
            document.querySelectorAll('.chart-period-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.chart-period-btn').forEach(b => {
                        b.classList.remove('active', 'bg-purple-100', 'text-purple-600');
                        b.classList.add('text-gray-600', 'hover:bg-gray-100');
                    });
                    
                    e.target.classList.add('active', 'bg-purple-100', 'text-purple-600');
                    e.target.classList.remove('text-gray-600', 'hover:bg-gray-100');
                    
                    updateChartPeriod(e.target.dataset.period);
                });
            });

            // Real-time metrics listener
            window.addEventListener('metricsUpdated', (e) => {
                updateRealTimeMetrics(e.detail);
            });
        }

        async function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            charts.revenue = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: generateDateLabels(30),
                    datasets: [{
                        label: 'Tr≈æby (Kƒç)',
                        data: generateSampleRevenueData(30),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('cs-CZ') + ' Kƒç';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // User Growth Chart
            const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
            charts.userGrowth = new Chart(userGrowthCtx, {
                type: 'bar',
                data: {
                    labels: generateDateLabels(30),
                    datasets: [
                        {
                            label: 'Nov√≠ u≈æivatel√©',
                            data: generateSampleUserData(30),
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        },
                        {
                            label: 'Aktivn√≠ u≈æivatel√©',
                            data: generateSampleActiveUserData(30),
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Campaign Trend Chart (mini)
            const campaignTrendCtx = document.getElementById('campaignTrendChart').getContext('2d');
            charts.campaignTrend = new Chart(campaignTrendCtx, {
                type: 'line',
                data: {
                    labels: generateDateLabels(7),
                    datasets: [{
                        label: '√öspƒõ≈°nost kampan√≠',
                        data: generateSampleCampaignData(7),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Geographic Chart
            const geoCtx = document.getElementById('geoChart').getContext('2d');
            charts.geographic = new Chart(geoCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ƒåesk√° republika', 'Slovensko', 'Ostatn√≠ EU', 'Zbytek svƒõta'],
                    datasets: [{
                        data: [67.8, 18.5, 10.2, 3.5],
                        backgroundColor: ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        async function loadInitialData() {
            showLoading(true);
            
            try {
                const analytics = await statisticsSystem.getComprehensiveAnalytics({
                    timeRange: currentTimeRange,
                    segments: ['overview', 'creators', 'companies', 'campaigns', 'revenue']
                });

                updateDashboard(analytics);
                updateTopCreators(analytics.creators);
                
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
                // Zobrazit demo data
                updateDemoData();
            } finally {
                showLoading(false);
            }
        }

        async function loadAnalyticsData() {
            showLoading(true);
            
            try {
                const comparison = document.getElementById('comparisonSelector').value;
                const analytics = await statisticsSystem.getComprehensiveAnalytics({
                    timeRange: currentTimeRange,
                    compareWith: comparison || null,
                    segments: ['overview', 'creators', 'companies', 'campaigns', 'revenue', 'engagement']
                });

                updateDashboard(analytics);
                updateCharts(analytics);
                
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ analytics:', error);
            } finally {
                showLoading(false);
            }
        }

        function updateDashboard(analytics) {
            if (analytics.overview) {
                const overview = analytics.overview;
                
                document.getElementById('totalUsers').textContent = overview.totalUsers?.toLocaleString('cs-CZ') || '1,250';
                document.getElementById('totalRevenue').textContent = (overview.totalRevenue?.toLocaleString('cs-CZ') || '1,847,650') + ' Kƒç';
                document.getElementById('totalCampaigns').textContent = overview.totalCampaigns?.toString() || '234';
                document.getElementById('customerSatisfaction').textContent = (overview.customerSatisfaction?.toFixed(1) || '4.6') + '/5';
                
                // Growth indicators
                document.getElementById('userGrowth').textContent = `+${overview.userGrowthRate?.toFixed(1) || '15.2'}%`;
                document.getElementById('revenueGrowth').textContent = `+${(overview.revenueGrowth || 23.8).toFixed(1)}%`;
                document.getElementById('campaignSuccess').textContent = `${overview.campaignSuccessRate?.toFixed(1) || '85.7'}%`;
                document.getElementById('satisfactionTrend').textContent = `+${(overview.satisfactionTrend || 0.3).toFixed(1)}`;
            }

            if (analytics.campaigns) {
                const campaigns = analytics.campaigns;
                
                document.getElementById('activeCampaigns').textContent = campaigns.activeCampaigns?.toString() || '45';
                document.getElementById('completedCampaigns').textContent = campaigns.completedCampaigns?.toString() || '189';
                document.getElementById('avgCampaignValue').textContent = (campaigns.avgCampaignValue?.toLocaleString('cs-CZ') || '12,450') + ' Kƒç';
                document.getElementById('campaignROI').textContent = `${(campaigns.roi || 420)}%`;
            }
        }

        function updateTopCreators(creatorAnalytics) {
            const container = document.getElementById('topCreatorsList');
            
            // Demo data pro top creators
            const topCreators = [
                { name: 'EkoInfluencer', followers: '125K', engagement: '6.8%', avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=50&h=50&fit=crop&crop=face' },
                { name: 'TechGuru2025', followers: '89K', engagement: '5.9%', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=50&h=50&fit=crop&crop=face' },
                { name: 'StyleQueen', followers: '156K', engagement: '7.2%', avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=50&h=50&fit=crop&crop=face' },
                { name: 'FoodieExplorer', followers: '78K', engagement: '8.1%', avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=50&h=50&fit=crop&crop=face' },
                { name: 'TravelBlogger', followers: '203K', engagement: '4.5%', avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=50&h=50&fit=crop&crop=face' }
            ];

            container.innerHTML = topCreators.map((creator, index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-xs font-bold text-gray-600">
                            ${index + 1}
                        </div>
                        <img src="${creator.avatar}" alt="${creator.name}" class="w-10 h-10 rounded-full object-cover">
                        <div>
                            <h4 class="font-semibold text-gray-800 text-sm">${creator.name}</h4>
                            <p class="text-xs text-gray-600">${creator.followers} followers</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-purple-600">${creator.engagement}</div>
                        <div class="text-xs text-gray-500">engagement</div>
                    </div>
                </div>
            `).join('');
        }

        function updateCharts(analytics) {
            if (analytics.revenue && charts.revenue) {
                charts.revenue.data.datasets[0].data = generateSampleRevenueData(30);
                charts.revenue.update();
            }

            if (analytics.overview && charts.userGrowth) {
                charts.userGrowth.data.datasets[0].data = generateSampleUserData(30);
                charts.userGrowth.data.datasets[1].data = generateSampleActiveUserData(30);
                charts.userGrowth.update();
            }
        }

        function startRealTimeUpdates() {
            // Aktualizovat ≈æiv√© metriky ka≈æd√Ωch 30 sekund
            realTimeInterval = setInterval(() => {
                updateLiveMetrics();
                updateLastUpdateTime();
            }, 30000);

            updateLastUpdateTime();
        }

        function updateLiveMetrics() {
            // Simulace live dat s mal√Ωmi zmƒõnami
            const currentUsers = parseInt(document.getElementById('liveUsers').textContent);
            const currentRevenue = parseInt(document.getElementById('liveRevenue').textContent.replace(/,/g, ''));
            
            document.getElementById('liveUsers').textContent = Math.max(800, currentUsers + Math.floor(Math.random() * 20 - 10));
            document.getElementById('liveRevenue').textContent = (currentRevenue + Math.floor(Math.random() * 5000)).toLocaleString('cs-CZ');
            
            // Updatovat engagement s animac√≠
            const engagementElement = document.getElementById('liveEngagement');
            const currentEngagement = parseFloat(engagementElement.textContent);
            const newEngagement = Math.max(3.0, Math.min(8.0, currentEngagement + (Math.random() - 0.5) * 0.2));
            engagementElement.textContent = newEngagement.toFixed(1) + '%';
            
            // Blink efekt pro indikaci aktualizace
            document.getElementById('realTimeIndicator').style.backgroundColor = '#22c55e';
            setTimeout(() => {
                document.getElementById('realTimeIndicator').style.backgroundColor = '#4ade80';
            }, 200);
        }

        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = 'pr√°vƒõ teƒè';
        }

        function updateRealTimeMetrics(detail) {
            const { type, data } = detail;
            
            switch (type) {
                case 'revenue':
                    if (data.todayRevenue) {
                        document.getElementById('liveRevenue').textContent = data.todayRevenue.toLocaleString('cs-CZ');
                    }
                    break;
                case 'user':
                    // Update user metrics
                    break;
                case 'campaigns':
                    if (data.totalActive) {
                        document.getElementById('liveCampaigns').textContent = data.totalActive;
                    }
                    break;
            }
        }

        function updateChartPeriod(period) {
            // Aktualizovat grafy podle vybran√©ho obdob√≠
            console.log('Updating chart period:', period);
            
            // Pro demo jen regenerujeme data
            if (charts.revenue) {
                const days = period === 'daily' ? 7 : period === 'weekly' ? 4 : 12;
                charts.revenue.data.labels = generateDateLabels(days, period);
                charts.revenue.data.datasets[0].data = generateSampleRevenueData(days);
                charts.revenue.update();
            }
        }

        async function refreshData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const icon = refreshBtn.querySelector('i');
            
            icon.classList.add('animate-spin');
            
            try {
                await loadAnalyticsData();
                updateLiveMetrics();
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi refreshi:', error);
            } finally {
                setTimeout(() => {
                    icon.classList.remove('animate-spin');
                }, 1000);
            }
        }

        function showExportModal() {
            document.getElementById('exportModal').classList.remove('hidden');
        }

        function hideExportModal() {
            document.getElementById('exportModal').classList.add('hidden');
        }

        async function exportAnalytics() {
            const format = document.getElementById('exportFormat').value;
            const checkboxes = document.querySelectorAll('#exportModal input[type="checkbox"]:checked');
            const selectedSections = Array.from(checkboxes).map(cb => cb.nextElementSibling.textContent.trim());
            
            console.log('Exportuji analytics:', format, selectedSections);
            
            try {
                const reportConfig = {
                    metrics: ['overview', 'creators', 'companies', 'campaigns', 'revenue'],
                    dateRange: currentTimeRange,
                    format: format,
                    includeCharts: selectedSections.includes('Grafy a vizualizace'),
                    includeDetails: selectedSections.includes('Detailn√≠ data'),
                    includePredictions: selectedSections.includes('Predikce a trendy')
                };

                const report = await statisticsSystem.generateCustomReport(reportConfig);
                
                // Pro demo jen zobraz√≠me √∫spƒõch
                showToast('Export √∫spƒõ≈°nƒõ vytvo≈ôen!', 'success');
                hideExportModal();
                
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi exportu:', error);
                showToast('Chyba p≈ôi vytv√°≈ôen√≠ exportu', 'error');
            }
        }

        function updateDemoData() {
            // Fallback demo data pokud sel≈æe naƒç√≠t√°n√≠ z Firebase
            console.log('üìä Zobrazuji demo data');
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        function showToast(message, type = 'success') {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }

        // Utility functions for generating sample data
        function generateDateLabels(count, period = 'daily') {
            const labels = [];
            const now = new Date();
            
            for (let i = count - 1; i >= 0; i--) {
                const date = new Date(now);
                
                if (period === 'daily') {
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('cs-CZ', { day: 'numeric', month: 'short' }));
                } else if (period === 'weekly') {
                    date.setDate(date.getDate() - i * 7);
                    labels.push(`T√Ωden ${Math.ceil((52 - i))}`);
                } else if (period === 'monthly') {
                    date.setMonth(date.getMonth() - i);
                    labels.push(date.toLocaleDateString('cs-CZ', { month: 'short', year: '2-digit' }));
                }
            }
            
            return labels;
        }

        function generateSampleRevenueData(count) {
            const data = [];
            let base = 45000;
            
            for (let i = 0; i < count; i++) {
                base += Math.random() * 10000 - 5000;
                base = Math.max(20000, base);
                data.push(Math.round(base));
            }
            
            return data;
        }

        function generateSampleUserData(count) {
            const data = [];
            let base = 25;
            
            for (let i = 0; i < count; i++) {
                base += Math.random() * 20 - 10;
                base = Math.max(10, base);
                data.push(Math.round(base));
            }
            
            return data;
        }

        function generateSampleActiveUserData(count) {
            const data = [];
            let base = 850;
            
            for (let i = 0; i < count; i++) {
                base += Math.random() * 100 - 50;
                base = Math.max(700, base);
                data.push(Math.round(base));
            }
            
            return data;
        }

        function generateSampleCampaignData(count) {
            const data = [];
            
            for (let i = 0; i < count; i++) {
                data.push(Math.random() * 30 + 70); // 70-100% √∫spƒõ≈°nost
            }
            
            return data;
        }

        // Cleanup p≈ôi zav≈ôen√≠ str√°nky
        window.addEventListener('beforeunload', () => {
            if (realTimeInterval) {
                clearInterval(realTimeInterval);
            }
            
            if (statisticsSystem) {
                statisticsSystem.stopRealTimeMetrics();
            }
        });
    </script>
</body>
</html>