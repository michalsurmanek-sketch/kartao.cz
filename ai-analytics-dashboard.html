<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Anal√Ωzy & Gener√°tor Kampan√≠ - Kartao.cz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide ikony - unified system -->
    <script defer src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
    <script defer src="icons-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="firebase-init.js"></script>
    <script src="auth.js"></script>
    <script src="auth-header.js"></script>
  <script src="credits-system.js"></script>
  <script src="credits-header.js"></script>
    <script src="ai-analytics-system.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <!-- Header -->
        <div class="max-w-7xl mx-auto mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center">
                            <i data-lucide="brain" class="w-8 h-8 mr-3 text-purple-600"></i>
                            AI Anal√Ωzy & Gener√°tor Kampan√≠
                        </h1>
                        <p class="text-gray-600">Inteligentn√≠ syst√©m pro anal√Ωzu v√Ωkonnosti a generov√°n√≠ optimalizovan√Ωch kampan√≠</p>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600" id="analysisCount">0</div>
                        <div class="text-sm text-gray-600">Anal√Ωz provedeno</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Navigation -->
        <div class="max-w-7xl mx-auto mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <nav class="flex space-x-6">
                    <button id="navAnalytics" class="nav-btn active px-6 py-3 rounded-lg font-semibold transition">
                        <i data-lucide="pie-chart" class="w-5 h-5 mr-2"></i>
                        Anal√Ωzy Profil≈Ø
                    </button>
                    <button id="navCampaigns" class="nav-btn px-6 py-3 rounded-lg font-semibold transition">
                        <i data-lucide="target" class="w-5 h-5 mr-2"></i>
                        Gener√°tor Kampan√≠
                    </button>
                    <button id="navInsights" class="nav-btn px-6 py-3 rounded-lg font-semibold transition">
                        <i data-lucide="lightbulb" class="w-5 h-5 mr-2"></i>
                        AI Insights
                    </button>
                    <button id="navTrends" class="nav-btn px-6 py-3 rounded-lg font-semibold transition">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i>
                        Market Trends
                    </button>
                </nav>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="max-w-7xl mx-auto space-y-8">
            <!-- Creator Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üéØ Anal√Ωza Profilu</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vyberte tv≈Ørce</label>
                            <select id="creatorAnalysisSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Naƒç√≠t√°n√≠ tv≈Ørc≈Ø...</option>
                            </select>
                        </div>

                        <button id="analyzeProfileBtn" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:shadow-lg transition duration-300 flex items-center justify-center">
                            <i data-lucide="search" class="w-5 h-5 mr-2"></i>
                            Analyzovat Profil
                        </button>

                        <!-- Quick Stats -->
                        <div class="mt-6 space-y-3">
                            <div class="p-3 bg-purple-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-purple-600">Celkov√© sk√≥re</span>
                                    <span class="text-lg font-bold text-purple-800" id="overallScore">-</span>
                                </div>
                                <div class="w-full bg-purple-200 rounded-full h-2 mt-2">
                                    <div id="overallScoreBar" class="bg-purple-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">üìä V√Ωsledky Anal√Ωzy</h3>
                    
                    <div id="analysisResults" class="hidden">
                        <!-- Analysis breakdown will be populated here -->
                    </div>

                    <div id="analysisPlaceholder" class="text-center py-12 text-gray-500">
                        <i data-lucide="search" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                        <p class="text-lg">Vyberte tv≈Ørce a spus≈•te anal√Ωzu</p>
                        <p class="text-sm">AI vyhodnot√≠ profil, obsah a engagement vzorce</p>
                    </div>
                </div>
            </div>

            <!-- Detailed Analytics Charts -->
            <div id="chartsSection" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">üìà Engagement Trendy</h4>
                    <canvas id="engagementChart" width="400" height="300"></canvas>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">üë• Anal√Ωza Publika</h4>
                    <canvas id="audienceChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Campaign Generator Section -->
        <div id="campaignsSection" class="max-w-7xl mx-auto space-y-8 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Campaign Brief Form -->
                <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üé¨ Nov√° Kampa≈à</h3>
                    
                    <form id="campaignForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">C√≠l kampanƒõ</label>
                            <select id="campaignObjective" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="brand_awareness">Brand Awareness</option>
                                <option value="product_launch">Product Launch</option>
                                <option value="engagement_boost">Engagement Boost</option>
                                <option value="lead_generation">Lead Generation</option>
                                <option value="sales_conversion">Sales Conversion</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Kategorie</label>
                            <select id="campaignCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="beauty">Beauty</option>
                                <option value="fitness">Fitness</option>
                                <option value="tech">Tech</option>
                                <option value="food">Food</option>
                                <option value="travel">Travel</option>
                                <option value="lifestyle">Lifestyle</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Platforma</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" value="instagram" class="platform-checkbox mr-2">
                                    <span class="text-sm">Instagram</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="tiktok" class="platform-checkbox mr-2">
                                    <span class="text-sm">TikTok</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="youtube" class="platform-checkbox mr-2">
                                    <span class="text-sm">YouTube</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Doba trv√°n√≠ (dny)</label>
                            <input type="number" id="campaignDuration" value="14" min="3" max="90" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rozpoƒçet (Kƒç)</label>
                            <input type="number" id="campaignBudget" value="15000" min="1000" step="1000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Kl√≠ƒçov√° zpr√°va</label>
                            <textarea id="campaignMessage" rows="3" placeholder="Hlavn√≠ message kampanƒõ..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:shadow-lg transition duration-300 flex items-center justify-center">
                            <i data-lucide="wand" class="w-5 h-5 mr-2"></i>
                            Vygenerovat Kampa≈à
                        </button>
                    </form>
                </div>

                <!-- Generated Campaign -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">üéØ Vygenerovan√° Kampa≈à</h3>
                    
                    <div id="campaignResults" class="hidden">
                        <!-- Campaign details will be populated here -->
                    </div>

                    <div id="campaignPlaceholder" class="text-center py-12 text-gray-500">
                        <i data-lucide="wand" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                        <p class="text-lg">Vypl≈àte brief a vygenerujte kampa≈à</p>
                        <p class="text-sm">AI vytvo≈ô√≠ kompletn√≠ strategii, content pl√°n a timeline</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Insights Section -->
        <div id="insightsSection" class="max-w-7xl mx-auto space-y-8 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Market Insights -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="lightbulb" class="w-5 h-5 mr-2 text-yellow-500"></i>
                        Market Insights
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                            <h4 class="font-bold text-yellow-800 mb-2">üí° Trending Now</h4>
                            <p class="text-sm text-yellow-800">Beauty influence≈ôi s tutorial obsahem dosahuj√≠ o 35% vy≈°≈°√≠ho engagementu ne≈æ pouze lifestyle posty.</p>
                        </div>
                        
                        <div class="p-4 bg-green-50 border-l-4 border-green-500 rounded">
                            <h4 class="font-bold text-green-800 mb-2">üìà Growth Opportunity</h4>
                            <p class="text-sm text-green-800">TikTok kampagje s micro-influencery (1K-10K followers) maj√≠ 3x vy≈°≈°√≠ conversion rate ne≈æ macro kampanƒõ.</p>
                        </div>
                        
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                            <h4 class="font-bold text-blue-800 mb-2">üéØ Best Practice</h4>
                            <p class="text-sm text-blue-800">Optim√°ln√≠ posting ƒças pro ƒçesk√Ω trh: 18:00-20:00 bƒõhem pracovn√≠ho t√Ωdne, 10:00-12:00 o v√≠kendech.</p>
                        </div>
                    </div>
                </div>

                <!-- Performance Benchmarks -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="bar-chart" class="w-5 h-5 mr-2 text-blue-500"></i>
                        Performance Benchmarks
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium">Instagram Engagement Rate</span>
                            <span class="font-bold text-blue-600">2.8% pr≈Ømƒõr</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium">TikTok Engagement Rate</span>
                            <span class="font-bold text-blue-600">5.2% pr≈Ømƒõr</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium">YouTube Engagement Rate</span>
                            <span class="font-bold text-blue-600">1.8% pr≈Ømƒõr</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium">Pr≈Ømƒõrn√° cena (Instagram Post)</span>
                            <span class="font-bold text-blue-600">2,800 Kƒç</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Recommendations -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ü§ñ AI Doporuƒçen√≠ pro Tv≈Ørce</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg">
                        <i data-lucide="camera" class="w-8 h-8 mx-auto mb-3 text-purple-600"></i>
                        <h4 class="font-bold text-gray-800 mb-2">Content Optimization</h4>
                        <p class="text-sm text-gray-600">Vyu≈æij AI anal√Ωzu pro identifikaci nejlep≈°√≠ch ƒças≈Ø a typ≈Ø obsahu pro tv√© publikum.</p>
                    </div>
                    
                    <div class="text-center p-4 bg-gradient-to-br from-green-50 to-teal-50 rounded-lg">
                        <i data-lucide="users" class="w-8 h-8 mx-auto mb-3 text-green-600"></i>
                        <h4 class="font-bold text-gray-800 mb-2">Audience Growth</h4>
                        <p class="text-sm text-gray-600">Strategie pro organic r≈Øst zalo≈æen√© na anal√Ωze √∫spƒõ≈°n√Ωch konkurent≈Ø.</p>
                    </div>
                    
                    <div class="text-center p-4 bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg">
                        <i data-lucide="dollar-sign" class="w-8 h-8 mx-auto mb-3 text-yellow-600"></i>
                        <h4 class="font-bold text-gray-800 mb-2">Revenue Optimization</h4>
                        <p class="text-sm text-gray-600">Maximalizuj p≈ô√≠jmy pomoc√≠ AI doporuƒçen√≠ pro pricing a partnership strategy.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Trends Section -->
        <div id="trendsSection" class="max-w-7xl mx-auto space-y-8 hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">üìä Market Intelligence Dashboard</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                    <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600 mb-1">1,247</div>
                        <div class="text-sm text-gray-600">Aktivn√≠ tv≈Ørci</div>
                        <div class="text-xs text-green-600 mt-1">+12% tento mƒõs√≠c</div>
                    </div>
                    
                    <div class="text-center p-4 bg-gradient-to-br from-green-50 to-teal-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600 mb-1">2,890 Kƒç</div>
                        <div class="text-sm text-gray-600">Pr≈Ømƒõrn√° cena</div>
                        <div class="text-xs text-green-600 mt-1">+8% tento mƒõs√≠c</div>
                    </div>
                    
                    <div class="text-center p-4 bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg">
                        <div class="text-2xl font-bold text-yellow-600 mb-1">3.2%</div>
                        <div class="text-sm text-gray-600">Avg. engagement</div>
                        <div class="text-xs text-red-600 mt-1">-2% tento mƒõs√≠c</div>
                    </div>
                    
                    <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600 mb-1">847</div>
                        <div class="text-sm text-gray-600">Aktivn√≠ kampanƒõ</div>
                        <div class="text-xs text-green-600 mt-1">+15% tento mƒõs√≠c</div>
                    </div>
                </div>

                <!-- Category Performance -->
                <div class="bg-gray-50 rounded-xl p-6">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">Performance podle kategori√≠</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800">Beauty & Fashion</span>
                                <span class="text-sm text-green-600 font-semibold">+18%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-pink-500 h-2 rounded-full" style="width: 85%"></div>
                            </div>
                            <div class="text-xs text-gray-600 mt-1">Engagement: 4.2% | Avg. cena: 3,200 Kƒç</div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800">Fitness & Health</span>
                                <span class="text-sm text-green-600 font-semibold">+12%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 78%"></div>
                            </div>
                            <div class="text-xs text-gray-600 mt-1">Engagement: 3.8% | Avg. cena: 2,900 Kƒç</div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800">Tech & Gaming</span>
                                <span class="text-sm text-red-600 font-semibold">-5%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 65%"></div>
                            </div>
                            <div class="text-xs text-gray-600 mt-1">Engagement: 2.1% | Avg. cena: 3,100 Kƒç</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-sm w-full mx-4 text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">AI pracuje...</h3>
                <p class="text-sm text-gray-600" id="loadingText">Analyzuji profil a generuji doporuƒçen√≠</p>
            </div>
        </div>
    </div>

    <script>
        let analyticsSystem = null;
        let currentAnalysis = null;
        let engagementChart = null;
        let audienceChart = null;

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Inicializuji AI Analytics Dashboard...');
            
            lucide.createIcons();
            
            kartaoAuth.onAuthStateChanged(async (user) => {
                if (user) {
                    await initializeSystem();
                } else {
                    console.log('üë§ U≈æivatel nen√≠ p≈ôihl√°≈°en');
                }
            });
        });

        async function initializeSystem() {
            try {
                analyticsSystem = new AIAnalyticsSystem();
                await loadCreators();
                setupEventListeners();
                loadAnalysisCount();
                console.log('‚úÖ AI Analytics System inicializov√°n');
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi inicializaci:', error);
            }
        }

        async function loadCreators() {
            try {
                const select = document.getElementById('creatorAnalysisSelect');
                const snapshot = await firebase.firestore().collection('creators')
                    .where('role', '==', 'tvurce')
                    .orderBy('displayName')
                    .get();

                select.innerHTML = '<option value="">Vyberte tv≈Ørce</option>';
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = `${data.displayName} (${data.category || 'Bez kategorie'})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ tv≈Ørc≈Ø:', error);
            }
        }

        async function loadAnalysisCount() {
            try {
                const snapshot = await firebase.firestore().collection('creatorAnalytics').get();
                document.getElementById('analysisCount').textContent = snapshot.docs.length;
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ poƒçtu anal√Ωz:', error);
            }
        }

        function setupEventListeners() {
            // Navigation
            document.getElementById('navAnalytics').addEventListener('click', () => showSection('analytics'));
            document.getElementById('navCampaigns').addEventListener('click', () => showSection('campaigns'));
            document.getElementById('navInsights').addEventListener('click', () => showSection('insights'));
            document.getElementById('navTrends').addEventListener('click', () => showSection('trends'));

            // Analytics
            document.getElementById('analyzeProfileBtn').addEventListener('click', analyzeProfile);

            // Campaign Generator
            document.getElementById('campaignForm').addEventListener('submit', generateCampaign);
        }

        function showSection(section) {
            // Hide all sections
            document.getElementById('analyticsSection').classList.add('hidden');
            document.getElementById('campaignsSection').classList.add('hidden');
            document.getElementById('insightsSection').classList.add('hidden');
            document.getElementById('trendsSection').classList.add('hidden');

            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-600', 'text-white');
                btn.classList.add('text-gray-600', 'hover:bg-gray-100');
            });

            // Show selected section
            document.getElementById(`${section}Section`).classList.remove('hidden');

            // Activate nav button
            const activeBtn = document.getElementById(`nav${section.charAt(0).toUpperCase() + section.slice(1)}`);
            activeBtn.classList.add('active', 'bg-purple-600', 'text-white');
            activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
        }

        async function analyzeProfile() {
            const creatorId = document.getElementById('creatorAnalysisSelect').value;
            
            if (!creatorId) {
                alert('Pros√≠m vyberte tv≈Ørce');
                return;
            }

            showLoading(true, 'Analyzuji profil...');

            try {
                const analysis = await analyticsSystem.analyzeCreatorProfile(creatorId);
                currentAnalysis = analysis;
                displayAnalysisResults(analysis);
                updateOverallScore(analysis.score);
                showChartsSection();
                createCharts(analysis);

            } catch (error) {
                console.error('‚ùå Chyba p≈ôi anal√Ωze:', error);
                alert('Nastala chyba p≈ôi anal√Ωze profilu: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayAnalysisResults(analysis) {
            const container = document.getElementById('analysisResults');
            const placeholder = document.getElementById('analysisPlaceholder');
            
            placeholder.classList.add('hidden');
            container.classList.remove('hidden');

            container.innerHTML = `
                <!-- Profile Analysis -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-gray-800 mb-3">üìã Profil</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">√öplnost:</span>
                                <span class="font-semibold">${analysis.profile.completeness}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Autenticita:</span>
                                <span class="font-semibold">${analysis.profile.authenticity}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Profesionalita:</span>
                                <span class="font-semibold">${analysis.profile.professionalism}%</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-gray-800 mb-3">üìä Obsah</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Celkem post≈Ø:</span>
                                <span class="font-semibold">${analysis.content.totalPosts}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Avg. engagement:</span>
                                <span class="font-semibold">${analysis.content.avgEngagement?.toFixed(2)}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Trend:</span>
                                <span class="font-semibold">${this.getTrendEmoji(analysis.content.trends)} ${analysis.content.trends}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Opportunities -->
                <div class="mb-6">
                    <h4 class="font-bold text-gray-800 mb-3">üéØ P≈ô√≠le≈æitosti pro zlep≈°en√≠</h4>
                    <div class="space-y-3">
                        ${analysis.opportunities.slice(0, 3).map(opp => `
                            <div class="p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h5 class="font-semibold text-blue-800">${opp.title}</h5>
                                        <p class="text-sm text-blue-700">${opp.description}</p>
                                    </div>
                                    <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded">${opp.priority}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Recommendations -->
                <div>
                    <h4 class="font-bold text-gray-800 mb-3">üí° AI Doporuƒçen√≠</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${analysis.recommendations.slice(0, 4).map(rec => `
                            <div class="p-3 bg-green-50 rounded-lg">
                                <h5 class="font-semibold text-green-800 mb-1">${rec.category}</h5>
                                <p class="text-sm text-green-700">${rec.recommendation}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getTrendEmoji(trend) {
            switch(trend) {
                case 'improving': return 'üìà';
                case 'declining': return 'üìâ';
                case 'stable': return '‚û°Ô∏è';
                default: return '‚ùì';
            }
        }

        function updateOverallScore(score) {
            document.getElementById('overallScore').textContent = `${score}/100`;
            document.getElementById('overallScoreBar').style.width = `${score}%`;
        }

        function showChartsSection() {
            document.getElementById('chartsSection').classList.remove('hidden');
        }

        function createCharts(analysis) {
            createEngagementChart(analysis);
            createAudienceChart(analysis);
        }

        function createEngagementChart(analysis) {
            const ctx = document.getElementById('engagementChart').getContext('2d');
            
            if (engagementChart) {
                engagementChart.destroy();
            }

            engagementChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'M√°≈ô', 'Dub', 'Kvƒõ', 'ƒåer'],
                    datasets: [{
                        label: 'Engagement Rate',
                        data: [2.1, 2.5, 3.2, 2.8, 3.5, analysis.content.avgEngagement],
                        borderColor: 'rgb(147, 51, 234)',
                        backgroundColor: 'rgba(147, 51, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        function createAudienceChart(analysis) {
            const ctx = document.getElementById('audienceChart').getContext('2d');
            
            if (audienceChart) {
                audienceChart.destroy();
            }

            const demographics = analysis.audience.demographics.age;

            audienceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(demographics),
                    datasets: [{
                        data: Object.values(demographics),
                        backgroundColor: [
                            'rgb(239, 68, 68)',
                            'rgb(245, 158, 11)',
                            'rgb(34, 197, 94)',
                            'rgb(59, 130, 246)',
                            'rgb(147, 51, 234)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        async function generateCampaign(e) {
            e.preventDefault();
            
            showLoading(true, 'Generuji kampa≈à...');

            try {
                const brief = {
                    objective: document.getElementById('campaignObjective').value,
                    category: document.getElementById('campaignCategory').value,
                    platforms: Array.from(document.querySelectorAll('.platform-checkbox:checked')).map(cb => cb.value),
                    duration: parseInt(document.getElementById('campaignDuration').value),
                    budget: parseInt(document.getElementById('campaignBudget').value),
                    keyMessage: document.getElementById('campaignMessage').value
                };

                if (brief.platforms.length === 0) {
                    alert('Vyberte alespo≈à jednu platformu');
                    return;
                }

                const campaign = await analyticsSystem.generateCampaign(brief);
                displayCampaignResults(campaign);

            } catch (error) {
                console.error('‚ùå Chyba p≈ôi generov√°n√≠ kampanƒõ:', error);
                alert('Nastala chyba p≈ôi generov√°n√≠ kampanƒõ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayCampaignResults(campaign) {
            const container = document.getElementById('campaignResults');
            const placeholder = document.getElementById('campaignPlaceholder');
            
            placeholder.classList.add('hidden');
            container.classList.remove('hidden');

            container.innerHTML = `
                <div class="space-y-6">
                    <!-- Campaign Overview -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">üìã P≈ôehled Kampanƒõ</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">C√≠l:</h5>
                                <p class="text-sm text-gray-600">${campaign.strategy.objective}</p>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">P≈ô√≠stup:</h5>
                                <p class="text-sm text-gray-600">${campaign.strategy.approach}</p>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Doba trv√°n√≠:</h5>
                                <p class="text-sm text-gray-600">${campaign.strategy.duration}</p>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Rozpoƒçet:</h5>
                                <p class="text-sm text-gray-600">${campaign.budget.total.toLocaleString()} Kƒç</p>
                            </div>
                        </div>
                    </div>

                    <!-- Content Calendar -->
                    <div class="bg-white border rounded-xl p-6">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">üìÖ Content Kalend√°≈ô</h4>
                        <div class="space-y-3">
                            ${campaign.content.calendar.slice(0, 5).map(post => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-xs font-bold text-blue-600">
                                            ${post.day}
                                        </div>
                                        <div>
                                            <h5 class="font-semibold text-sm">${post.title}</h5>
                                            <p class="text-xs text-gray-600">${post.description}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs font-semibold text-gray-700">${post.platform.toUpperCase()}</div>
                                        <div class="text-xs text-gray-600">${post.date}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="text-center mt-4">
                            <button class="text-blue-600 text-sm font-semibold hover:text-blue-800">
                                Zobrazit cel√Ω kalend√°≈ô (${campaign.content.totalPosts} post≈Ø)
                            </button>
                        </div>
                    </div>

                    <!-- KPIs and Budget -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white border rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-800 mb-4">üéØ KPI C√≠le</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Dosah:</span>
                                    <span class="font-semibold">${campaign.kpis.targets.reach.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Impressions:</span>
                                    <span class="font-semibold">${campaign.kpis.targets.impressions.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Engagement Rate:</span>
                                    <span class="font-semibold">${campaign.kpis.targets.engagement_rate}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Kliky:</span>
                                    <span class="font-semibold">${campaign.kpis.targets.clicks.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white border rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-800 mb-4">üí∞ Rozpoƒçet</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Odmƒõna tv≈Ørce:</span>
                                    <span class="font-semibold">${campaign.budget.breakdown.creatorFee.toLocaleString()} Kƒç</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Produkce:</span>
                                    <span class="font-semibold">${campaign.budget.breakdown.production.toLocaleString()} Kƒç</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Promoce:</span>
                                    <span class="font-semibold">${campaign.budget.breakdown.promotion.toLocaleString()} Kƒç</span>
                                </div>
                                <div class="flex justify-between border-t pt-2">
                                    <span class="font-semibold text-gray-800">Celkem:</span>
                                    <span class="font-bold text-blue-600">${campaign.budget.total.toLocaleString()} Kƒç</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Download Campaign -->
                    <div class="text-center">
                        <button onclick="downloadCampaign('${campaign.id}')" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition duration-300">
                            <i data-lucide="download" class="w-5 h-5 mr-2 inline"></i>
                            St√°hnout kompletn√≠ kampa≈à
                        </button>
                    </div>
                </div>
            `;

            // Re-initialize Lucide icons for new content
            lucide.createIcons();
        }

        function downloadCampaign(campaignId) {
            // Placeholder for campaign download
            alert('üìÑ Download kampanƒõ bude implementov√°n v dal≈°√≠ verzi');
        }

        function showLoading(show, text = 'Zpracov√°v√°no...') {
            const overlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            if (show) {
                loadingText.textContent = text;
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        // CSS for nav buttons
        const style = document.createElement('style');
        style.textContent = `
            .nav-btn {
                display: flex;
                align-items: center;
                color: #6b7280;
            }
            .nav-btn:hover {
                background-color: #f3f4f6;
            }
            .nav-btn.active {
                background-color: #9333ea;
                color: white;
            }
        `;
        document.head.appendChild(style);
    </script>
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="supabase-init.js"></script>
  <script src="auth-supabase.js"></script>
  <script src="credits-system-supabase.js"></script>
  <script src="credits-header.js"></script>

</body>
</html>