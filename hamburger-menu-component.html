<!-- UNIVERZÁLNÍ HAMBURGER MENU PRO VŠECHNY STRÁNKY -->
<button id="menuToggle" aria-controls="mobileMenu" aria-expanded="false" class="md:hidden inline-flex items-center justify-center w-11 h-11 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition">
  <i data-lucide="menu" class="w-6 h-6"></i>
  <span class="sr-only">Otevřít menu</span>
</button>

<!-- MOBILNÍ MENU -->
<div id="mobileMenu" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
  <div id="menuBackdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>

  <div class="relative h-full svh flex flex-col items-stretch">
    <div id="menuPanel" class="mr-auto w-[92%] max-w-sm h-full bg-neutral-950/95 border-r border-white/10 shadow-soft -translate-x-full transition-transform duration-300 ease-in-out">
      <div class="px-4 py-4 flex items-center justify-between border-b border-white/10">
        <a href="index.html" class="flex items-center gap-3 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/50 rounded-xl">
          <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
            <i data-lucide="crown" class="w-5 h-5"></i>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span class="font-semibold text-base">Kartao.cz</span>
              <span class="px-2 py-0.5 rounded-full text-[10px] bg-fuchsia-500/15 text-fuchsia-200 border border-fuchsia-400/40">
                Menu
              </span>
            </div>
            <p class="text-[11px] text-white/60">Síť influencerů</p>
          </div>
        </a>
        <button id="menuClose" class="inline-flex w-10 h-10 items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/50">
          <i data-lucide="x" class="w-5 h-5"></i>
          <span class="sr-only">Zavřít</span>
        </button>
      </div>

      <nav class="px-3 py-3 overflow-y-auto flex-1">
        <!-- Hlavní navigace -->
        <div class="pb-2 mb-2 border-b border-white/10">
          <div class="text-xs font-medium text-white/50 px-3 py-2 uppercase tracking-wide">Hlavní menu</div>
          <a href="index.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="home" class="w-5 h-5 text-white/70"></i>
            <span>Domů</span>
          </a>
          <a href="kartao-marketplace.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="briefcase" class="w-5 h-5 text-white/70"></i>
            <span>Kampaně</span>
          </a>
          <a href="kartao-pro-tvurce.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="user-plus" class="w-5 h-5 text-white/70"></i>
            <span>Pro tvůrce</span>
          </a>
          <a href="kartao-pro-firmy.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="building" class="w-5 h-5 text-white/70"></i>
            <span>Pro firmy</span>
          </a>
        </div>
        
        <!-- Účet a akce -->
        <div class="pb-2 mb-2 border-b border-white/10">
          <div class="text-xs font-medium text-white/50 px-3 py-2 uppercase tracking-wide">Účet</div>
          
          <!-- Pro nepřihlášené -->
          <div id="menu-not-logged-in">
            <a href="zalozit-kartu.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
              <i data-lucide="id-card" class="w-5 h-5 text-white/70"></i>
              <span>Založit kartu</span>
              <span class="ml-auto px-2 py-1 bg-gradient-to-r from-fuchsia-500 to-amber-400 text-xs font-bold rounded-full">ZDARMA</span>
            </a>
            <a href="login.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
              <i data-lucide="log-in" class="w-5 h-5 text-white/70"></i>
              <span>Přihlásit se</span>
            </a>
          </div>
          
          <!-- Pro přihlášené -->
          <div id="menu-logged-in" class="hidden">
            <div class="px-3 py-2 rounded-xl bg-white/5 mb-2">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-fuchsia-500 to-amber-400 flex items-center justify-center text-sm font-bold" id="menu-user-avatar">
                  ?
                </div>
                <div class="flex-1 min-w-0">
                  <div class="text-sm font-medium truncate" id="menu-user-name">Načítám...</div>
                  <div class="text-xs text-white/50 truncate" id="menu-user-email">-</div>
                </div>
              </div>
            </div>
            
            <a href="kartao-muj-ucet.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
              <i data-lucide="user" class="w-5 h-5 text-white/70"></i>
              <span>Můj účet</span>
            </a>
            
            <a href="zalozit-kartu.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
              <i data-lucide="id-card" class="w-5 h-5 text-white/70"></i>
              <span>Moje karty</span>
            </a>
            
            <button id="menu-logout-btn" class="w-full text-left px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
              <i data-lucide="log-out" class="w-5 h-5 text-white/70"></i>
              <span>Odhlásit se</span>
            </button>
          </div>
        </div>

        <!-- Dashboard sekce -->
        <div class="pb-2 mb-2 border-b border-white/10">
          <div class="text-xs font-medium text-white/50 px-3 py-2 uppercase tracking-wide">Dashboard</div>
          <a href="moje-karta.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="user" class="w-5 h-5 text-white/70"></i>
            <span>Moje karta</span>
          </a>
          <a href="zalozit-kartu.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="edit" class="w-5 h-5 text-white/70"></i>
            <span>Upravit kartu</span>
          </a>
          <a href="firm-dashboard.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="briefcase" class="w-5 h-5 text-white/70"></i>
            <span>Dashboard firmy</span>
          </a>
          <a href="chat.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="message-circle" class="w-5 h-5 text-white/70"></i>
            <span>Chat</span>
          </a>
          <a href="order-management.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="package" class="w-5 h-5 text-white/70"></i>
            <span>Objednávky</span>
          </a>
          <a href="earnings-management.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="dollar-sign" class="w-5 h-5 text-white/70"></i>
            <span>Správa příjmů</span>
          </a>
        </div>
        
        <!-- Obsah a informace -->
        <div class="pb-2 mb-2">
          <div class="text-xs font-medium text-white/50 px-3 py-2 uppercase tracking-wide">Obsah</div>
          <a href="kartao-magazin.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="newspaper" class="w-5 h-5 text-white/70"></i>
            <span>Magazín</span>
          </a>
          <a href="kartao-recenze.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="star" class="w-5 h-5 text-white/70"></i>
            <span>Recenze</span>
          </a>
          <a href="kartao-faq.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="help-circle" class="w-5 h-5 text-white/70"></i>
            <span>FAQ</span>
          </a>
          <a href="kartao-o-nas.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="info" class="w-5 h-5 text-white/70"></i>
            <span>O nás</span>
          </a>
          <a href="kontakt.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="mail" class="w-5 h-5 text-white/70"></i>
            <span>Kontakt</span>
          </a>
          <a href="vip.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="crown" class="w-5 h-5 text-amber-400"></i>
            <span>VIP</span>
          </a>
        </div>

        <!-- Extra sekce -->
        <div class="pt-2 border-t border-white/10">
          <div class="text-xs font-medium text-white/50 px-3 py-2 uppercase tracking-wide">Další</div>
          <a href="kartao-cenik.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="tag" class="w-5 h-5 text-white/70"></i>
            <span>Ceník</span>
          </a>
          <a href="podminky.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="file-text" class="w-5 h-5 text-white/70"></i>
            <span>Podmínky</span>
          </a>
          <a href="ochrana-soukromi.html" class="block px-3 py-3 rounded-xl hover:bg-white/5 transition text-white/90 flex items-center gap-3">
            <i data-lucide="shield" class="w-5 h-5 text-white/70"></i>
            <span>Ochrana soukromí</span>
          </a>
        </div>
      </nav>
    </div>
  </div>
</div>

<!-- HAMBURGER MENU JAVASCRIPT -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const menuClose = document.getElementById('menuClose');
    const menuBackdrop = document.getElementById('menuBackdrop');

    function openMenu() {
      mobileMenu.classList.remove('hidden');
      // Force reflow
      mobileMenu.offsetHeight;
      document.getElementById('menuPanel').classList.remove('-translate-x-full');
      menuBackdrop.classList.remove('opacity-0');
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    function closeMenu() {
      document.getElementById('menuPanel').classList.add('-translate-x-full');
      menuBackdrop.classList.add('opacity-0');
      setTimeout(() => {
        mobileMenu.classList.add('hidden');
        document.body.style.overflow = ''; // Re-enable scrolling
      }, 300); // Match transition duration
    }

    // Event listeners for menu
    menuToggle?.addEventListener('click', openMenu);
    menuClose?.addEventListener('click', closeMenu);
    menuBackdrop?.addEventListener('click', closeMenu);

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
        closeMenu();
      }
    });

    // Close menu when clicking on nav links
    const mobileNavLinks = mobileMenu?.querySelectorAll('a');
    mobileNavLinks?.forEach(link => {
      link.addEventListener('click', () => {
        if (link.getAttribute('href')?.startsWith('#') || link.getAttribute('onclick')) {
          setTimeout(() => closeMenu(), 100);
        } else {
          closeMenu();
        }
      });
    });
    
    // ============================================
    // AUTH STATE LISTENER - Dynamické zobrazení
    // ============================================
    if (window.kartaoAuth && kartaoAuth.onAuthStateChanged) {
      kartaoAuth.onAuthStateChanged((user) => {
        const notLoggedIn = document.getElementById('menu-not-logged-in');
        const loggedIn = document.getElementById('menu-logged-in');
        if (user) {
          if (notLoggedIn) notLoggedIn.classList.add('hidden');
          if (loggedIn) loggedIn.classList.remove('hidden');
          const userName = document.getElementById('menu-user-name');
          const userEmail = document.getElementById('menu-user-email');
          const userAvatar = document.getElementById('menu-user-avatar');
          if (userName) userName.textContent = user.displayName || 'Uživatel';
          if (userEmail) userEmail.textContent = user.email || '';
          if (userAvatar) {
            const initial = (user.displayName || user.email || '?')[0].toUpperCase();
            userAvatar.textContent = initial;
          }
          if (typeof lucide !== 'undefined') {
          }
        } else {
          if (notLoggedIn) notLoggedIn.classList.remove('hidden');
          if (loggedIn) loggedIn.classList.add('hidden');
        }
      });
      const logoutBtn = document.getElementById('menu-logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async () => {
          try {
            await kartaoAuth.logout();
            closeMenu();
            window.location.href = 'index.html';
          } catch (error) {
            console.error('Chyba při odhlášení:', error);
            alert('Chyba při odhlášení');
          }
        });
      }
    }
  });
</script>

<script src="auth.js"></script>
<script src="credits-header.js"></script>