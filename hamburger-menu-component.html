<!-- UNIVERZÁLNÍ HAMBURGER MENU PRO VŠECHNY STRÁNKY -->
<button id="menuToggle" aria-controls="mobileMenu" aria-expanded="false" class="md:hidden inline-flex items-center justify-center w-11 h-11 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition">
  <i data-lucide="menu" class="w-6 h-6"></i>
  <span class="sr-only">Otevřít menu</span>
</button>

<!-- MOBILNÍ MENU -->
<div id="mobileMenu" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
  <div id="menuBackdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>

  <div class="relative h-full svh flex flex-col items-stretch">
    <div id="menuPanel" class="mr-auto w-[92%] max-w-sm h-full bg-neutral-950/95 border-r border-white/10 shadow-soft -translate-x-full transition-transform duration-300 ease-in-out">
      <div class="px-4 py-4 flex items-center justify-between border-b border-white/10">
        <a href="index.html" class="flex items-center gap-3 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/50 rounded-xl">
          <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
            <i data-lucide="crown" class="w-5 h-5"></i>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span class="font-semibold text-base">Kartao.cz</span>
              <span class="px-2 py-0.5 rounded-full text-[10px] bg-fuchsia-500/15 text-fuchsia-200 border border-fuchsia-400/40">
                Menu
              </span>
            </div>
            <p class="text-[11px] text-white/60">Síť influencerů</p>
          </div>
        </a>
        <button id="menuClose" class="inline-flex w-10 h-10 items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/50">
          <i data-lucide="x" class="w-5 h-5"></i>
          <span class="sr-only">Zavřít</span>
        </button>
      </div>

      <!-- Dynamický obsah menu generovaný JS -->
      <div id="menuContent" class="overflow-y-auto flex-1"></div>
    </div>
  </div>
</div>

<!-- HAMBURGER MENU JAVASCRIPT -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const menuClose = document.getElementById('menuClose');
    const menuBackdrop = document.getElementById('menuBackdrop');

    function openMenu() {
      mobileMenu.classList.remove('hidden');
      // Force reflow
      mobileMenu.offsetHeight;
      document.getElementById('menuPanel').classList.remove('-translate-x-full');
      menuBackdrop.classList.remove('opacity-0');
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    function closeMenu() {
      document.getElementById('menuPanel').classList.add('-translate-x-full');
      menuBackdrop.classList.add('opacity-0');
      setTimeout(() => {
        mobileMenu.classList.add('hidden');
        document.body.style.overflow = ''; // Re-enable scrolling
      }, 300); // Match transition duration
    }

    // Event listeners for menu
    menuToggle?.addEventListener('click', openMenu);
    menuClose?.addEventListener('click', closeMenu);
    menuBackdrop?.addEventListener('click', closeMenu);

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
        closeMenu();
      }
    });

    // Close menu when clicking on nav links
    const mobileNavLinks = mobileMenu?.querySelectorAll('a');
    mobileNavLinks?.forEach(link => {
      link.addEventListener('click', () => {
        if (link.getAttribute('href')?.startsWith('#') || link.getAttribute('onclick')) {
          setTimeout(() => closeMenu(), 100);
        } else {
          closeMenu();
        }
      });
    });
    
    // ============================================
    // AUTH STATE LISTENER - Dynamické zobrazení
    // ============================================
    if (window.kartaoAuth && kartaoAuth.onAuthStateChanged) {
      kartaoAuth.onAuthStateChanged((user) => {
        const notLoggedIn = document.getElementById('menu-not-logged-in');
        const loggedIn = document.getElementById('menu-logged-in');
        if (user) {
          if (notLoggedIn) notLoggedIn.classList.add('hidden');
          if (loggedIn) loggedIn.classList.remove('hidden');
          const userName = document.getElementById('menu-user-name');
          const userEmail = document.getElementById('menu-user-email');
          const userAvatar = document.getElementById('menu-user-avatar');
          if (userName) userName.textContent = user.displayName || 'Uživatel';
          if (userEmail) userEmail.textContent = user.email || '';
          if (userAvatar) {
            const initial = (user.displayName || user.email || '?')[0].toUpperCase();
            userAvatar.textContent = initial;
          }
          if (typeof lucide !== 'undefined') {
          }
        } else {
          if (notLoggedIn) notLoggedIn.classList.remove('hidden');
          if (loggedIn) loggedIn.classList.add('hidden');
        }
      });
      const logoutBtn = document.getElementById('menu-logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async () => {
          try {
            await kartaoAuth.logout();
            closeMenu();
            window.location.href = 'index.html';
          } catch (error) {
            console.error('Chyba při odhlášení:', error);
            alert('Chyba při odhlášení');
          }
        });
      }
    }
  });
</script>

<script src="auth.js"></script>
<script src="credits-header.js"></script>