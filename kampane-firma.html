<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao.cz ‚Äì P≈ôehled kampan√≠</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
            emerald: tailwind.colors.emerald,
            sky: tailwind.colors.sky,
            rose: tailwind.colors.rose,
          },
          boxShadow: {
            soft: "0 18px 45px rgba(15,23,42,0.85)",
          }
        }
      }
    };
  </script>

  <!-- Ikony -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-neutral-950 via-slate-950 to-fuchsia-950 text-white">
  <div class="min-h-screen flex flex-col">

    <!-- HLAVIƒåKA -->
    <header class="sticky top-0 z-30 border-b border-white/10 bg-neutral-950/85 backdrop-blur">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
        <!-- Logo / n√°zev -->
        <a href="moje-firma.html" class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-emerald-400 to-sky-400 grid place-items-center shadow-soft">
            <i data-lucide="layout-dashboard" class="w-5 h-5 text-neutral-900"></i>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span class="font-semibold text-lg">Kartao.cz</span>
              <span class="px-2 py-0.5 rounded-full text-[11px] bg-emerald-500/15 text-emerald-200 border border-emerald-400/40">
                Kampanƒõ
              </span>
            </div>
            <p class="text-[11px] text-white/60">P≈ôehled kampan√≠ ¬∑ stav ¬∑ v√Ωsledky</p>
          </div>
        </a>

        <!-- Prav√° strana -->
        <div class="flex items-center gap-3">
          <div class="hidden sm:flex items-center gap-1.5 rounded-2xl border border-amber-400/60 bg-amber-400/10 px-3 py-1.5">
            <span class="text-[11px] uppercase tracking-wide text-amber-200">K-Coins</span>
            <span id="headerCredits" class="text-sm font-semibold text-amber-100">0</span>
          </div>

          <a href="firma-credits.html" class="hidden sm:inline-flex items-center gap-1.5 rounded-2xl border border-amber-400/60 bg-amber-500/10 px-3 py-1.5 text-xs font-medium text-amber-100 hover:bg-amber-500/20">
            <i data-lucide="plus-circle" class="w-3.5 h-3.5"></i>
            Dob√≠t kredity
          </a>

          <a href="vytvorit-kampan.html" class="inline-flex items-center gap-1.5 rounded-2xl border border-emerald-400/60 bg-emerald-500/10 px-3 py-1.5 text-xs font-medium text-emerald-100 hover:bg-emerald-500/25">
            <i data-lucide="megaphone" class="w-3.5 h-3.5"></i>
            Nov√° kampa≈à
          </a>

          <button id="logoutBtn" type="button" class="inline-flex items-center gap-1.5 rounded-2xl border border-white/20 bg-white/5 px-3 py-1.5 text-xs font-medium text-white/90 hover:bg-white/10">
            <i data-lucide="log-out" class="w-3.5 h-3.5"></i>
            Odhl√°sit
          </button>
        </div>
      </div>
    </header>

    <!-- OBSAH -->
    <main class="flex-1">
      <div class="max-w-6xl mx-auto px-4 py-8 md:py-10 space-y-8">

        <!-- HLAVN√ç PANEL + STATISTIKY -->
        <section class="space-y-4">
          <div class="rounded-3xl bg-neutral-950/80 border border-white/10 shadow-soft p-5 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
            <div>
              <h1 class="text-xl md:text-2xl font-semibold">P≈ôehled kampan√≠</h1>
              <p class="text-xs text-white/60 mt-1 max-w-xl">Zde vid√≠≈° v≈°echny sv√© kampanƒõ na Kartao.cz ‚Äì od n√°vrhu a≈æ po dokonƒçen√≠. Sleduj stav, rozpoƒçet a v√Ωkon.</p>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs w-full md:w-auto">
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Aktivn√≠</p>
                <p id="statActive" class="text-sm font-semibold">3</p>
              </div>
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Schvalov√°n√≠</p>
                <p id="statPending" class="text-sm font-semibold">1</p>
              </div>
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Dokonƒçen√©</p>
                <p id="statFinished" class="text-sm font-semibold">2</p>
              </div>
              <div class="rounded-2xl bg-amber-500/10 border border-amber-400/50 px-3 py-2">
                <p class="text-white/70">Utraceno tento mƒõs√≠c</p>
                <p id="statSpent" class="text-sm font-semibold text-amber-200">2 500 K-Coins</p>
              </div>
            </div>
          </div>

          <!-- FILTRY -->
          <div class="rounded-3xl bg-neutral-950/80 border border-white/10 shadow-soft p-4 md:p-5 text-xs flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div class="flex items-center gap-2 text-white/60">
              <i data-lucide="filter" class="w-4 h-4"></i>
              <span>Filtr kampan√≠ ‚Äì m≈Ø≈æe≈° kombinovat stav, platformu, typ a ≈ôazen√≠.</span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 w-full md:w-auto">
              <select id="filterStatus" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
                <option value="all">Stav: V≈°e</option>
                <option value="Aktivn√≠">Aktivn√≠</option>
                <option value="N√°vrh">N√°vrh</option>
                <option value="ƒåek√° na schv√°len√≠">Schvalov√°n√≠</option>
                <option value="Dokonƒçen√©">Dokonƒçen√©</option>
              </select>
              <select id="filterPlatform" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
                <option value="all">Platforma: V≈°e</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="YouTube">YouTube</option>
                <option value="Mix platforem">Mix platforem</option>
              </select>
              <select id="filterType" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
                <option value="all">Typ kampanƒõ</option>
                <option value="Brand awareness">Brand awareness</option>
                <option value="V√Ωkonnostn√≠">V√Ωkonnostn√≠</option>
                <option value="Soutƒõ≈æ / Giveaway">Soutƒõ≈æ / Giveaway</option>
              </select>
              <select id="filterSort" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
                <option value="newest">≈òazen√≠: nejnovƒõj≈°√≠</option>
                <option value="oldest">Nejstar≈°√≠</option>
                <option value="budgetDesc">Nejvy≈°≈°√≠ rozpoƒçet</option>
                <option value="budgetAsc">Nejni≈æ≈°√≠ rozpoƒçet</option>
              </select>
            </div>
          </div>
        </section>

        <!-- GRID: TABULKA + DETAIL -->
        <section class="grid lg:grid-cols-[minmax(0,1.7fr)_minmax(0,1.3fr)] gap-6 items-start">
          <!-- TABULKA KAMPAN√ç -->
          <div class="rounded-3xl bg-neutral-950/80 border border-white/10 shadow-soft p-4 md:p-5">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-sm font-semibold">Kampanƒõ</h2>
              <button onclick="window.location.href='vytvorit-kampan.html'" class="inline-flex items-center gap-1.5 rounded-2xl bg-emerald-500/15 border border-emerald-400/60 px-3 py-1.5 text-[11px] text-emerald-100 hover:bg-emerald-500/25">
                <i data-lucide="megaphone" class="w-3.5 h-3.5"></i>
                Vytvo≈ôit kampa≈à
              </button>
            </div>

            <div class="overflow-x-auto">
              <table class="w-full text-left text-[13px]">
                <thead class="text-white/60 text-xs border-b border-white/10">
                  <tr>
                    <th class="py-2">N√°zev</th>
                    <th class="py-2">Stav</th>
                    <th class="py-2">Platforma</th>
                    <th class="py-2">Rozpoƒçet</th>
                    <th class="py-2">Utraceno</th>
                    <th class="py-2">Obdob√≠</th>
                  </tr>
                </thead>

                <tbody id="campaignList" class="divide-y divide-white/5">
                  <!-- DEMO DATA -->
                  <tr class="hover:bg-white/5 cursor-pointer" data-campaign-row
                      data-name="Jarn√≠ launch kolekce" data-status="Aktivn√≠" data-platform="Mix platforem" data-type="Brand awareness"
                      data-budget="5 000 K-Coins" data-spent="2 000 K-Coins" data-objective="Brand awareness ¬∑ p≈ôedstaven√≠ nov√© kolekce"
                      data-period="1. 3. ‚Äì 31. 3." data-influencers="5 mikroinfluencer≈Ø ¬∑ 2 mid-tier">
                    <td class="py-3">Jarn√≠ launch kolekce</td>
                    <td>
                      <span class="px-2 py-1 rounded-full text-[10px] bg-emerald-500/20 text-emerald-300 border border-emerald-400/40">Aktivn√≠</span>
                    </td>
                    <td>Instagram + TikTok</td>
                    <td>5 000 K-Coins</td>
                    <td>2 000 K-Coins</td>
                    <td>1. 3. ‚Äì 31. 3.</td>
                  </tr>

                  <tr class="hover:bg-white/5 cursor-pointer" data-campaign-row
                      data-name="Velikonoƒçn√≠ soutƒõ≈æ" data-status="ƒåek√° na schv√°len√≠" data-platform="Instagram" data-type="Soutƒõ≈æ / Giveaway"
                      data-budget="3 000 K-Coins" data-spent="0 K-Coins" data-objective="Soutƒõ≈æ ¬∑ sbƒõr nov√Ωch sleduj√≠c√≠ch"
                      data-period="10. 3. ‚Äì 20. 3." data-influencers="3 influenceri">
                    <td class="py-3">Velikonoƒçn√≠ soutƒõ≈æ</td>
                    <td>
                      <span class="px-2 py-1 rounded-full text-[10px] bg-amber-500/20 text-amber-200 border border-amber-300/60">ƒåek√° na schv√°len√≠</span>
                    </td>
                    <td>Instagram</td>
                    <td>3 000 K-Coins</td>
                    <td>0 K-Coins</td>
                    <td>10. 3. ‚Äì 20. 3.</td>
                  </tr>

                  <tr class="hover:bg-white/5 cursor-pointer" data-campaign-row
                      data-name="Testovac√≠ kampa≈à ‚Äì jaro" data-status="N√°vrh" data-platform="TikTok" data-type="V√Ωkonnostn√≠"
                      data-budget="1 000 K-Coins" data-spent="0 K-Coins" data-objective="Test ¬∑ otestovat form√°ty a kreativu"
                      data-period="TBD" data-influencers="1‚Äì2 influence≈ôi (n√°vrh)">
                    <td class="py-3">Testovac√≠ kampa≈à ‚Äì jaro</td>
                    <td>
                      <span class="px-2 py-1 rounded-full text-[10px] bg-white/10 text-white/70 border border-white/30">N√°vrh</span>
                    </td>
                    <td>TikTok</td>
                    <td>1 000 K-Coins</td>
                    <td>0 K-Coins</td>
                    <td>TBD</td>
                  </tr>

                  <tr class="hover:bg-white/5 cursor-pointer" data-campaign-row
                      data-name="V√°noƒçn√≠ kampa≈à 2024" data-status="Dokonƒçen√©" data-platform="Mix platforem" data-type="Brand awareness"
                      data-budget="8 000 K-Coins" data-spent="7 500 K-Coins" data-objective="Prodej ¬∑ v√°noƒçn√≠ n√°kupy"
                      data-period="1. 12. ‚Äì 24. 12. 2024" data-influencers="8 influenc√©r≈Ø (mix)">
                    <td class="py-3">V√°noƒçn√≠ kampa≈à 2024</td>
                    <td>
                      <span class="px-2 py-1 rounded-full text-[10px] bg-sky-500/20 text-sky-200 border border-sky-400/60">Dokonƒçen√©</span>
                    </td>
                    <td>Mix platforem</td>
                    <td>8 000 K-Coins</td>
                    <td>7 500 K-Coins</td>
                    <td>1. 12. ‚Äì 24. 12. 2024</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- DETAIL KAMPANƒö -->
          <aside class="rounded-3xl bg-neutral-950/85 border border-white/10 shadow-soft p-5 space-y-4">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-xs uppercase tracking-wide text-sky-200/80">Detail kampanƒõ</p>
                <h2 id="detailName" class="text-sm md:text-base font-semibold mt-1">Vyber kampa≈à z tabulky</h2>
              </div>
              <div>
                <span id="detailStatusBadge" class="px-2 py-1 rounded-full text-[10px] bg-white/10 border border-white/20 text-white/70">‚Äî</span>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3 text-[11px]">
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Rozpoƒçet</p>
                <p id="detailBudget" class="text-sm font-semibold">‚Äî</p>
              </div>
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Utraceno</p>
                <p id="detailSpent" class="text-sm font-semibold">‚Äî</p>
              </div>
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Platforma</p>
                <p id="detailPlatform" class="text-sm font-semibold">‚Äî</p>
              </div>
              <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
                <p class="text-white/60">Obdob√≠</p>
                <p id="detailPeriod" class="text-sm font-semibold">‚Äî</p>
              </div>
            </div>

            <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-3 text-[11px] space-y-1">
              <p class="text-white/60 mb-1">C√≠l kampanƒõ</p>
              <p id="detailObjective" class="text-white/80">‚Äî</p>
            </div>

            <div class="rounded-2xl bg-white/5 border border-white/10 px-3 py-3 text-[11px] space-y-1">
              <p class="text-white/60 mb-1">Influence≈ôi v kampani</p>
              <p id="detailInfluencers" class="text-white/80">‚Äî</p>
            </div>

            <div class="flex flex-wrap gap-2 pt-2 border-t border-white/10 mt-2">
              <button id="editCampaignBtn" class="inline-flex items-center gap-1.5 rounded-2xl bg-emerald-500/15 border border-emerald-400/60 px-3 py-1.5 text-[11px] text-emerald-100 hover:bg-emerald-500/25">
                <i data-lucide="edit-3" class="w-3.5 h-3.5"></i>
                Upravit kampa≈à
              </button>
              <button class="inline-flex items-center gap-1.5 rounded-2xl bg-sky-500/15 border border-sky-400/60 px-3 py-1.5 text-[11px] text-sky-100 hover:bg-sky-500/25">
                <i data-lucide="bar-chart-3" class="w-3.5 h-3.5"></i>
                V√Ωsledky & statistiky
              </button>
              <button class="inline-flex items-center gap-1.5 rounded-2xl bg-white/5 border border-white/25 px-3 py-1.5 text-[11px] text-white/80 hover:bg-white/15">
                <i data-lucide="more-horizontal" class="w-3.5 h-3.5"></i>
                Dal≈°√≠ akce (pozastavit, ukonƒçit‚Ä¶)
              </button>
            </div>
          </aside>
        </section>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="border-t border-white/10 mt-8">
      <div class="max-w-6xl mx-auto px-4 py-4 text-[11px] text-white/50 flex flex-wrap items-center justify-between gap-2">
        <span>¬© 2025 Kartao.cz ‚Äì P≈ôehled kampan√≠</span>
        <span>Kampanƒõ ¬∑ kredity ¬∑ ekosyst√©m znaƒçek & influencer≈Ø</span>
      </div>
    </footer>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      if (window.lucide) {
        lucide.createIcons();
      }
    });
  </script>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

  <!-- Konfigurace + init + datab√°ze + kredity + API slu≈æby -->
  <script src="firebase-config.js"></script>
  <script src="firebase-init.js"></script>
  <script src="database-init.js"></script>
  <script src="credits-system.js"></script>
  <script src="api-services.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const auth =
        window.auth ||
        (window.firebase && firebase.auth && firebase.auth());

      const logoutBtn = document.getElementById("logoutBtn");
      const headerCreditsEl = document.getElementById("headerCredits");
      const currentCreditsEl = document.getElementById("currentCredits");

      const rows = document.querySelectorAll("[data-campaign-row]");
      const editCampaignBtn = document.getElementById("editCampaignBtn");

      let selectedCampaign = null;
      let selectedRow = null;
      let isEditing = false;
      const filterStatus = document.getElementById("filterStatus");
      const filterPlatform = document.getElementById("filterPlatform");
      const filterType = document.getElementById("filterType");
      const filterSort = document.getElementById("filterSort");

      function updateCreditsDisplay(val) {
        if (typeof val !== "number") return;
        if (headerCreditsEl) headerCreditsEl.textContent = val;
        if (currentCreditsEl) currentCreditsEl.textContent = val;
      }

      function parseBudget(str) {
        if (!str) return 0;
        let digits = "";
        for (let i = 0; i < str.length; i++) {
          const ch = str[i];
          if (ch >= "0" && ch <= "9") {
            digits += ch;
          }
        }
        if (!digits) return 0;
        return parseInt(digits, 10) || 0;
      }

      function applyFilters() {
        const statusVal = filterStatus ? filterStatus.value : "all";
        const platformVal = filterPlatform ? filterPlatform.value : "all";
        const typeVal = filterType ? filterType.value : "all";
        const sortVal = filterSort ? filterSort.value : "newest";

        const tbody = document.getElementById("campaignList");
        if (!tbody) return;

        const rowsArr = Array.from(rows);

        // Filtrov√°n√≠ viditelnosti
        rowsArr.forEach((row) => {
          const rowStatus = row.getAttribute("data-status") || "";
          const rowPlatform = row.getAttribute("data-platform") || "";
          const rowType = row.getAttribute("data-type") || "";

          let visible = true;
          if (statusVal !== "all" && rowStatus !== statusVal) visible = false;
          if (platformVal !== "all" && rowPlatform !== platformVal) visible = false;
          if (typeVal !== "all" && rowType !== typeVal) visible = false;

          row.style.display = visible ? "" : "none";
        });

        // ≈òazen√≠ ‚Äì jen viditeln√© ≈ô√°dky
        let visibleRows = rowsArr.filter((r) => r.style.display !== "none");
        let sorted = [...visibleRows];

        if (sortVal === "oldest") {
          sorted.reverse();
        } else if (sortVal === "budgetDesc") {
          sorted.sort(
            (a, b) =>
              parseBudget(b.getAttribute("data-budget")) -
              parseBudget(a.getAttribute("data-budget"))
          );
        } else if (sortVal === "budgetAsc") {
          sorted.sort(
            (a, b) =>
              parseBudget(a.getAttribute("data-budget")) -
              parseBudget(b.getAttribute("data-budget"))
          );
        }
        // "newest" = ponech√°me p≈Øvodn√≠ po≈ôad√≠

        sorted.forEach((row) => tbody.appendChild(row));
      }

      // Reakce na zmƒõnu filtr≈Ø
      if (filterStatus) filterStatus.addEventListener("change", applyFilters);
      if (filterPlatform) filterPlatform.addEventListener("change", applyFilters);
      if (filterType) filterType.addEventListener("change", applyFilters);
      if (filterSort) filterSort.addEventListener("change", applyFilters);

      // Odhl√°≈°en√≠ firmy / u≈æivatele
      if (logoutBtn && auth) {
        logoutBtn.addEventListener("click", function (e) {
          e.preventDefault();
          auth
            .signOut()
            .then(function () {
              window.location.href = "login.html";
            })
            .catch(function (error) {
              console.error("Chyba p≈ôi odhla≈°ov√°n√≠:", error);
            });
        });
      }

      if (!auth) {
        console.warn("Firebase Auth nen√≠ dostupn√Ω na kampane-dashboard.html");
        return;
      }

      auth.onAuthStateChanged(function (user) {
        if (!user) {
          window.location.href = "login.html";
          return;
        }

        window.currentUserId = user.uid;

        // üî• FIREMN√ç KREDITY ‚Äì NAƒåTEN√ç Z FIRESTORE (ne z localStorage)
        try {
          const db = window.db;
          const uid = user.uid;

          // 1) ƒåti firemn√≠ dokument (firma m√° kredity ulo≈æen√© zde)
          db.collection("firmy").doc(uid).get().then((doc) => {
            if (doc.exists) {
              const data = doc.data();
              const firemniKoiny = data.kredity || 0;
              updateCreditsDisplay(firemniKoiny);
            } else {
              console.warn("Firemn√≠ dokument nenalezen ‚Äì kredity 0");
              updateCreditsDisplay(0);
            }
          }).catch((e) => {
            console.warn("Chyba p≈ôi naƒç√≠t√°n√≠ firemn√≠ch kredit≈Ø:", e);
          });
        } catch (e) {
          console.warn("Chyba firemn√≠ch kredit≈Ø:", e);
        }

        // aktualizace UI kredit≈Ø
        updateCreditsDisplay(val);
        } catch (e) {
          console.warn("P≈ôehled kampan√≠: chyba p≈ôi pr√°ci s CreditsSystem:", e);
        }

        const detailName = document.getElementById("detailName");
        const detailBudget = document.getElementById("detailBudget");
        const detailSpent = document.getElementById("detailSpent");
        const detailPlatform = document.getElementById("detailPlatform");
        const detailPeriod = document.getElementById("detailPeriod");
        const detailObjective = document.getElementById("detailObjective");
        const detailInfluencers = document.getElementById("detailInfluencers");
        const detailStatusBadge = document.getElementById("detailStatusBadge");

        rows.forEach((row) => {
          // Klik na ≈ô√°dek = oznaƒçen√≠ kampanƒõ + naƒçten√≠ detailu
          row.addEventListener("click", () => {
            rows.forEach((r) =>
              r.classList.remove("ring-2", "ring-emerald-400", "bg-white/10")
            );
            row.classList.add("ring-2", "ring-emerald-400", "bg-white/10");

            const name = row.getAttribute("data-name") || "Kampa≈à";
            const status = row.getAttribute("data-status") || "";
            const platform = row.getAttribute("data-platform") || "";
            const budget = row.getAttribute("data-budget") || "";
            const spent = row.getAttribute("data-spent") || "";
            const period = row.getAttribute("data-period") || "";
            const objective = row.getAttribute("data-objective") || "";
            const influencers = row.getAttribute("data-influencers") || "";

            // Ulo≈æ√≠me oznaƒçenou kampa≈à do promƒõnn√©
            selectedCampaign = {
              name,
              status,
              platform,
              budget,
              spent,
              period,
              objective,
              influencers,
            };

            selectedRow = row;

            if (detailName) detailName.textContent = name;
            if (detailBudget) detailBudget.textContent = budget;
            if (detailSpent) detailSpent.textContent = spent;
            if (detailPlatform) detailPlatform.textContent = platform;
            if (detailPeriod) detailPeriod.textContent = period;
            if (detailObjective) detailObjective.textContent = objective;
            if (detailInfluencers) detailInfluencers.textContent = influencers;

            if (detailStatusBadge) {
              detailStatusBadge.textContent = status || "‚Äî";
              detailStatusBadge.className = "px-2 py-1 rounded-full text-[10px] border";

              if (status === "Aktivn√≠") {
                detailStatusBadge.classList.add(
                  "bg-emerald-500/20",
                  "border-emerald-400/60",
                  "text-emerald-200"
                );
              } else if (status === "ƒåek√° na schv√°len√≠") {
                detailStatusBadge.classList.add(
                  "bg-amber-500/20",
                  "border-amber-300/60",
                  "text-amber-100"
                );
              } else if (status === "Dokonƒçen√©") {
                detailStatusBadge.classList.add(
                  "bg-sky-500/20",
                  "border-sky-400/60",
                  "text-sky-100"
                );
              } else if (status === "N√°vrh") {
                detailStatusBadge.classList.add(
                  "bg-white/10",
                  "border-white/40",
                  "text-white/80"
                );
              } else {
                detailStatusBadge.classList.add(
                  "bg-white/10",
                  "border-white/30",
                  "text-white/70"
                );
              }
            }
          });
        });

        // Listener na tlaƒç√≠tko "Upravit kampa≈à"
        if (editCampaignBtn) {
          editCampaignBtn.addEventListener("click", () => {
            if (!selectedCampaign || !selectedRow) {
              alert("Vyber pros√≠m nejd≈ô√≠v kampa≈à v tabulce, kterou chce≈° upravit.");
              return;
            }

            const editableEls = [
              detailName,
              detailBudget,
              detailSpent,
              detailPlatform,
              detailPeriod,
              detailObjective,
              detailInfluencers,
            ];

            if (!isEditing) {
              // P≈ôepnut√≠ do re≈æimu √∫prav
              isEditing = true;
              editCampaignBtn.innerHTML = '<i data-lucide="check" class="w-3.5 h-3.5"></i><span>Ulo≈æit zmƒõny</span>';

              editableEls.forEach((el) => {
                if (!el) return;
                el.contentEditable = "true";
                el.classList.add(
                  "outline-none",
                  "ring-1",
                  "ring-emerald-400/60",
                  "rounded-md",
                  "px-0.5",
                  "bg-emerald-500/5"
                );
              });

              if (window.lucide) {
                lucide.createIcons();
              }
            } else {
              // Ulo≈æen√≠ zmƒõn a n√°vrat do re≈æimu n√°hledu
              isEditing = false;

              const newName = detailName
                ? detailName.textContent.trim()
                : selectedCampaign.name;
              const newBudget = detailBudget
                ? detailBudget.textContent.trim()
                : selectedCampaign.budget;
              const newSpent = detailSpent
                ? detailSpent.textContent.trim()
                : selectedCampaign.spent;
              const newPlatform = detailPlatform
                ? detailPlatform.textContent.trim()
                : selectedCampaign.platform;
              const newPeriod = detailPeriod
                ? detailPeriod.textContent.trim()
                : selectedCampaign.period;
              const newObjective = detailObjective
                ? detailObjective.textContent.trim()
                : selectedCampaign.objective;
              const newInfluencers = detailInfluencers
                ? detailInfluencers.textContent.trim()
                : selectedCampaign.influencers;

              selectedCampaign = {
                name: newName,
                status: selectedCampaign.status,
                platform: newPlatform,
                budget: newBudget,
                spent: newSpent,
                period: newPeriod,
                objective: newObjective,
                influencers: newInfluencers,
              };

              try {
                // Aktualizace atribut≈Ø na ≈ô√°dku tabulky
                selectedRow.setAttribute("data-name", newName);
                selectedRow.setAttribute("data-platform", newPlatform);
                selectedRow.setAttribute("data-budget", newBudget);
                selectedRow.setAttribute("data-spent", newSpent);
                selectedRow.setAttribute("data-period", newPeriod);
                selectedRow.setAttribute("data-objective", newObjective);
                selectedRow.setAttribute("data-influencers", newInfluencers);

                // Aktualizace textu v bu≈àk√°ch tabulky
                const cells = selectedRow.querySelectorAll("td");
                if (cells[0]) cells[0].textContent = newName;
                if (cells[2]) cells[2].textContent = newPlatform;
                if (cells[3]) cells[3].textContent = newBudget;
                if (cells[4]) cells[4].textContent = newSpent;
                if (cells[5]) cells[5].textContent = newPeriod;
              } catch (e) {
                console.warn("Nepoda≈ôilo se aktualizovat ≈ô√°dek kampanƒõ:", e);
              }

              editableEls.forEach((el) => {
                if (!el) return;
                el.contentEditable = "false";
                el.classList.remove(
                  "ring-1",
                  "ring-emerald-400/60",
                  "rounded-md",
                  "px-0.5",
                  "bg-emerald-500/5"
                );
              });

              editCampaignBtn.innerHTML =
                '<i data-lucide="edit-3" class="w-3.5 h-3.5"></i><span>Upravit kampa≈à</span>';

              if (window.lucide) {
                lucide.createIcons();
              }
            }
          });
        }

        // Po p≈ôihl√°≈°en√≠ automaticky aplikuj filtry
        applyFilters();
      });
    });
  </script>
</body>
</html>
