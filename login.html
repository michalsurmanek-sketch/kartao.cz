 <!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao.cz – Přihlášení & Registrace</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
          },
        },
      },
    };
  </script>

    <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- Jednotná inicializace Firebase pro celý web -->
  <script src="firebase-init.js"></script>

  <style>
    /* Lehký rozmazaný gradient na pozadí */
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, #db58f6 0, transparent 55%),
                  radial-gradient(circle at bottom right, #fbbf24 0, #020617 55%);
    }
  </style>
</head>
<body class="text-white flex items-center justify-center px-4 py-10">
  <div class="w-full max-w-md bg-neutral-900/80 border border-white/10 rounded-2xl shadow-xl backdrop-blur-md p-6">
    <!-- Logo + claim -->
    <div class="flex items-center gap-3 mb-6">
      <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center shadow-lg">
        <span class="text-xl font-bold">K</span>
      </div>
      <div>
        <div class="font-extrabold tracking-tight text-lg">Kartao.cz</div>
        <div class="text-xs text-white/60 -mt-0.5">Síť influencerů a tvůrců</div>
      </div>
    </div>

    <!-- Přepínač Přihlášení / Registrace -->
    <div class="flex mb-4 rounded-xl bg-neutral-800/80 p-1 text-sm">
      <button id="tab-login" data-tab="login" type="button" class="flex-1 py-2 rounded-lg font-medium bg-neutral-900 text-white">Přihlášení</button>
      <button id="tab-register" data-tab="register" type="button" class="flex-1 py-2 rounded-lg font-medium text-white/70 hover:text-white">Registrace</button>
    </div>

    <!-- Box na hlášky -->
    <div id="auth-message" class="hidden mb-4 text-sm rounded-lg px-3 py-2 border"></div>

    <!-- FORM: Přihlášení -->
    <form id="login-form" class="space-y-4">
      <div>
        <label class="block text-sm mb-1" for="login-email">E-mail</label>
        <input id="login-email" type="email" required autocomplete="email"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>
      <div>
        <label class="block text-sm mb-1" for="login-password">Heslo</label>
        <input id="login-password" type="password" required autocomplete="current-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>

      <button type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
        Přihlásit se
      </button>

      <!-- Tlačítko pro znovu-poslání ověřovacího e-mailu (standardně skryté) -->
      <button type="button" id="btn-resend" class="hidden w-full py-2 rounded-xl border border-amber-300/60 text-xs text-amber-200 hover:bg-amber-300/10 transition">
        Znovu poslat ověřovací e-mail
      </button>

      <div class="mt-3 text-center text-[11px] text-white/40">
        <span class="inline-block px-2 text-white/60">nebo</span>
      </div>

      <button type="button" id="btn-google" class="mt-2 w-full py-2.5 rounded-xl border border-white/15 bg-neutral-900/80 text-sm font-medium text-white/80 hover:bg-neutral-800 transition flex items-center justify-center gap-2">
        <span class="text-lg">G</span>
        <span>Přihlásit se přes Google</span>
      </button>

      <button type="button" id="btn-facebook" class="mt-2 w-full py-2.5 rounded-xl border border-white/15 bg-neutral-900/80 text-sm font-medium text-white/80 hover:bg-neutral-800 transition flex items-center justify-center gap-2">
        <span class="text-lg">f</span>
        <span>Přihlásit se přes Facebook</span>
      </button>
    </form>

    <!-- FORM: Registrace (schovaný, přepíná se tlačítky nahoře) -->
    <form id="register-form" class="space-y-4 hidden">
      <div>
        <label class="block text-sm mb-1" for="reg-email">E-mail</label>
        <input id="reg-email" type="email" required autocomplete="email"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>
      <div>
        <label class="block text-sm mb-1" for="reg-password">Heslo</label>
        <input id="reg-password" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
        <p class="mt-1 text-[11px] text-white/50">Min. 6 znaků.</p>
      </div>
      <div>
        <label class="block text-sm mb-1" for="reg-password2">Heslo znovu</label>
        <input id="reg-password2" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>

      <button type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
        Vytvořit účet a poslat ověření
      </button>

      <p class="text-[11px] text-white/50 text-center">
        Registrací souhlasíte s&nbsp;<a href="obchodni-podminky.html" class="underline">podmínkami použití</a> a
        <a href="ochrana-osobnich-udaju.html" class="underline">zpracováním osobních údajů</a>.
      </p>
    </form>

    <p class="mt-5 text-center text-[11px] text-white/40">
      Potřebujete pomoct? Napište na <a href="mailto:podpora@kartao.cz" class="underline">podpora@kartao.cz</a>
    </p>
  </div>

  <script>
    // =========================
    // 1) Předpoklad: Firebase už je inicializovaná ve firebase-init.js
    // =========================
    // Zde jen vytvoříme providery pro sociální přihlášení
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    const facebookProvider = new firebase.auth.FacebookAuthProvider();

    // =========================
    // 2) Helper na hlášky
    // =========================
    const messageBox = document.getElementById("auth-message");
    const btnResend = document.getElementById("btn-resend");
    const btnGoogle = document.getElementById("btn-google");
    const btnFacebook = document.getElementById("btn-facebook");

    function showMessage(text, type = "info") {
      if (!messageBox) return;
      messageBox.textContent = text;
      messageBox.classList.remove("hidden", "border-red-400", "bg-red-900/60", "border-emerald-400", "bg-emerald-900/60", "border-amber-300", "bg-amber-900/40");

      if (type === "error") {
        messageBox.classList.add("border-red-400", "bg-red-900/60");
      } else if (type === "success") {
        messageBox.classList.add("border-emerald-400", "bg-emerald-900/60");
      } else {
        messageBox.classList.add("border-amber-300", "bg-amber-900/40");
      }
    }

    function clearMessage() {
      if (!messageBox) return;
      messageBox.classList.add("hidden");
      messageBox.textContent = "";
    }

    // Uložení / aktualizace profilu uživatele ve Firestore
    async function saveUserProfile(user) {
      if (!user || !db) return;
      try {
        const userRef = db.collection("users").doc(user.uid);
        const providerId = user.providerData && user.providerData[0] ? user.providerData[0].providerId : "password";
        await userRef.set({
          email: user.email || "",
          displayName: user.displayName || "",
          photoURL: user.photoURL || "",
          provider: providerId,
          emailVerified: !!user.emailVerified,
          updatedAt: new Date().toISOString(),
        }, { merge: true });
      } catch (err) {
        console.error("Chyba při ukládání profilu:", err);
      }
    }

    // =========================
    // 3) Přepínání záložek
    // =========================
    const tabLogin = document.getElementById("tab-login");
    const tabRegister = document.getElementById("tab-register");
    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");

    function setActiveTab(tab) {
      clearMessage();
      if (btnResend) btnResend.classList.add("hidden");

      if (tab === "login") {
        tabLogin.classList.add("bg-neutral-900", "text-white");
        tabLogin.classList.remove("text-white/70");
        tabRegister.classList.remove("bg-neutral-900", "text-white");
        tabRegister.classList.add("text-white/70");
        loginForm.classList.remove("hidden");
        registerForm.classList.add("hidden");
      } else {
        tabRegister.classList.add("bg-neutral-900", "text-white");
        tabRegister.classList.remove("text-white/70");
        tabLogin.classList.remove("bg-neutral-900", "text-white");
        tabLogin.classList.add("text-white/70");
        registerForm.classList.remove("hidden");
        loginForm.classList.add("hidden");
      }
    }

    tabLogin.addEventListener("click", () => setActiveTab("login"));
    tabRegister.addEventListener("click", () => setActiveTab("register"));

    // default
    setActiveTab("login");

    // =========================
    // 4) Registrace + ověření e-mailu
    // =========================
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMessage();

      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value;
      const password2 = document.getElementById("reg-password2").value;

      if (password !== password2) {
        showMessage("Hesla se neshodují.", "error");
        return;
      }

      if (password.length < 6) {
        showMessage("Heslo musí mít alespoň 6 znaků.", "error");
        return;
      }

      try {
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        if (cred.user) {
          await saveUserProfile(cred.user);
          await cred.user.sendEmailVerification();
          showMessage("Účet byl vytvořen. Zkontrolujte e-mail a potvrďte ověřovací odkaz.", "success");
          registerForm.reset();
          setActiveTab("login");
        }
      } catch (error) {
        console.error(error);
        showMessage(error.message || "Při registraci došlo k chybě.", "error");
      }
    });

    // =========================
    // 5) Přihlášení (kontrola ověření e-mailu)
    // =========================
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMessage();
      if (btnResend) btnResend.classList.add("hidden");

      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;

      try {
        const cred = await auth.signInWithEmailAndPassword(email, password);
        const user = cred.user;

        if (!user.emailVerified) {
          showMessage("Účet je vytvořen, ale e-mail zatím není ověřen. Zkontrolujte schránku nebo klikněte na 'Znovu poslat ověřovací e-mail'.", "info");
          if (btnResend) btnResend.classList.remove("hidden");
          return;
        }

        await saveUserProfile(user);
        showMessage("Přihlášení proběhlo úspěšně. Přesměrovávám...", "success");

        // TODO: po přihlášení přesměruj kam potřebuješ (např. na kartu nebo přehled účtu)
        // window.location.href = "kartao-zalozit-kartu.html";

      } catch (error) {
        console.error(error);
        showMessage(error.message || "Při přihlášení došlo k chybě.", "error");
      }
    });

    // =========================
    // 6) Přihlášení přes Google
    // =========================
    if (btnGoogle) {
      btnGoogle.addEventListener("click", async () => {
        clearMessage();
        try {
          const result = await auth.signInWithPopup(googleProvider);
          const user = result.user;
          if (user) {
            await saveUserProfile(user);
            showMessage("Přihlášení přes Google proběhlo úspěšně. Přesměrovávám...", "success");
            // window.location.href = "kartao-zalozit-kartu.html";
          }
        } catch (error) {
          console.error(error);
          showMessage(error.message || "Přihlášení přes Google se nepodařilo.", "error");
        }
      });
    }

    // =========================
    // 7) Přihlášení přes Facebook
    // =========================
    if (btnFacebook) {
      btnFacebook.addEventListener("click", async () => {
        clearMessage();
        try {
          const result = await auth.signInWithPopup(facebookProvider);
          const user = result.user;
          if (user) {
            await saveUserProfile(user);
            showMessage("Přihlášení přes Facebook proběhlo úspěšně. Přesměrovávám...", "success");
            // window.location.href = "kartao-zalozit-kartu.html";
          }
        } catch (error) {
          console.error(error);
          showMessage(error.message || "Přihlášení přes Facebook se nepodařilo.", "error");
        }
      });
    }

    // =========================
    // 8) Znovu poslat ověřovací e-mail
    // =========================
    if (btnResend) {
      btnResend.addEventListener("click", async () => {
        clearMessage();
        const user = auth.currentUser;
        if (!user) {
          showMessage("Nejste přihlášený. Zkuste se znovu přihlásit.", "error");
          return;
        }

        try {
          await user.sendEmailVerification();
          showMessage("Ověřovací e-mail byl znovu odeslán. Zkontrolujte schránku (i SPAM).", "success");
        } catch (error) {
          console.error(error);
          showMessage(error.message || "Ověřovací e-mail se nepodařilo odeslat.", "error");
        }
      });
    }
  </script>
</body>
</html>
