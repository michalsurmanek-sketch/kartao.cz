<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="P≈ôihlaste se do Kartao.cz - platformy pro influencery a znaƒçky. Spravujte sv≈Øj profil, kampanƒõ a komunikaci s partnery." />
  <meta name="robots" content="noindex, nofollow" />
  <title>Kartao.cz ‚Äì P≈ôihl√°≈°en√≠ & Registrace</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üîë</text></svg>">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
          },
        },
      },
    };
  </script>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, #db58f6 0, transparent 55%),
                  radial-gradient(circle at bottom right, #fbbf24 0, #020617 55%);
    }
  </style>
</head>
<body class="min-h-screen bg-neutral-950 text-white">

<!-- MINIM√ÅLN√ç HEADER -->
<header class="border-b border-white/10 bg-neutral-900/50">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-3">
      <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
        <span class="text-lg font-bold">K</span>
      </div>
      <div>
        <div class="font-extrabold tracking-tight text-lg">Kartao.cz</div>
        <div class="text-xs text-white/60 -mt-0.5">S√≠≈• influencer≈Ø a tv≈Ørc≈Ø</div>
      </div>
    </a>
    <nav class="hidden md:flex items-center gap-4 text-sm">
      <a href="index.html" class="text-white/70 hover:text-white transition">Dom≈Ø</a>
      <a href="kartao-marketplace.html" class="text-white/70 hover:text-white transition">Marketplace</a>
      <a href="kartao-pro-tvurce.html" class="text-white/70 hover:text-white transition">Pro tv≈Ørce</a>
    </nav>
  </div>
</header>

<!-- BREADCRUMBS -->
<nav class="border-b border-white/10 bg-neutral-900/50" aria-label="breadcrumb">
  <div class="max-w-7xl mx-auto px-4 py-2">
    <ol class="flex items-center gap-2 text-sm">
      <li><a href="index.html" class="text-white/70 hover:text-white transition">Dom≈Ø</a></li>
      <i data-lucide="chevron-right" class="w-3 h-3 text-white/40"></i>
      <li class="text-white">P≈ôihl√°≈°en√≠</li>
    </ol>
  </div>
</nav>

<main class="flex-1 flex items-center justify-center px-4 py-10">
  <div class="w-full max-w-md bg-neutral-900/80 border border-white/10 rounded-2xl shadow-xl backdrop-blur-md p-6">
    <!-- Logo + claim -->
    <div class="flex items-center gap-3 mb-6">
      <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center shadow-lg">
        <span class="text-xl font-bold">K</span>
      </div>
      <div>
        <div class="font-extrabold tracking-tight text-lg">Kartao.cz</div>
        <div class="text-xs text-white/60 -mt-0.5">S√≠≈• influencer≈Ø a tv≈Ørc≈Ø</div>
      </div>
    </div>

    <!-- P≈ôep√≠naƒç P≈ôihl√°≈°en√≠ / Registrace -->
    <div class="flex mb-4 rounded-xl bg-neutral-800/80 p-1 text-sm">
      <button id="tab-login" type="button" class="flex-1 py-2 rounded-lg font-medium bg-neutral-900 text-white">P≈ôihl√°≈°en√≠</button>
      <button id="tab-register" type="button" class="flex-1 py-2 rounded-lg font-medium text-white/70 hover:text-white">Registrace</button>
    </div>

    <!-- Box na hl√°≈°ky -->
    <div id="auth-message" class="hidden mb-4 text-sm rounded-lg px-3 py-2 border"></div>

    <!-- FORM: P≈ôihl√°≈°en√≠ -->
    <form id="login-form" class="space-y-4">
      <div>
        <label class="block text-sm mb-1" for="login-email">E-mail</label>
        <input id="login-email" type="email" required autocomplete="email"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>
      <div>
        <label class="block text-sm mb-1" for="login-password">Heslo</label>
        <input id="login-password" type="password" required autocomplete="current-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>

      <button type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
        P≈ôihl√°sit se
      </button>

      <div class="mt-3 text-center text-[11px] text-white/40">
        <span class="inline-block px-2 text-white/60">nebo</span>
      </div>

      <button type="button" id="btn-google" class="mt-2 w-full py-2.5 rounded-xl border border-white/15 bg-neutral-900/80 text-sm font-medium text-white/80 hover:bg-neutral-800 transition flex items-center justify-center gap-2">
        <span class="text-lg">G</span>
        <span>P≈ôihl√°sit se p≈ôes Google</span>
      </button>
    </form>

    <!-- FORM: Registrace -->
    <form id="register-form" class="space-y-4 hidden">
      <div>
        <label class="block text-sm mb-1" for="reg-email">E-mail</label>
        <input id="reg-email" type="email" required autocomplete="email"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>
      <div>
        <label class="block text-sm mb-1" for="reg-password">Heslo</label>
        <input id="reg-password" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
        <p class="mt-1 text-[11px] text-white/50">Min. 6 znak≈Ø.</p>
      </div>
      <div>
        <label class="block text-sm mb-1" for="reg-password2">Heslo znovu</label>
        <input id="reg-password2" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400" />
      </div>

      <button type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
        Vytvo≈ôit √∫ƒçet
      </button>

      <p class="text-[11px] text-white/50 text-center">
        Registrac√≠ souhlas√≠te s&nbsp;<a href="obchodni-podminky.html" class="underline">podm√≠nkami pou≈æit√≠</a>.
      </p>
    </form>

    <p class="mt-5 text-center text-[11px] text-white/40">
      Pot≈ôebujete pomoct? Napi≈°te na <a href="mailto:podpora@kartao.cz" class="underline">podpora@kartao.cz</a>
    </p>
  </div>

  <script>
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    const messageBox = document.getElementById("auth-message");
    const tabLogin = document.getElementById("tab-login");
    const tabRegister = document.getElementById("tab-register");
    const loginFormEl = document.getElementById("login-form");
    const registerFormEl = document.getElementById("register-form");
    const btnGoogle = document.getElementById("btn-google");

    function showMessage(text, type = "info") {
      messageBox.innerHTML = text;
      messageBox.classList.remove("hidden", "border-red-400", "bg-red-900/60", "border-emerald-400", "bg-emerald-900/60", "border-amber-300", "bg-amber-900/40");
      if (type === "error") {
        messageBox.classList.add("border-red-400", "bg-red-900/60");
      } else if (type === "success") {
        messageBox.classList.add("border-emerald-400", "bg-emerald-900/60");
      } else {
        messageBox.classList.add("border-amber-300", "bg-amber-900/40");
      }
    }

    function clearMessage() {
      messageBox.classList.add("hidden");
      messageBox.innerHTML = "";
    }

    function setActiveTab(tab) {
      clearMessage();
      if (tab === "login") {
        tabLogin.classList.add("bg-neutral-900", "text-white");
        tabLogin.classList.remove("text-white/70");
        tabRegister.classList.remove("bg-neutral-900", "text-white");
        tabRegister.classList.add("text-white/70");
        loginFormEl.classList.remove("hidden");
        registerFormEl.classList.add("hidden");
      } else {
        tabRegister.classList.add("bg-neutral-900", "text-white");
        tabRegister.classList.remove("text-white/70");
        tabLogin.classList.remove("bg-neutral-900", "text-white");
        tabLogin.classList.add("text-white/70");
        registerFormEl.classList.remove("hidden");
        loginFormEl.classList.add("hidden");
      }
    }

    tabLogin.addEventListener("click", () => setActiveTab("login"));
    tabRegister.addEventListener("click", () => setActiveTab("register"));
    setActiveTab("login");

    // Registrace
    registerFormEl.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMessage();

      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value;
      const password2 = document.getElementById("reg-password2").value;

      if (password !== password2) {
        showMessage("Hesla se neshoduj√≠", "error");
        return;
      }

      if (password.length < 6) {
        showMessage("Heslo mus√≠ m√≠t alespo≈à 6 znak≈Ø", "error");
        return;
      }

      const btn = registerFormEl.querySelector('button[type="submit"]');
      const originalText = btn.textContent;
      btn.textContent = 'Vytv√°≈ô√≠m √∫ƒçet...';
      btn.disabled = true;

      try {
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        showMessage("‚úÖ √öƒçet vytvo≈ôen! P≈ôesmƒõrov√°v√°m...", "success");
        registerFormEl.reset();
        setTimeout(() => {
          window.location.href = "kartao-vyber-uctu.html";
        }, 500);
      } catch (error) {
        let errorMsg = "P≈ôi registraci do≈°lo k chybƒõ.";
        if (error.code === 'auth/email-already-in-use') {
          errorMsg = "Tento e-mail je ji≈æ registrov√°n.";
        } else if (error.code === 'auth/invalid-email') {
          errorMsg = "Neplatn√Ω form√°t e-mailu.";
        } else if (error.code === 'auth/weak-password') {
          errorMsg = "Heslo je p≈ô√≠li≈° slab√©.";
        }
        showMessage(errorMsg, "error");
        btn.textContent = originalText;
        btn.disabled = false;
      }
    });

    // P≈ôihl√°≈°en√≠
    loginFormEl.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMessage();

      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;

      const btn = loginFormEl.querySelector('button[type="submit"]');
      const originalText = btn.textContent;
      btn.textContent = 'P≈ôihla≈°uji...';
      btn.disabled = true;

      try {
        await auth.signInWithEmailAndPassword(email, password);
        showMessage("‚úÖ P≈ôihl√°≈°en√≠ √∫spƒõ≈°n√©! P≈ôesmƒõrov√°v√°m...", "success");
        setTimeout(() => {
          window.location.href = "kartao-vyber-uctu.html";
        }, 500);
      } catch (error) {
        let errorMsg = "P≈ôi p≈ôihl√°≈°en√≠ do≈°lo k chybƒõ.";
        if (error.code === 'auth/user-not-found') {
          errorMsg = "U≈æivatel s t√≠mto e-mailem neexistuje.";
        } else if (error.code === 'auth/wrong-password') {
          errorMsg = "Nespr√°vn√© heslo.";
        } else if (error.code === 'auth/invalid-email') {
          errorMsg = "Neplatn√Ω form√°t e-mailu.";
        }
        showMessage(errorMsg, "error");
        btn.textContent = originalText;
        btn.disabled = false;
      }
    });

    // Google p≈ôihl√°≈°en√≠
    if (btnGoogle) {
      btnGoogle.addEventListener("click", async () => {
        clearMessage();
        btnGoogle.disabled = true;
        const originalText = btnGoogle.textContent;
        btnGoogle.textContent = 'P≈ôihla≈°uji...';

        try {
          const result = await auth.signInWithPopup(googleProvider);
          showMessage("‚úÖ P≈ôihl√°≈°en√≠ p≈ôes Google √∫spƒõ≈°n√©! P≈ôesmƒõrov√°v√°m...", "success");
          setTimeout(() => {
            window.location.href = "kartao-vyber-uctu.html";
          }, 500);
        } catch (error) {
          if (error.code !== 'auth/popup-closed-by-user' && error.code !== 'auth/cancelled-popup-request') {
            let errorMsg = "P≈ôihl√°≈°en√≠ p≈ôes Google se nepoda≈ôilo.";
            if (error.code === 'auth/popup-blocked') {
              errorMsg = "Popup bylo blokov√°no. Povolte pros√≠m popup okna.";
            }
            showMessage(errorMsg, "error");
          }
          btnGoogle.textContent = originalText;
          btnGoogle.disabled = false;
        }
      });
    }

    // Lucide ikony
    lucide.createIcons();
  </script>
</main>
</body>
</html>
    <div>
      <input id="login-password" type="password" placeholder="Heslo" required
             class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-fuchsia-500">
    </div>
    <button type="submit" class="w-full py-3 bg-gradient-to-r from-fuchsia-600 to-purple-600 text-white font-semibold rounded-lg hover:brightness-110">
      P≈ôihl√°sit se
    </button>
  </form>

  <!-- REGISTER FORM -->
  <form id="form-register" class="space-y-4 hidden">
    <div>
      <input id="reg-email" type="email" placeholder="E-mail" required
             class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-fuchsia-500">
    </div>
    <div>
      <input id="reg-password" type="password" placeholder="Heslo (min. 6 znak≈Ø)" required minlength="6"
             class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-fuchsia-500">
    </div>
    <div>
      <input id="reg-password2" type="password" placeholder="Heslo znovu" required minlength="6"
             class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-fuchsia-500">
    </div>
    <button type="submit" class="w-full py-3 bg-gradient-to-r from-fuchsia-600 to-purple-600 text-white font-semibold rounded-lg hover:brightness-110">
      Vytvo≈ôit √∫ƒçet
    </button>
  </form>

  <!-- OAuth -->
  <div class="mt-6">
    <div class="text-center text-white/40 text-sm mb-4">nebo</div>
    <button id="btn-google" class="w-full py-3 bg-white/10 border border-white/20 text-white rounded-lg hover:bg-white/20 flex items-center justify-center gap-2">
      <span>G</span>
      <span>Google</span>
    </button>
  </div>

  <div class="mt-6 text-center">
    <a href="index.html" class="text-white/60 text-sm hover:text-white">‚Üê Zpƒõt na hlavn√≠ str√°nku</a>
  </div>
</div>

<script>
console.log('üöÄ LOGIN.HTML SCRIPT STARTED');
console.log('‚úÖ Firebase:', typeof firebase);
console.log('‚úÖ Auth:', typeof auth);
console.log('‚úÖ DB:', typeof db);

// Google provider
const googleProvider = new firebase.auth.GoogleAuthProvider();

// Elements
const msg = document.getElementById('msg');
const tabLogin = document.getElementById('tab-login');
const tabRegister = document.getElementById('tab-register');
const formLogin = document.getElementById('form-login');
const formRegister = document.getElementById('form-register');
const btnGoogle = document.getElementById('btn-google');

let mode = 'login';
let busy = false;

// Helpers
function showMsg(text, type) {
  msg.className = 'mb-4 p-3 rounded-lg text-sm ';
  if (type === 'error') msg.className += 'bg-red-500/20 text-red-200 border border-red-500/50';
  else if (type === 'success') msg.className += 'bg-green-500/20 text-green-200 border border-green-500/50';
  else msg.className += 'bg-yellow-500/20 text-yellow-200 border border-yellow-500/50';
  msg.textContent = text;
  msg.classList.remove('hidden');
}

function hideMsg() {
  msg.classList.add('hidden');
}

function switchMode(m) {
  mode = m;
  hideMsg();
  
  if (m === 'login') {
    tabLogin.className = 'flex-1 py-2 rounded-md font-medium bg-white/20 text-white';
    tabRegister.className = 'flex-1 py-2 rounded-md font-medium text-white/60 hover:text-white';
    formLogin.classList.remove('hidden');
    formRegister.classList.add('hidden');
  } else {
    tabRegister.className = 'flex-1 py-2 rounded-md font-medium bg-white/20 text-white';
    tabLogin.className = 'flex-1 py-2 rounded-md font-medium text-white/60 hover:text-white';
    formRegister.classList.remove('hidden');
    formLogin.classList.add('hidden');
  }
}

async function saveProfile(user) {
  // P≈ôeskoƒçeno - Firestore offline
}

async function redirect(user) {
  // Rovnou na v√Ωbƒõr role
  window.location.href = 'kartao-vyber-uctu.html';
}

// Tabs
tabLogin.onclick = () => switchMode('login');
tabRegister.onclick = () => switchMode('register');

// Login
formLogin.onsubmit = async (e) => {
  e.preventDefault();
  console.log('üîµ Login submit triggered');
  
  if (busy) {
    console.log('‚ö†Ô∏è Already busy, ignoring');
    return;
  }
  busy = true;
  hideMsg();
  
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  const btn = formLogin.querySelector('button');
  
  console.log('üìß Attempting login for:', email);
  
  btn.disabled = true;
  btn.textContent = 'P≈ôihla≈°uji...';
  
  try {
    const cred = await auth.signInWithEmailAndPassword(email, password);
    showMsg('P≈ôihl√°≈°en√≠ √∫spƒõ≈°n√©!', 'success');
    redirect(cred.user);
  } catch (error) {
    console.error('‚ùå Login error:', error);
    let msg = 'Chyba p≈ôi p≈ôihl√°≈°en√≠';
    if (error.code === 'auth/user-not-found') msg = 'U≈æivatel nenalezen';
    else if (error.code === 'auth/wrong-password') msg = '≈†patn√© heslo';
    else if (error.code === 'auth/invalid-email') msg = 'Neplatn√Ω e-mail';
    showMsg(msg, 'error');
    btn.disabled = false;
    btn.textContent = 'P≈ôihl√°sit se';
    busy = false;
  }
};

// Register
formRegister.onsubmit = async (e) => {
  e.preventDefault();
  if (busy) return;
  busy = true;
  hideMsg();
  
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value;
  const password2 = document.getElementById('reg-password2').value;
  const btn = formRegister.querySelector('button');
  
  if (password !== password2) {
    showMsg('Hesla se neshoduj√≠', 'error');
    busy = false;
    return;
  }
  
  if (password.length < 6) {
    showMsg('Heslo mus√≠ m√≠t alespo≈à 6 znak≈Ø', 'error');
    busy = false;
    return;
  }
  
  btn.disabled = true;
  btn.textContent = 'Vytv√°≈ô√≠m...';
  
  try {
    if (auth.currentUser) await auth.signOut();
    
    const cred = await auth.createUserWithEmailAndPassword(email, password);
    await saveProfile(cred.user);
    showMsg('√öƒçet vytvo≈ôen!', 'success');
    
    // Poƒçkej a pak p≈ôesmƒõruj
    setTimeout(() => {
      redirect(cred.user);
    }, 500);
    
  } catch (error) {
    console.error('‚ùå Registrace error:', error);
    let msg = 'Chyba p≈ôi registraci';
    if (error.code === 'auth/email-already-in-use') msg = 'E-mail ji≈æ existuje';
    else if (error.code === 'auth/invalid-email') msg = 'Neplatn√Ω e-mail';
    else if (error.code === 'auth/weak-password') msg = 'Slab√© heslo';
    showMsg(msg, 'error');
    btn.disabled = false;
    btn.textContent = 'Vytvo≈ôit √∫ƒçet';
    busy = false;
  }
};

// Google
btnGoogle.onclick = async () => {
  if (busy) return;
  busy = true;
  hideMsg();
  
  btnGoogle.disabled = true;
  const txt = btnGoogle.innerHTML;
  btnGoogle.textContent = 'P≈ôihla≈°uji...';
  
  try {
    const result = await auth.signInWithPopup(googleProvider);
    await saveProfile(result.user);
    showMsg('P≈ôihl√°≈°en√≠ √∫spƒõ≈°n√©!', 'success');
    setTimeout(() => redirect(result.user), 500);
  } catch (error) {
    if (error.code !== 'auth/popup-closed-by-user' && error.code !== 'auth/cancelled-popup-request') {
      showMsg('Chyba Google p≈ôihl√°≈°en√≠', 'error');
    }
    btnGoogle.innerHTML = txt;
    btnGoogle.disabled = false;
    busy = false;
  }
};

// Redirect result
auth.getRedirectResult().then(async (result) => {
  if (result.user) {
    await saveProfile(result.user);
    await redirect(result.user);
  }
}).catch(console.error);
</script>

</body>
</html>
