<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao.cz ‚Äì P≈ôihl√°≈°en√≠ / registrace</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üîê</text></svg>">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
            emerald: tailwind.colors.emerald,
            sky: tailwind.colors.sky,
            rose: tailwind.colors.rose,
          },
          boxShadow: {
            card: "0 24px 80px rgba(15,23,42,0.85)",
          },
        },
      },
    };
  </script>

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, rgba(236,72,153,0.15), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(251,191,36,0.18), transparent 55%),
                  radial-gradient(circle at bottom left, rgba(56,189,248,0.1), transparent 55%),
                  #020617;
    }

    .glass {
      background: radial-gradient(circle at top left, rgba(248,250,252,0.12), rgba(15,23,42,0.96));
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }

    .tab-active {
      background: linear-gradient(135deg, rgba(251,191,36,0.18), rgba(236,72,153,0.25));
      color: #fefce8;
      border-color: rgba(250,204,21,0.7);
    }

    .tab-inactive {
      background: rgba(15,23,42,0.85);
      color: rgba(148,163,184,1);
      border-color: rgba(51,65,85,1);
    }
  </style>
</head>
<body class="text-slate-100">
  <div class="relative min-h-screen flex flex-col">
    <!-- Dekorativn√≠ kruhy v pozad√≠ -->
    <div class="pointer-events-none fixed inset-0 overflow-hidden">
      <div class="absolute -top-32 -right-24 h-72 w-72 rounded-full bg-fuchsia-500/10 blur-3xl"></div>
      <div class="absolute -bottom-32 -left-24 h-80 w-80 rounded-full bg-amber-400/10 blur-3xl"></div>
      <div class="absolute top-1/3 -left-32 h-64 w-64 rounded-full bg-sky-400/10 blur-3xl"></div>
    </div>

    <!-- Horn√≠ li≈°ta -->
    <header class="relative z-10 w-full">
      <div class="mx-auto max-w-6xl px-4 pt-6 flex items-center justify-between">
        <a href="vyber-ucet.html" class="inline-flex items-center gap-2 text-sm text-slate-300 hover:text-white transition">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-900/70 ring-1 ring-slate-700/60">
            ‚Üê
          </span>
          Zpƒõt na v√Ωbƒõr √∫ƒçtu
        </a>

        <!-- Kartao brand badge s korunkou -->
          <div
            class="inline-flex items-center gap-3 px-3 py-1.5 rounded-full bg-slate-900/80 ring-1 ring-slate-700/70 shadow-lg shadow-black/40"
          >
            <!-- Ikona s korunkou -->
            <div
              class="relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-amber-400 via-fuchsia-500 to-sky-400 shadow-md shadow-amber-500/40"
            >
              <i
                data-lucide="crown"
                class="w-4 h-4 text-black/80"
              ></i>
            </div>

            <!-- Textov√° ƒç√°st -->
            <div class="flex flex-col leading-tight">
              <span
                class="text-xs font-semibold tracking-wide text-slate-200"
              >
                Kartao.cz
              </span>
              <span
                class="text-[10px] uppercase tracking-[0.18em] text-slate-400"
              >
                S√≠≈• influencer≈Ø
              </span>
            </div>
        </div>
      </div>
    </header>

    <!-- Obsah -->
    <main class="relative z-10 flex-1 flex items-center justify-center px-4 py-8">
      <div class="mx-auto flex w-full max-w-5xl flex-col gap-8 lg:flex-row lg:items-stretch">
        <!-- Info blok vlevo -->
        <section class="glass relative w-full max-w-xl rounded-3xl border border-slate-700/70 p-7 lg:p-9 shadow-card">
          <div id="rolePill" class="absolute -top-6 right-6 inline-flex items-center gap-2 rounded-full border border-amber-400/60 bg-black/70 px-3 py-1 text-[18px] font-medium tracking-wide text-amber-100 shadow-lg shadow-amber-500/30">
            <span class="h-1.5 w-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
            P≈ôihl√°≈°en√≠ do ekosyst√©mu
          </div>

          <h1 class="mb-4 text-3xl sm:text-4xl font-bold tracking-tight">
            P≈ôihl√°≈°en√≠
            <span id="roleHeading" class="block bg-gradient-to-r from-amber-300 via-fuchsia-300 to-sky-300 bg-clip-text text-transparent">Kartao √∫ƒçtu</span>
          </h1>
          <p id="roleDescription" class="mb-6 text-sm sm:text-base text-slate-300/90">
            Jedno bezpeƒçn√© p≈ôihl√°≈°en√≠ pro v≈°echny funkce Kartao.cz.
          </p>

          <ul class="mb-6 space-y-3 text-sm text-slate-200/90">
            <li class="flex items-start gap-2">
              <span class="mt-0.5 text-emerald-400">‚óè</span>
              <div>
                <span class="font-semibold text-slate-50">Bezpeƒçn√© p≈ôihl√°≈°en√≠</span> ‚Äì hesla se ukl√°daj√≠ v Firebase, Kartao.cz je nikdy nevid√≠.
              </div>
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-0.5 text-sky-400">‚óè</span>
              <div>
                <span class="font-semibold text-slate-50">Jednotn√Ω √∫ƒçet</span> ‚Äì stejn√Ω e-mail pou≈æ√≠v√°≈° pro v≈°echny dashboardy a funkce.
              </div>
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-0.5 text-amber-400">‚óè</span>
              <div>
                <span class="font-semibold text-slate-50">Role √∫ƒçtu</span> ‚Äì influencer nebo firma, podle volby na p≈ôedchoz√≠ obrazovce.
              </div>
            </li>
          </ul>

          <div class="mt-auto flex flex-wrap items-center gap-3 pt-2">
            <div class="inline-flex items-center gap-2 rounded-full bg-slate-900/70 px-3 py-1 text-[11px] uppercase tracking-[0.18em] text-slate-400 ring-1 ring-slate-700/80">
              <span class="inline-flex h-4 w-4 items-center justify-center rounded-full bg-emerald-400/10 text-[11px]">üîí</span>
              Firebase Authentication
            </div>
            <span class="text-[11px] text-slate-500">
              Po p≈ôihl√°≈°en√≠ tƒõ p≈ôesmƒõrujeme na spr√°vn√Ω dashboard podle role.
            </span>
          </div>
        </section>

        <!-- P≈ôihla≈°ovac√≠ panel vpravo -->
        <section class="relative w-full lg:max-w-md flex flex-col gap-4">
          <!-- Tabs p≈ôihl√°≈°en√≠ / registrace -->
          <div class="mb-2 inline-flex rounded-full bg-slate-900/80 p-1 ring-1 ring-slate-700/80 shadow-lg shadow-black/40">
            <button id="tabLogin" type="button" class="tab-active flex-1 rounded-full border px-4 py-1.5 text-center text-xs font-semibold uppercase tracking-[0.16em]">
              P≈ôihl√°≈°en√≠
            </button>
            <button id="tabRegister" type="button" class="tab-inactive flex-1 rounded-full border px-4 py-1.5 text-center text-xs font-semibold uppercase tracking-[0.16em]">
              Registrace
            </button>
          </div>

          <!-- Hl√°≈°ky / chyby -->
          <div id="messageBox" class="hidden rounded-2xl border border-rose-500/50 bg-rose-500/10 px-3 py-2 text-[11px] text-rose-50"></div>

          <!-- Loader p≈ôi ovƒõ≈ôov√°n√≠ -->
          <div id="loader" class="hidden flex items-center gap-2 text-xs text-slate-300">
            <span class="h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span>
            Ovƒõ≈ôujeme p≈ôihl√°≈°en√≠‚Ä¶
          </div>

          <!-- Formul√°≈ô p≈ôihl√°≈°en√≠ -->
          <form id="loginForm" class="space-y-4 rounded-3xl border border-slate-700/70 bg-black/70 p-6 shadow-card">
            <div class="flex items-center justify-between gap-3">
              <div class="flex flex-col">
                <span class="text-xs font-semibold uppercase tracking-[0.20em] text-slate-400">P≈ôihl√°≈°en√≠</span>
                <span id="loginSubheading" class="text-sm text-slate-200">Zadej e-mail a heslo k existuj√≠c√≠mu √∫ƒçtu.</span>
              </div>
              <div id="roleBadge" class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-3 py-1 text-[11px] text-slate-300 ring-1 ring-slate-700/80">
                <span class="text-xs">üí≥</span>
                <span>√öƒçet Kartao</span>
              </div>
            </div>

            <div class="space-y-3 text-sm">
              <div>
                <label for="loginEmail" class="mb-1 block text-xs font-medium text-slate-300">E-mail</label>
                <input id="loginEmail" type="email" required autocomplete="email" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-amber-400 focus:ring-2 focus:ring-amber-400/40" placeholder="tvoje@email.cz" />
              </div>
              <div>
                <label for="loginPassword" class="mb-1 block text-xs font-medium text-slate-300">Heslo</label>
                <input id="loginPassword" type="password" required autocomplete="current-password" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-amber-400 focus:ring-2 focus:ring-amber-400/40" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              </div>
            </div>

            <div class="flex items-center justify-between text-[11px] text-slate-400">
              <label class="inline-flex items-center gap-2">
                <input type="checkbox" class="h-3.5 w-3.5 rounded border-slate-600 bg-slate-900 text-amber-400 focus:ring-0" />
                <span>Z≈Østat p≈ôihl√°≈°en</span>
              </label>
              <button type="button" class="hover:text-slate-200">Zapomenut√© heslo</button>
            </div>

            <button type="submit" class="flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-amber-400 via-fuchsia-500 to-sky-400 px-4 py-2.5 text-sm font-semibold text-slate-950 shadow-lg shadow-fuchsia-500/40 transition hover:brightness-110">
              <span>P≈ôihl√°sit se</span>
            </button>

            <div class="relative py-2 text-center text-[11px] text-slate-500">
              <span class="relative z-10 bg-black/70 px-3">nebo</span>
              <div class="absolute inset-x-0 top-1/2 -z-0 border-t border-slate-700/80"></div>
            </div>

            <button id="googleLogin" type="button" class="flex w-full items-center justify-center gap-2 rounded-2xl border border-slate-700 bg-slate-950/70 px-4 py-2 text-sm font-medium text-slate-100 hover:bg-slate-900/80">
              <span class="text-lg">G</span>
              <span>P≈ôihl√°sit se p≈ôes Google</span>
            </button>
          </form>

          <!-- Formul√°≈ô registrace -->
          <form id="registerForm" class="hidden space-y-4 rounded-3xl border border-slate-700/70 bg-black/70 p-6 shadow-card">
            <div class="flex items-center justify-between gap-3">
              <div class="flex flex-col">
                <span class="text-xs font-semibold uppercase tracking-[0.20em] text-slate-400">Registrace</span>
                <span id="registerSubheading" class="text-sm text-slate-200">Vytvo≈ô si nov√Ω Kartao √∫ƒçet.</span>
              </div>
              <div id="roleBadgeReg" class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-3 py-1 text-[11px] text-slate-300 ring-1 ring-slate-700/80">
                <span class="text-xs">‚ú®</span>
                <span>Nov√Ω √∫ƒçet</span>
              </div>
            </div>

            <div class="space-y-3 text-sm">
              <div>
                <label for="registerEmail" class="mb-1 block text-xs font-medium text-slate-300">E-mail</label>
                <input id="registerEmail" type="email" required autocomplete="email" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2 focus:ring-emerald-400/40" placeholder="tvoje@email.cz" />
              </div>
              <div>
                <label for="registerPassword" class="mb-1 block text-xs font-medium text-slate-300">Heslo</label>
                <input id="registerPassword" type="password" required autocomplete="new-password" minlength="6" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2 focus:ring-emerald-400/40" placeholder="min. 6 znak≈Ø" />
              </div>
            </div>

            <p class="text-[11px] text-slate-500">
              Registrac√≠ souhlas√≠≈° s podm√≠nkami pou≈æit√≠ a zpracov√°n√≠m √∫daj≈Ø pro provoz platformy Kartao.cz.
            </p>

            <button type="submit" class="flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-emerald-400 via-sky-400 to-amber-300 px-4 py-2.5 text-sm font-semibold text-slate-950 shadow-lg shadow-emerald-500/40 transition hover:brightness-110">
              <span>Vytvo≈ôit √∫ƒçet</span>
            </button>
          </form>

          <div class="mt-2 flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500">
            <span>Vr√°tit se na <a href="index.html" class="text-amber-200 hover:text-amber-100 underline underline-offset-2">hlavn√≠ str√°nku</a></span>
            <span>Po p≈ôihl√°≈°en√≠: dashboard influencera nebo firmy podle role.</span>
          </div>
        </section>
      </div>
    </main>

    <!-- Spodn√≠ info -->
    <footer class="relative z-10 border-t border-slate-800/80 bg-black/40">
      <div class="mx-auto flex max-w-6xl flex-wrap items-center justify-between gap-3 px-4 py-4 text-[11px] text-slate-500">
        <span>¬© <span id="year"></span> Kartao.cz ‚Äì digit√°ln√≠ ekosyst√©m spoluprac√≠.</span>
        <div class="flex flex-wrap items-center gap-3">
          <span class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-2.5 py-1 ring-1 ring-slate-700/80">
            <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
            <span>Bezpeƒçn√© p≈ôihl√°≈°en√≠ p≈ôes Firebase</span>
          </span>
          <a href="#" class="hover:text-slate-300">Podm√≠nky pou≈æit√≠</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Firebase SDK (mus√≠ b√Ωt p≈ôed firebase-config/init) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

  <!-- Konfigurace + jednotn√° inicializace -->
  <script src="firebase-config.js"></script>
  <script src="firebase-init.js"></script>

  <script>
    // aktu√°ln√≠ rok do patiƒçky
    document.getElementById("year").textContent = new Date().getFullYear();

    // --- Role z URL + sessionStorage ---
    const params = new URLSearchParams(window.location.search);
    let selectedRole = params.get("role");

    if (selectedRole) {
      sessionStorage.setItem("kartaoRole", selectedRole);
    } else {
      selectedRole = sessionStorage.getItem("kartaoRole") || null;
    }

    window.kartaoRole = selectedRole || "influencer";

    function applyRoleText(role) {
      const roleHeading = document.getElementById("roleHeading");
      const roleDescription = document.getElementById("roleDescription");
      const rolePill = document.getElementById("rolePill");
      const roleBadge = document.getElementById("roleBadge");
      const roleBadgeReg = document.getElementById("roleBadgeReg");
      const loginSubheading = document.getElementById("loginSubheading");
      const registerSubheading = document.getElementById("registerSubheading");

      if (role === "firma") {
        roleHeading.textContent = "firemn√≠ho √∫ƒçtu";
        roleDescription.textContent = "P≈ôihl√°≈°en√≠ pro firmy, znaƒçky, agentury a projekty, kter√© chtƒõj√≠ zad√°vat kampanƒõ a pracovat s influencery.";
        rolePill.innerHTML = '<span class="h-4 w-4 rounded-full bg-emerald-400 animate-pulse"></span> Firemn√≠ √∫ƒçet';
        roleBadge.innerHTML = '<span class="text-xs">üè¢</span><span>Firemn√≠ √∫ƒçet</span>';
        roleBadgeReg.innerHTML = '<span class="text-xs">üè¢</span><span>Nov√Ω firemn√≠ √∫ƒçet</span>';
        loginSubheading.textContent = "P≈ôihl√°≈°en√≠ pro firmy a znaƒçky zad√°vaj√≠c√≠ kampanƒõ.";
        registerSubheading.textContent = "Zalo≈æ si firemn√≠ Kartao √∫ƒçet pro kampanƒõ a spolupr√°ce.";
      } else {
        roleHeading.textContent = "influencer √∫ƒçtu";
        roleDescription.textContent = "P≈ôihl√°≈°en√≠ pro tv≈Ørce obsahu, sportovce, streamery a osobnosti, kter√© sb√≠raj√≠ K-Coins a spolupr√°ce.";
        rolePill.innerHTML = '<span class="h-4 w-4 rounded-full bg-emerald-400 animate-pulse"></span> Influencer √∫ƒçet';
        roleBadge.innerHTML = '<span class="text-xs">‚≠ê</span><span>Influencer √∫ƒçet</span>';
        roleBadgeReg.innerHTML = '<span class="text-xs">‚≠ê</span><span>Nov√Ω influencer √∫ƒçet</span>';
        loginSubheading.textContent = "P≈ôihl√°≈°en√≠ pro influencery a tv≈Ørce obsahu.";
        registerSubheading.textContent = "Zalo≈æ si influencer √∫ƒçet a zaƒçni sb√≠rat K-Coins.";
      }
    }

    applyRoleText(window.kartaoRole);

    // --- P≈ôep√≠n√°n√≠ tab≈Ø ---
    const tabLogin = document.getElementById("tabLogin");
    const tabRegister = document.getElementById("tabRegister");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");

    function setTab(active) {
      if (active === "login") {
        tabLogin.classList.add("tab-active");
        tabLogin.classList.remove("tab-inactive");
        tabRegister.classList.add("tab-inactive");
        tabRegister.classList.remove("tab-active");
        loginForm.classList.remove("hidden");
        registerForm.classList.add("hidden");
      } else {
        tabRegister.classList.add("tab-active");
        tabRegister.classList.remove("tab-inactive");
        tabLogin.classList.add("tab-inactive");
        tabLogin.classList.remove("tab-active");
        registerForm.classList.remove("hidden");
        loginForm.classList.add("hidden");
      }
    }

    tabLogin.addEventListener("click", () => setTab("login"));
    tabRegister.addEventListener("click", () => setTab("register"));

    const messageBox = document.getElementById("messageBox");
    const loader = document.getElementById("loader");

    function showMessage(text, type = "error") {
      messageBox.textContent = text;
      messageBox.classList.remove("hidden");

      if (type === "error") {
        messageBox.classList.remove("bg-emerald-500/10", "border-emerald-500/50");
        messageBox.classList.add("bg-rose-500/10", "border-rose-500/50");
      } else {
        messageBox.classList.remove("bg-rose-500/10", "border-rose-500/50");
        messageBox.classList.add("bg-emerald-500/10", "border-emerald-500/50");
      }
    }

    function hideMessage() {
      messageBox.classList.add("hidden");
    }

    function setLoading(isLoading) {
      loader.classList.toggle("hidden", !isLoading);
    }

    // --- Firebase auth + db p≈ôes jednotn√Ω init ---
    const auth = window.auth || (window.firebase && firebase.auth && firebase.auth());
    const db   = window.db   || (window.firebase && firebase.firestore && firebase.firestore());

    if (!auth || !db) {
      console.error("Auth nebo DB nejsou dostupn√© ‚Äì zkontroluj firebase-config.js a firebase-init.js");
      showMessage("Chyba p≈ôipojen√≠ k p≈ôihla≈°ovac√≠mu syst√©mu. Zkus obnovit str√°nku.", "error");
    } else {
      async function routeUser(user) {
        if (!user) return;
        setLoading(true);
        let finalRole = window.kartaoRole || "influencer";

        try {
          const doc = await db.collection("users").doc(user.uid).get();
          if (doc.exists && doc.data().role) {
            finalRole = doc.data().role;
          } else {
            await db.collection("users").doc(user.uid).set(
              {
                email: user.email || null,
                role: finalRole,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
              },
              { merge: true }
            );
          }
        } catch (err) {
          console.error("Chyba p≈ôi naƒç√≠t√°n√≠ role, pokraƒçuju podle URL:", err);
        } finally {
          setLoading(false);
        }

        if (finalRole === "firma") {
          window.location.href = "index.html";
        } else {
          window.location.href = "index.html";
        }
      }

      // Pokud je u≈æ p≈ôihl√°≈°en -> rovnou p≈ôesmƒõruj
      auth.onAuthStateChanged((user) => {
        if (user) {
          routeUser(user);
        }
      });

      // --- P≈ôihl√°≈°en√≠ ---
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessage();
        setLoading(true);
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value;

        try {
          const cred = await auth.signInWithEmailAndPassword(email, password);
          await routeUser(cred.user);
        } catch (err) {
          console.error("Auth error:", err);
          let msg = "P≈ôihl√°≈°en√≠ se nezda≈ôilo. Zkontroluj e-mail a heslo.";
          if (err.code === "auth/user-not-found") msg = "√öƒçet s t√≠mto e-mailem neexistuje.";
          if (err.code === "auth/wrong-password") msg = "≈†patn√© heslo.";
          if (err.code === "auth/invalid-email") msg = "Neplatn√Ω form√°t e-mailu.";
          if (err.code === "auth/unauthorized-domain") msg = "Dom√©na nen√≠ povolena ve Firebase (Authorized domains).";
          showMessage(msg + " (" + err.code + ")");
        } finally {
          setLoading(false);
        }
      });

      // --- Registrace ---
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessage();
        setLoading(true);
        const email = document.getElementById("registerEmail").value.trim();
        const password = document.getElementById("registerPassword").value;
        const role = window.kartaoRole || "influencer";

        try {
          const cred = await auth.createUserWithEmailAndPassword(email, password);
          const user = cred.user;
          await db.collection("users").doc(user.uid).set(
            {
              email: user.email || email,
              role: role,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            },
            { merge: true }
          );

          showMessage("√öƒçet byl √∫spƒõ≈°nƒõ vytvo≈ôen. Prob√≠h√° p≈ôihl√°≈°en√≠‚Ä¶", "success");
          await routeUser(user);
        } catch (err) {
          console.error("Register error:", err);
          let msg = "Registrace se nezda≈ôila. Zkontroluj e-mail a heslo (min. 6 znak≈Ø).";

          if (err.code === "auth/email-already-in-use") {
            msg = "Tento e-mail u≈æ m√° vytvo≈ôen√Ω √∫ƒçet. P≈ôejdi na z√°lo≈æku P≈ôihl√°≈°en√≠ a zkus se p≈ôihl√°sit.";
          }
          if (err.code === "auth/weak-password") {
            msg = "Heslo je p≈ô√≠li≈° slab√©. Pou≈æij alespo≈à 6 znak≈Ø.";
          }
          if (err.code === "auth/invalid-email") {
            msg = "Neplatn√Ω form√°t e-mailu.";
          }
          if (err.code === "auth/operation-not-allowed") {
            msg = "V Firebase nen√≠ povolen√© p≈ôihl√°≈°en√≠ pomoc√≠ e-mailu/hesla (zapni v Sign-in method).";
          }
          if (err.code === "auth/unauthorized-domain") {
            msg = "Dom√©na kartao.cz nen√≠ povolen√° v Firebase (p≈ôidej ji do Authorized domains).";
          }

          showMessage(msg + " (" + err.code + ")");
        } finally {
          setLoading(false);
        }
      });

      // --- Google login ---
      const googleBtn = document.getElementById("googleLogin");
      googleBtn.addEventListener("click", async () => {
        hideMessage();
        setLoading(true);
        const provider = new firebase.auth.GoogleAuthProvider();

        try {
          const result = await auth.signInWithPopup(provider);
          const user = result.user;
          const role = window.kartaoRole || "influencer";

          await db.collection("users").doc(user.uid).set(
            {
              email: user.email || null,
              role: role,
              updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            },
            { merge: true }
          );

          await routeUser(user);
        } catch (err) {
          console.error("Google login error:", err);
          let msg = "P≈ôihl√°≈°en√≠ p≈ôes Google se nezda≈ôilo. Zkus to pros√≠m znovu.";
          if (err.code === "auth/unauthorized-domain") {
            msg = "Dom√©na kartao.cz nen√≠ povolen√° v Firebase (p≈ôidej ji do Authorized domains).";
          }
          showMessage(msg + " (" + err.code + ")");
        } finally {
          setLoading(false);
        }
      });
    }
  </script>
  <script>
      // aktu√°ln√≠ rok do patiƒçky
      document.getElementById("year").textContent =
        new Date().getFullYear();
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (window.lucide) {
          lucide.createIcons();
        }
      });
    </script>
</body>
</html>
