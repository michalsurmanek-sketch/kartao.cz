<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="P≈ôihlaste se do Kartao.cz - platformy pro influencery a znaƒçky">
  <meta name="robots" content="noindex, nofollow">
  <title>P≈ôihl√°≈°en√≠ - Kartao.cz</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üîë</text></svg>">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, #db58f6 0, transparent 55%),
                  radial-gradient(circle at bottom right, #fbbf24 0, #020617 55%);
    }
  </style>
</head>
<body class="min-h-screen bg-neutral-950 text-white">

<!-- Header -->
<header class="border-b border-white/10 bg-neutral-900/50">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-3">
      <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
        <span class="text-lg font-bold">K</span>
      </div>
      <div>
        <div class="font-extrabold tracking-tight text-lg">Kartao.cz</div>
        <div class="text-xs text-white/60 -mt-0.5">S√≠≈• influencer≈Ø a tv≈Ørc≈Ø</div>
      </div>
    </a>
  </div>
</header>

<main class="flex-1 flex items-center justify-center px-4 py-10">
  <div class="w-full max-w-md bg-neutral-900/80 border border-white/10 rounded-2xl shadow-xl backdrop-blur-md p-8">
    
    <!-- Logo -->
    <div class="flex items-center gap-3 mb-6">
      <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
        <span class="text-xl font-bold">K</span>
      </div>
      <div>
        <div class="font-extrabold tracking-tight text-lg">P≈ôihl√°≈°en√≠</div>
        <div class="text-xs text-white/60 -mt-0.5">Kartao.cz</div>
      </div>
    </div>

    <!-- P≈ôep√≠naƒç P≈ôihl√°≈°en√≠ / Registrace -->
    <div class="flex mb-6 rounded-xl bg-neutral-800/80 p-1 text-sm">
      <button id="btn-switch-login" type="button" class="flex-1 py-2 rounded-lg font-medium transition bg-neutral-900 text-white">
        P≈ôihl√°≈°en√≠
      </button>
      <button id="btn-switch-register" type="button" class="flex-1 py-2 rounded-lg font-medium transition text-white/70 hover:text-white">
        Registrace
      </button>
    </div>

    <!-- Zpr√°vy -->
    <div id="message-box" class="hidden mb-4 p-3 rounded-lg text-sm"></div>

    <!-- Formul√°≈ô P≈ôihl√°≈°en√≠ -->
    <form id="form-login" class="space-y-4">
      <div>
        <label class="block text-sm mb-1" for="login-email">E-mail</label>
        <input id="login-email" type="email" required autocomplete="email"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400">
      </div>
      <div>
        <label class="block text-sm mb-1" for="login-password">Heslo</label>
        <input id="login-password" type="password" required autocomplete="current-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400">
      </div>
      <button type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
        P≈ôihl√°sit se
      </button>
    </form>

    <!-- Formul√°≈ô Registrace (skryt√Ω) -->
    <form id="form-register" class="space-y-4 hidden">
      <div>
        <label class="block text-sm mb-1" for="reg-email">E-mail</label>
        <input id="reg-email" type="email" required autocomplete="email"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400">
      </div>
      <div>
        <label class="block text-sm mb-1" for="reg-password">Heslo</label>
        <input id="reg-password" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400">
        <p class="mt-1 text-xs text-white/50">Minim√°lnƒõ 6 znak≈Ø</p>
      </div>
      <div>
        <label class="block text-sm mb-1" for="reg-password2">Heslo znovu</label>
        <input id="reg-password2" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl bg-neutral-900 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-fuchsia-400">
      </div>
      <button type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
        Vytvo≈ôit √∫ƒçet
      </button>
      <p class="text-xs text-white/50 text-center">
        Registrac√≠ souhlas√≠te s <a href="obchodni-podminky.html" class="underline">podm√≠nkami pou≈æit√≠</a>
      </p>
    </form>

    <!-- Oddƒõlovaƒç -->
    <div class="my-4 text-center">
      <span class="text-xs text-white/40">nebo</span>
    </div>

    <!-- OAuth tlaƒç√≠tka -->
    <button id="btn-google" type="button" class="w-full py-2.5 rounded-xl border border-white/15 bg-neutral-900/80 text-sm font-medium text-white/80 hover:bg-neutral-800 transition flex items-center justify-center gap-2 mb-2">
      <span class="text-lg">G</span>
      <span>Pokraƒçovat p≈ôes Google</span>
    </button>

    <button id="btn-facebook" type="button" class="w-full py-2.5 rounded-xl border border-white/15 bg-neutral-900/80 text-sm font-medium text-white/80 hover:bg-neutral-800 transition flex items-center justify-center gap-2">
      <span class="text-lg">f</span>
      <span>Pokraƒçovat p≈ôes Facebook</span>
    </button>

    <p class="mt-6 text-center text-xs text-white/40">
      Pot≈ôebujete pomoct? <a href="mailto:podpora@kartao.cz" class="underline">podpora@kartao.cz</a>
    </p>
  </div>
</main>

<script>
// ============================================
// FIREBASE INICIALIZACE
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyAmUuqkye67hhyoauRJiUVi_UVEdzU7hTI",
  authDomain: "kartao-cz.firebaseapp.com",
  projectId: "kartao-cz",
  storageBucket: "kartao-cz.appspot.com",
  messagingSenderId: "712778602439",
  appId: "1:712778602439:web:14e2b4c07ea35f70a16be2"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.firestore();

// OAuth providery
const googleProvider = new firebase.auth.GoogleAuthProvider();
const facebookProvider = new firebase.auth.FacebookAuthProvider();

// ============================================
// GLOB√ÅLN√ç PROMƒöNN√â
// ============================================
let isProcessing = false;
let currentMode = 'login'; // 'login' nebo 'register'

// ============================================
// DOM ELEMENTY
// ============================================
const messageBox = document.getElementById('message-box');
const formLogin = document.getElementById('form-login');
const formRegister = document.getElementById('form-register');
const btnSwitchLogin = document.getElementById('btn-switch-login');
const btnSwitchRegister = document.getElementById('btn-switch-register');
const btnGoogle = document.getElementById('btn-google');
const btnFacebook = document.getElementById('btn-facebook');

// ============================================
// HELPER FUNKCE
// ============================================
function showMessage(text, type = 'info') {
  messageBox.innerHTML = text;
  messageBox.classList.remove('hidden', 'bg-red-900/60', 'border-red-400', 'bg-emerald-900/60', 'border-emerald-400', 'bg-amber-900/40', 'border-amber-300');
  
  if (type === 'error') {
    messageBox.classList.add('bg-red-900/60', 'border-red-400', 'border');
  } else if (type === 'success') {
    messageBox.classList.add('bg-emerald-900/60', 'border-emerald-400', 'border');
  } else {
    messageBox.classList.add('bg-amber-900/40', 'border-amber-300', 'border');
  }
}

function hideMessage() {
  messageBox.classList.add('hidden');
}

function switchMode(mode) {
  currentMode = mode;
  hideMessage();
  
  if (mode === 'login') {
    btnSwitchLogin.classList.add('bg-neutral-900', 'text-white');
    btnSwitchLogin.classList.remove('text-white/70');
    btnSwitchRegister.classList.remove('bg-neutral-900', 'text-white');
    btnSwitchRegister.classList.add('text-white/70');
    formLogin.classList.remove('hidden');
    formRegister.classList.add('hidden');
  } else {
    btnSwitchRegister.classList.add('bg-neutral-900', 'text-white');
    btnSwitchRegister.classList.remove('text-white/70');
    btnSwitchLogin.classList.remove('bg-neutral-900', 'text-white');
    btnSwitchLogin.classList.add('text-white/70');
    formRegister.classList.remove('hidden');
    formLogin.classList.add('hidden');
  }
}

async function saveUserProfile(user) {
  if (!user) return;
  
  try {
    const providerId = user.providerData?.[0]?.providerId || 'password';
    await db.collection('users').doc(user.uid).set({
      email: user.email || '',
      displayName: user.displayName || '',
      photoURL: user.photoURL || '',
      provider: providerId,
      emailVerified: !!user.emailVerified,
      updatedAt: new Date().toISOString()
    }, { merge: true });
    
    console.log('‚úÖ Profil ulo≈æen:', user.uid);
  } catch (error) {
    console.error('‚ùå Chyba p≈ôi ukl√°d√°n√≠ profilu:', error);
  }
}

async function redirectUser(user) {
  try {
    const userDoc = await db.collection('users').doc(user.uid).get();
    const role = userDoc.exists ? userDoc.data()?.role : null;
    
    console.log('üìç Role u≈æivatele:', role || '≈æ√°dn√°');
    
    if (role === 'creator') {
      window.location.href = 'creator-dashboard.html';
    } else if (role === 'company') {
      window.location.href = 'firm-dashboard.html';
    } else {
      window.location.href = 'kartao-vyber-uctu.html';
    }
  } catch (error) {
    console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ role:', error);
    window.location.href = 'kartao-vyber-uctu.html';
  }
}

// ============================================
// P≈òEP√çN√ÅN√ç RE≈ΩIM≈Æ
// ============================================
btnSwitchLogin.addEventListener('click', () => switchMode('login'));
btnSwitchRegister.addEventListener('click', () => switchMode('register'));

// ============================================
// P≈òIHL√Å≈†EN√ç
// ============================================
formLogin.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  if (isProcessing) return;
  isProcessing = true;
  
  hideMessage();
  
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  const btn = formLogin.querySelector('button[type="submit"]');
  
  btn.disabled = true;
  btn.textContent = 'P≈ôihla≈°uji...';
  
  try {
    const userCredential = await auth.signInWithEmailAndPassword(email, password);
    await saveUserProfile(userCredential.user);
    
    showMessage('‚úÖ P≈ôihl√°≈°en√≠ √∫spƒõ≈°n√©! P≈ôesmƒõrov√°v√°m...', 'success');
    
    setTimeout(() => {
      redirectUser(userCredential.user);
    }, 1000);
    
  } catch (error) {
    console.error('‚ùå Chyba p≈ôi p≈ôihl√°≈°en√≠:', error);
    
    let errorMsg = 'P≈ôi p≈ôihl√°≈°en√≠ do≈°lo k chybƒõ.';
    
    if (error.code === 'auth/user-not-found') {
      errorMsg = '‚ùå U≈æivatel s t√≠mto e-mailem neexistuje.';
    } else if (error.code === 'auth/wrong-password') {
      errorMsg = '‚ùå Nespr√°vn√© heslo.';
    } else if (error.code === 'auth/invalid-email') {
      errorMsg = '‚ùå Neplatn√Ω form√°t e-mailu.';
    } else if (error.code === 'auth/user-disabled') {
      errorMsg = '‚ùå Tento √∫ƒçet byl deaktivov√°n.';
    } else if (error.code === 'auth/too-many-requests') {
      errorMsg = '‚ùå P≈ô√≠li≈° mnoho pokus≈Ø. Zkuste to pozdƒõji.';
    }
    
    showMessage(errorMsg, 'error');
    btn.disabled = false;
    btn.textContent = 'P≈ôihl√°sit se';
  } finally {
    isProcessing = false;
  }
});

// ============================================
// REGISTRACE
// ============================================
formRegister.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  if (isProcessing) return;
  isProcessing = true;
  
  hideMessage();
  
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value;
  const password2 = document.getElementById('reg-password2').value;
  const btn = formRegister.querySelector('button[type="submit"]');
  
  // Kontrola hesel
  if (password !== password2) {
    showMessage('‚ùå Hesla se neshoduj√≠!', 'error');
    isProcessing = false;
    return;
  }
  
  if (password.length < 6) {
    showMessage('‚ùå Heslo mus√≠ m√≠t alespo≈à 6 znak≈Ø!', 'error');
    isProcessing = false;
    return;
  }
  
  btn.disabled = true;
  btn.textContent = 'Vytv√°≈ô√≠m √∫ƒçet...';
  
  try {
    // Pokud je nƒõkdo p≈ôihl√°≈°en, odhl√°sit
    if (auth.currentUser) {
      await auth.signOut();
      await new Promise(resolve => setTimeout(resolve, 300));
    }
    
    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
    await saveUserProfile(userCredential.user);
    
    showMessage('‚úÖ √öƒçet vytvo≈ôen! P≈ôesmƒõrov√°v√°m na v√Ωbƒõr role...', 'success');
    
    setTimeout(() => {
      window.location.href = 'kartao-vyber-uctu.html';
    }, 1500);
    
  } catch (error) {
    console.error('‚ùå Chyba p≈ôi registraci:', error);
    
    let errorMsg = 'P≈ôi registraci do≈°lo k chybƒõ.';
    
    if (error.code === 'auth/email-already-in-use') {
      errorMsg = '‚ùå Tento e-mail je ji≈æ registrov√°n. P≈ôejdƒõte na p≈ôihl√°≈°en√≠.';
    } else if (error.code === 'auth/invalid-email') {
      errorMsg = '‚ùå Neplatn√Ω form√°t e-mailu.';
    } else if (error.code === 'auth/weak-password') {
      errorMsg = '‚ùå Heslo je p≈ô√≠li≈° slab√©. Pou≈æijte alespo≈à 6 znak≈Ø.';
    }
    
    showMessage(errorMsg, 'error');
    btn.disabled = false;
    btn.textContent = 'Vytvo≈ôit √∫ƒçet';
  } finally {
    isProcessing = false;
  }
});

// ============================================
// GOOGLE OAUTH
// ============================================
btnGoogle.addEventListener('click', async () => {
  if (isProcessing) return;
  isProcessing = true;
  
  hideMessage();
  btnGoogle.disabled = true;
  const originalText = btnGoogle.innerHTML;
  btnGoogle.textContent = 'P≈ôihla≈°uji p≈ôes Google...';
  
  try {
    const result = await auth.signInWithPopup(googleProvider);
    await saveUserProfile(result.user);
    
    showMessage('‚úÖ P≈ôihl√°≈°en√≠ p≈ôes Google √∫spƒõ≈°n√©!', 'success');
    
    setTimeout(() => {
      redirectUser(result.user);
    }, 1000);
    
  } catch (error) {
    console.error('‚ùå Google OAuth chyba:', error);
    
    let errorMsg = 'P≈ôihl√°≈°en√≠ p≈ôes Google se nepoda≈ôilo.';
    
    if (error.code === 'auth/popup-closed-by-user') {
      errorMsg = 'P≈ôihl√°≈°en√≠ bylo zru≈°eno.';
    } else if (error.code === 'auth/popup-blocked') {
      errorMsg = 'Popup bylo blokov√°no. Povolte pros√≠m popup okna.';
    } else if (error.code === 'auth/cancelled-popup-request') {
      // Tich√° ignorace
      btnGoogle.innerHTML = originalText;
      btnGoogle.disabled = false;
      isProcessing = false;
      return;
    }
    
    showMessage(errorMsg, 'error');
    btnGoogle.innerHTML = originalText;
    btnGoogle.disabled = false;
  } finally {
    if (error?.code !== 'auth/cancelled-popup-request') {
      isProcessing = false;
    }
  }
});

// ============================================
// FACEBOOK OAUTH
// ============================================
btnFacebook.addEventListener('click', async () => {
  if (isProcessing) return;
  isProcessing = true;
  
  hideMessage();
  btnFacebook.disabled = true;
  const originalText = btnFacebook.innerHTML;
  btnFacebook.textContent = 'P≈ôihla≈°uji p≈ôes Facebook...';
  
  try {
    const result = await auth.signInWithPopup(facebookProvider);
    await saveUserProfile(result.user);
    
    showMessage('‚úÖ P≈ôihl√°≈°en√≠ p≈ôes Facebook √∫spƒõ≈°n√©!', 'success');
    
    setTimeout(() => {
      redirectUser(result.user);
    }, 1000);
    
  } catch (error) {
    console.error('‚ùå Facebook OAuth chyba:', error);
    
    let errorMsg = 'P≈ôihl√°≈°en√≠ p≈ôes Facebook se nepoda≈ôilo.';
    
    if (error.code === 'auth/popup-closed-by-user') {
      errorMsg = 'P≈ôihl√°≈°en√≠ bylo zru≈°eno.';
    } else if (error.code === 'auth/popup-blocked') {
      errorMsg = 'Popup bylo blokov√°no. Povolte pros√≠m popup okna.';
    } else if (error.code === 'auth/cancelled-popup-request') {
      // Tich√° ignorace
      btnFacebook.innerHTML = originalText;
      btnFacebook.disabled = false;
      isProcessing = false;
      return;
    }
    
    showMessage(errorMsg, 'error');
    btnFacebook.innerHTML = originalText;
    btnFacebook.disabled = false;
  } finally {
    if (error?.code !== 'auth/cancelled-popup-request') {
      isProcessing = false;
    }
  }
});

// ============================================
// AUTH STATE LISTENER
// ============================================
auth.onAuthStateChanged((user) => {
  console.log('üîê Auth state:', user ? user.email : 'Odhl√°≈°en');
});

// ============================================
// REDIRECT RESULT (pokud se vrac√≠ z OAuth)
// ============================================
auth.getRedirectResult().then(async (result) => {
  if (result.user) {
    console.log('‚úÖ OAuth redirect √∫spƒõ≈°n√©');
    await saveUserProfile(result.user);
    await redirectUser(result.user);
  }
}).catch((error) => {
  if (error.code !== 'auth/popup-closed-by-user') {
    console.error('‚ùå Redirect error:', error);
    showMessage('Chyba p≈ôi p≈ôihl√°≈°en√≠: ' + error.message, 'error');
  }
});

// Inicializace Lucide ikon
lucide.createIcons();
</script>

</body>
</html>
