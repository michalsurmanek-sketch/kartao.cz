<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Debug Hamburger Menu - Auth Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-neutral-950 text-white min-h-screen">

  <header class="sticky top-0 z-40 backdrop-blur-lg bg-neutral-950/70 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="text-xl font-bold">Debug Menu</div>
        <button id="menuToggle" aria-controls="mobileMenu" aria-expanded="false" 
                class="inline-flex items-center justify-center w-11 h-11 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition">
          <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">ğŸ› Debug Hamburger Menu</h1>

    <div class="grid gap-4 mb-8">
      <div class="p-4 bg-white/5 rounded-lg border border-white/10">
        <h2 class="font-bold mb-2">1ï¸âƒ£ Supabase Status:</h2>
        <div id="supabaseStatus" class="text-sm text-white/70">Kontrola...</div>
      </div>

      <div class="p-4 bg-white/5 rounded-lg border border-white/10">
        <h2 class="font-bold mb-2">2ï¸âƒ£ Auth Status:</h2>
        <div id="authStatus" class="text-sm text-white/70">Kontrola...</div>
      </div>

      <div class="p-4 bg-white/5 rounded-lg border border-white/10">
        <h2 class="font-bold mb-2">3ï¸âƒ£ Profil Data:</h2>
        <pre id="profileData" class="text-xs text-white/70 overflow-auto">NaÄÃ­tÃ¡nÃ­...</pre>
      </div>

      <div class="p-4 bg-white/5 rounded-lg border border-white/10">
        <h2 class="font-bold mb-2">4ï¸âƒ£ Menu Type:</h2>
        <div id="menuType" class="text-sm text-white/70">NeznÃ¡mÃ½</div>
      </div>

      <div class="p-4 bg-white/5 rounded-lg border border-white/10">
        <h2 class="font-bold mb-2">5ï¸âƒ£ Events Log:</h2>
        <div id="eventsLog" class="text-xs text-white/70 space-y-1 max-h-64 overflow-auto">
          <div class="text-white/50">ÄŒekÃ¡nÃ­ na eventy...</div>
        </div>
      </div>
    </div>

    <div class="space-x-4">
      <button onclick="manualRefresh()" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-lg transition">
        ğŸ”„ ManuÃ¡lnÃ­ Refresh Menu
      </button>
      <button onclick="testCreatorMenu()" class="px-6 py-3 bg-fuchsia-600 hover:bg-fuchsia-500 rounded-lg transition">
        âœ¨ Test Creator Menu
      </button>
    </div>
  </main>

  <!-- Mobile Menu -->
  <div id="mobileMenu" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
    <div id="menuBackdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm opacity-0 transition-opacity duration-300 ease-out"></div>
    <div class="relative h-full flex flex-col items-stretch">
      <div id="menuPanel" class="mr-auto w-[92%] max-w-sm h-full bg-neutral-950/95 border-r border-white/10 shadow-2xl -translate-x-full transition-transform duration-300 ease-[cubic-bezier(0.4,0,0.2,1)]">
        <div class="px-4 py-4 flex items-center justify-between border-b border-white/10">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
              <i data-lucide="crown" class="w-5 h-5"></i>
            </div>
            <div>
              <div class="font-extrabold">Debug Menu</div>
            </div>
          </div>
          <button id="menuClose" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 hover:bg-red-500/20 flex items-center justify-center transition">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        <div id="menuContent"></div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="supabase-init.js"></script>
  <script src="auth-supabase.js"></script>
  <script src="hamburger-menu.js"></script>
  
  <script>
    function addLog(message, color = 'white') {
      const log = document.getElementById('eventsLog');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.style.color = color;
      entry.textContent = `[${time}] ${message}`;
      log.insertBefore(entry, log.firstChild);
    }

    // Monitor events
    window.addEventListener('supabase-auth-ready', (e) => {
      addLog('âœ… Event: supabase-auth-ready', '#10b981');
      console.log('supabase-auth-ready', e.detail);
    });

    window.addEventListener('user-profile-loaded', (e) => {
      addLog('âœ… Event: user-profile-loaded', '#10b981');
      console.log('user-profile-loaded', e.detail);
      if (e.detail?.profile) {
        document.getElementById('profileData').textContent = JSON.stringify(e.detail.profile, null, 2);
      }
    });

    window.addEventListener('supabase-auth-signout', () => {
      addLog('ğŸšª Event: supabase-auth-signout', '#ef4444');
    });

    async function checkStatus() {
      // Supabase
      if (typeof window.supabaseClient !== 'undefined' && window.supabaseClient) {
        document.getElementById('supabaseStatus').innerHTML = 'âœ… Supabase Client: <strong>OK</strong>';
      } else {
        document.getElementById('supabaseStatus').innerHTML = 'âŒ Supabase Client: <strong>CHYBÃ</strong>';
        return;
      }

      // Auth
      try {
        const { data: { user } } = await window.supabaseClient.auth.getUser();
        if (user) {
          document.getElementById('authStatus').innerHTML = `âœ… PÅ™ihlÃ¡Å¡en jako: <strong>${user.email}</strong>`;
          
          // Profile
          const { data: profile } = await window.supabaseClient.from('profiles').select('*').eq('id', user.id).single();
          if (profile) {
            document.getElementById('profileData').textContent = JSON.stringify(profile, null, 2);
            const type = profile.is_company ? 'COMPANY' : 'CREATOR';
            document.getElementById('menuType').innerHTML = `ğŸ“‹ Typ menu: <strong class="text-${profile.is_company ? 'blue' : 'fuchsia'}-400">${type}</strong>`;
          }
        } else {
          document.getElementById('authStatus').innerHTML = 'âš ï¸ Stav: <strong>NEPÅ˜IHLÃÅ EN</strong>';
          document.getElementById('menuType').innerHTML = 'ğŸ“‹ Typ menu: <strong class="text-gray-400">GUEST</strong>';
        }
      } catch (err) {
        document.getElementById('authStatus').innerHTML = `âŒ Chyba: ${err.message}`;
      }
    }

    function manualRefresh() {
      addLog('ğŸ”„ ManuÃ¡lnÃ­ refresh menu...', '#3b82f6');
      if (window.HamburgerMenu && window.HamburgerMenu.refresh) {
        window.HamburgerMenu.refresh();
      }
    }

    function testCreatorMenu() {
      addLog('ğŸ§ª Test Creator menu (mock data)', '#a855f7');
      window.HamburgerMenu.init('creator', {
        name: 'Test TvÅ¯rce',
        handle: 'testuser',
        avatar_url: 'https://i.pravatar.cc/150?img=12'
      });
      lucide.createIcons();
    }

    // Check every 2s
    setInterval(checkStatus, 2000);
    checkStatus();

    // Initialize Lucide
    lucide.createIcons();

    // Auth listener
    if (window.kartaoAuth) {
      window.kartaoAuth.onAuthStateChanged((user) => {
        addLog(user ? `ğŸ‘¤ Auth zmÄ›na: ${user.email}` : 'ğŸ‘¤ Auth zmÄ›na: OdhlÃ¡Å¡en', '#fbbf24');
      });
    }
  </script>
</body>
</html>
