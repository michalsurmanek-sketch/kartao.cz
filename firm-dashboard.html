<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao ‚Äì Dashboard firmy</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üíº</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { 
      background: radial-gradient(circle at top right, rgba(219, 88, 246, 0.15), transparent 50%),
                  radial-gradient(circle at bottom left, rgba(251, 191, 36, 0.12), transparent 60%),
                  #0a0a0a;
    }
    .card {
      background: rgba(23, 23, 23, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      backdrop-filter: blur(12px);
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 1.2rem;
      border-radius: 0.85rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #db58f6 0%, #fbbf24 100%);
      color: #fff;
      border: none;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(219, 88, 246, 0.3);
    }
    .btn-outline {
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      background: transparent;
    }
    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(219, 88, 246, 0.5);
    }
    .stat-card {
      background: linear-gradient(135deg, rgba(219, 88, 246, 0.08), rgba(251, 191, 36, 0.05));
      border: 1px solid rgba(219, 88, 246, 0.2);
      border-radius: 1rem;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
    }
    input, textarea, select {
      transition: all 0.2s;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #db58f6;
      box-shadow: 0 0 0 3px rgba(219, 88, 246, 0.1);
    }
    .campaign-card {
      transition: all 0.3s;
      cursor: pointer;
    }
    .campaign-card:hover {
      transform: translateY(-4px);
      border-color: rgba(219, 88, 246, 0.4);
    }
    .status-badge {
      display: inline-flex;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-draft { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }
    .badge-active { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .badge-pending { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .badge-completed { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
  </style>
</head>
<body class="min-h-screen text-white">
  
  <!-- HEADER -->
  <header class="sticky top-0 z-50 border-b border-white/10 bg-neutral-950/80 backdrop-blur-lg">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-3 group">
        <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center group-hover:scale-110 transition-transform">
          <i data-lucide="briefcase" class="w-5 h-5 text-white"></i>
        </div>
        <div>
          <div class="font-bold text-lg">Kartao</div>
          <div class="text-xs text-white/60">Dashboard firmy</div>
        </div>
      </a>
      
      <nav class="hidden md:flex items-center gap-4 text-sm">
        <a href="kartao-marketplace.html" class="text-white/70 hover:text-white transition flex items-center gap-2">
          <i data-lucide="search" class="w-4 h-4"></i>
          Naj√≠t tv≈Ørce
        </a>
        <a href="chat.html" class="text-white/70 hover:text-white transition flex items-center gap-2">
          <i data-lucide="message-circle" class="w-4 h-4"></i>
          Zpr√°vy
        </a>
        <a href="order-management.html" class="text-white/70 hover:text-white transition flex items-center gap-2">
          <i data-lucide="list" class="w-4 h-4"></i>
          Kampanƒõ
        </a>
      </nav>
      
      <div class="flex items-center gap-3">
        <button id="notificationBtn" class="relative p-2 rounded-xl hover:bg-white/5 transition">
          <i data-lucide="bell" class="w-5 h-5"></i>
          <span class="absolute top-1 right-1 w-2 h-2 bg-fuchsia-500 rounded-full"></span>
        </button>
        <a href="index.html" class="btn btn-outline text-sm">
          <i data-lucide="home" class="w-4 h-4"></i>
          <span class="hidden sm:inline">Zpƒõt na web</span>
        </a>
        <button id="logout" class="btn btn-primary text-sm">
          <i data-lucide="log-out" class="w-4 h-4"></i>
          <span class="hidden sm:inline">Odhl√°sit</span>
        </button>
      </div>
    </div>
  </header>

  <!-- BREADCRUMBS -->
  <nav class="border-b border-white/10 bg-neutral-900/30 backdrop-blur" aria-label="breadcrumb">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <ol class="flex items-center gap-2 text-sm">
        <li><a href="index.html" class="text-white/70 hover:text-white transition flex items-center gap-1">
          <i data-lucide="home" class="w-3 h-3"></i>
          Dom≈Ø
        </a></li>
        <i data-lucide="chevron-right" class="w-3 h-3 text-white/40"></i>
        <li><a href="kartao-muj-ucet.html" class="text-white/70 hover:text-white transition">M≈Øj √∫ƒçet</a></li>
        <i data-lucide="chevron-right" class="w-3 h-3 text-white/40"></i>
        <li class="text-fuchsia-400 font-semibold">Dashboard firmy</li>
      </ol>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    
    <!-- WELCOME BANNER -->
    <section class="mb-8 card p-6 relative overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-r from-fuchsia-500/10 via-transparent to-amber-400/10"></div>
      <div class="relative z-10">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h1 class="text-3xl font-bold mb-2">
              V√≠tejte, <span id="companyName" class="text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-amber-400">Firma</span>! üíº
            </h1>
            <p class="text-white/70">Spravujte kampanƒõ, najdƒõte tv≈Ørce a sledujte v√Ωsledky</p>
          </div>
          <a href="kartao-marketplace.html" class="btn btn-primary hidden lg:flex">
            <i data-lucide="user-plus" class="w-4 h-4"></i>
            Naj√≠t influencera
          </a>
        </div>
      </div>
    </section>

    <div class="grid lg:grid-cols-3 gap-6">
      
      <!-- LEV√ù SLOUPEC (2/3) -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- STATISTIKY P≈òEHLED -->
        <section class="card p-6">
          <h2 class="text-xl font-bold mb-5 flex items-center gap-2">
            <i data-lucide="trending-up" class="w-5 h-5 text-fuchsia-400"></i>
            P≈ôehled kampan√≠
          </h2>
          <div class="grid md:grid-cols-3 gap-4">
            <div class="stat-card">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-white/60">Celkov√© n√°klady</span>
                <i data-lucide="dollar-sign" class="w-4 h-4 text-red-400"></i>
              </div>
              <div class="text-3xl font-bold text-red-400" id="totalSpent">0 Kƒç</div>
              <div class="text-xs text-white/50 mt-1">Za posledn√≠ 3 mƒõs√≠ce</div>
            </div>
            
            <div class="stat-card">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-white/60">Aktivn√≠ kampanƒõ</span>
                <i data-lucide="zap" class="w-4 h-4 text-green-400"></i>
              </div>
              <div class="text-3xl font-bold text-green-400" id="activeCampaigns">0</div>
              <div class="text-xs text-white/50 mt-1">4 ve frontƒõ</div>
            </div>
            
            <div class="stat-card">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-white/60">Dosah celkem</span>
                <i data-lucide="users" class="w-4 h-4 text-blue-400"></i>
              </div>
              <div class="text-3xl font-bold text-blue-400" id="totalReach">0</div>
              <div class="text-xs text-white/50 mt-1">Followers zapojen√Ωch tv≈Ørc≈Ø</div>
            </div>
          </div>
        </section>

        <!-- NOV√Å KAMPA≈á -->
        <section class="card p-6">
          <h2 class="text-xl font-bold mb-5 flex items-center gap-2">
            <i data-lucide="plus-circle" class="w-5 h-5 text-fuchsia-400"></i>
            Vytvo≈ôit novou kampa≈à
          </h2>
          <form id="campaignForm" class="space-y-4">
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-white/70 mb-2">N√°zev kampanƒõ</label>
                <input 
                  name="campaignName" 
                  required 
                  placeholder="Nap≈ô. Letn√≠ kolekce 2025" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                />
              </div>
              <div>
                <label class="block text-sm text-white/70 mb-2">N√°zev firmy</label>
                <input 
                  name="company" 
                  required 
                  placeholder="Va≈°e firma" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                />
              </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-white/70 mb-2">Kontaktn√≠ osoba</label>
                <input 
                  name="contact" 
                  required 
                  placeholder="Jm√©no kontaktu" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                />
              </div>
              <div>
                <label class="block text-sm text-white/70 mb-2">E-mail</label>
                <input 
                  name="email" 
                  type="email" 
                  required 
                  placeholder="kontakt@firma.cz" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                />
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-white/70 mb-2">Rozpoƒçet (Kƒç)</label>
                <input 
                  name="budget" 
                  type="number" 
                  required 
                  placeholder="50000" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                />
              </div>
              <div>
                <label class="block text-sm text-white/70 mb-2">C√≠l kampanƒõ</label>
                <select 
                  name="goal" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                >
                  <option value="">Vyberte c√≠l...</option>
                  <option value="awareness">Povƒõdom√≠ o znaƒçce</option>
                  <option value="engagement">Engagement & interakce</option>
                  <option value="conversions">Konverze & prodeje</option>
                  <option value="traffic">N√°v≈°tƒõvnost webu</option>
                  <option value="ugc">User-generated content</option>
                  <option value="events">Podpora eventu</option>
                </select>
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-white/70 mb-2">Platforma</label>
                <select 
                  name="platform" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                >
                  <option value="">Vyber platformu...</option>
                  <option value="instagram">Instagram</option>
                  <option value="tiktok">TikTok</option>
                  <option value="youtube">YouTube</option>
                  <option value="facebook">Facebook</option>
                  <option value="multi">Multi-platforma</option>
                </select>
              </div>
              <div>
                <label class="block text-sm text-white/70 mb-2">Deadline</label>
                <input 
                  name="deadline" 
                  type="date" 
                  class="w-full rounded-xl bg-neutral-900 border border-white/10 px-4 py-3 text-white"
                />
              </div>
            </div>
            
            <div>
              <label class="block text-sm text-white/70 mb-2">Popis kampanƒõ & po≈æadavky</label>
              <textarea 
                name="description" 
                rows="5"
                required
                placeholder="Popi≈°te podrobnƒõ co oƒçek√°v√°te od spolupr√°ce, jak√Ω typ obsahu, t√≥n komunikace, hashtags..."
                class="w-full rounded-xl bg-neutral-900 border border-white/10 p-4 text-white resize-none"
              ></textarea>
            </div>

            <div>
              <label class="block text-sm text-white/70 mb-2">Po≈æadovan√© kategorie tv≈Ørc≈Ø</label>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="beauty" class="rounded">
                  <span class="text-sm">Beauty</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="fitness" class="rounded">
                  <span class="text-sm">Fitness</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="fashion" class="rounded">
                  <span class="text-sm">Fashion</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="food" class="rounded">
                  <span class="text-sm">Food</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="tech" class="rounded">
                  <span class="text-sm">Tech</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="gaming" class="rounded">
                  <span class="text-sm">Gaming</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="travel" class="rounded">
                  <span class="text-sm">Travel</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg bg-neutral-900/60 border border-white/10 cursor-pointer hover:border-fuchsia-400/30 transition">
                  <input type="checkbox" name="categories" value="lifestyle" class="rounded">
                  <span class="text-sm">Lifestyle</span>
                </label>
              </div>
            </div>
            
            <div class="flex items-center justify-between pt-2">
              <div class="text-xs text-white/50">
                <i data-lucide="info" class="w-3 h-3 inline"></i>
                Kampa≈à bude zve≈ôejnƒõna tv≈Ørc≈Øm
              </div>
              <button type="submit" class="btn btn-primary">
                <i data-lucide="rocket" class="w-4 h-4"></i>
                Vytvo≈ôit kampa≈à
              </button>
            </div>
          </form>
        </section>

      </div>

      <!-- PRAV√ù SLOUPEC (1/3) -->
      <div class="space-y-6">
        
        <!-- RYCHL√â AKCE -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="zap" class="w-4 h-4 text-amber-400"></i>
            Rychl√© akce
          </h3>
          <div class="space-y-2">
            <a href="kartao-marketplace.html" class="btn btn-outline w-full justify-center">
              <i data-lucide="search" class="w-4 h-4"></i>
              Naj√≠t tv≈Ørce
            </a>
            <a href="order-management.html" class="btn btn-outline w-full justify-center">
              <i data-lucide="list" class="w-4 h-4"></i>
              Spr√°va kampan√≠
            </a>
            <a href="chat.html" class="btn btn-outline w-full justify-center">
              <i data-lucide="message-square" class="w-4 h-4"></i>
              Zpr√°vy
            </a>
          </div>
        </section>

        <!-- ROZPOƒåET -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="credit-card" class="w-4 h-4 text-green-400"></i>
            Rozpoƒçet
          </h3>
          <div class="space-y-3">
            <div class="p-3 rounded-xl bg-red-500/10 border border-red-500/20">
              <div class="text-xs text-white/60 mb-1">Celkov√© v√Ωdaje</div>
              <div class="text-2xl font-bold text-red-400" id="totalSpentSidebar">0 Kƒç</div>
            </div>
            <div class="p-3 rounded-xl bg-blue-500/10 border border-blue-500/20">
              <div class="text-xs text-white/60 mb-1">V escrow</div>
              <div class="text-xl font-bold text-blue-400" id="escrowAmount">0 Kƒç</div>
            </div>
            <div class="p-3 rounded-xl bg-green-500/10 border border-green-500/20">
              <div class="text-xs text-white/60 mb-1">Dostupn√Ω kredit</div>
              <div class="text-xl font-bold text-green-400" id="availableCredit">0 Kƒç</div>
            </div>
          </div>
          <button id="addCreditBtn" class="btn btn-primary w-full mt-4">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Dob√≠t kredit
          </button>
        </section>

        <!-- AKTIVN√ç KAMPANƒö -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="target" class="w-4 h-4 text-fuchsia-400"></i>
            Aktivn√≠ kampanƒõ
          </h3>
          <div id="activeCampaignsWidget" class="space-y-3">
            <div class="text-center py-6 text-white/40 text-sm">
              <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
              Naƒç√≠t√°n√≠ kampan√≠...
            </div>
          </div>
          <a href="order-management.html" class="block text-center text-sm text-fuchsia-400 hover:text-fuchsia-300 mt-4">
            Zobrazit v≈°echny ‚Üí
          </a>
        </section>

        <!-- NOTIFIKACE -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="bell" class="w-4 h-4 text-amber-400"></i>
            Notifikace
          </h3>
          <div class="space-y-2 text-sm">
            <div class="p-2 rounded-lg bg-neutral-900/60 border border-white/10">
              <div class="flex items-start gap-2">
                <i data-lucide="user-check" class="w-4 h-4 text-green-400 mt-0.5"></i>
                <div class="flex-1">
                  <div class="text-white/90">Nov√Ω n√°vrh od tv≈Ørce</div>
                  <div class="text-xs text-white/50">P≈ôed 1 hodinou</div>
                </div>
              </div>
            </div>
            <div class="p-2 rounded-lg bg-neutral-900/60 border border-white/10">
              <div class="flex items-start gap-2">
                <i data-lucide="message-circle" class="w-4 h-4 text-blue-400 mt-0.5"></i>
                <div class="flex-1">
                  <div class="text-white/90">Nov√° zpr√°va od influencera</div>
                  <div class="text-xs text-white/50">Vƒçera</div>
                </div>
              </div>
            </div>
            <div class="p-2 rounded-lg bg-neutral-900/60 border border-white/10">
              <div class="flex items-start gap-2">
                <i data-lucide="check-circle" class="w-4 h-4 text-green-400 mt-0.5"></i>
                <div class="flex-1">
                  <div class="text-white/90">Kampa≈à dokonƒçena</div>
                  <div class="text-xs text-white/50">P≈ôed 2 dny</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- TOP TV≈ÆRCI -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="star" class="w-4 h-4 text-amber-400"></i>
            Nejlep≈°√≠ tv≈Ørci
          </h3>
          <div class="space-y-3">
            <div class="flex items-center gap-3 p-2 rounded-lg bg-neutral-900/60 border border-white/10 hover:border-fuchsia-400/30 transition cursor-pointer">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-purple-500 to-pink-500 grid place-items-center text-white font-bold">
                JN
              </div>
              <div class="flex-1">
                <div class="text-sm font-semibold">Jana Nov√°kov√°</div>
                <div class="text-xs text-white/50">Beauty ‚Ä¢ 125K followers</div>
              </div>
              <div class="text-amber-400">
                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
              </div>
            </div>
            <div class="flex items-center gap-3 p-2 rounded-lg bg-neutral-900/60 border border-white/10 hover:border-fuchsia-400/30 transition cursor-pointer">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-blue-500 to-cyan-500 grid place-items-center text-white font-bold">
                MK
              </div>
              <div class="flex-1">
                <div class="text-sm font-semibold">Martin Kov√°≈ô</div>
                <div class="text-xs text-white/50">Tech ‚Ä¢ 89K followers</div>
              </div>
              <div class="text-amber-400">
                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
              </div>
            </div>
          </div>
          <a href="kartao-marketplace.html" class="block text-center text-sm text-fuchsia-400 hover:text-fuchsia-300 mt-4">
            Prohl√©dnout v≈°echny ‚Üí
          </a>
        </section>

      </div>

    </div>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>

  <script>
    // Auth check a naƒçten√≠ dat
    window.addEventListener('load', function() {
      if (typeof firebase === 'undefined' || !firebase.auth) {
        console.error('‚ùå Firebase nen√≠ naƒçten√Ω!');
        return;
      }

      const auth = firebase.auth();
      const db = firebase.firestore();
      let currentUser = null;

      auth.onAuthStateChanged(async (user) => {
        if (!user) {
          console.log('‚ö†Ô∏è U≈æivatel nen√≠ p≈ôihl√°≈°en, redirect na login');
          window.location.href = 'login.html';
          return;
        }

        currentUser = user;
        console.log('‚úÖ P≈ôihl√°≈°en jako:', user.email);

        // Naƒçti profil
        loadCompanyProfile(user);
        
        // Naƒçti statistiky
        loadStats(user.uid);
        
        // Naƒçti kampanƒõ
        loadCampaigns(user.uid);
      });

      // Naƒçten√≠ profilu firmy
      async function loadCompanyProfile(user) {
        try {
          const doc = await db.collection('firms').doc(user.uid).get();
          if (doc.exists) {
            const data = doc.data();
            document.getElementById('companyName').textContent = data.company || 'Firma';
            
            // Pre-fill form s ulo≈æen√Ωmi daty
            if (data.company) {
              document.querySelector('[name="company"]').value = data.company;
            }
            if (data.contact) {
              document.querySelector('[name="contact"]').value = data.contact;
            }
            if (data.email) {
              document.querySelector('[name="email"]').value = data.email;
            }
          } else {
            // Nov√Ω u≈æivatel
            document.querySelector('[name="email"]').value = user.email;
            document.getElementById('companyName').textContent = user.displayName || 'Firma';
          }
        } catch (error) {
          console.error('Chyba naƒç√≠t√°n√≠ profilu:', error);
        }
      }

      // Vytvo≈ôen√≠ kampanƒõ
      document.getElementById('campaignForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser) return;

        const formData = new FormData(e.target);
        
        // Z√≠skej vybran√© kategorie
        const categories = Array.from(document.querySelectorAll('[name="categories"]:checked'))
          .map(cb => cb.value);

        const campaignData = {
          userId: currentUser.uid,
          campaignName: formData.get('campaignName'),
          company: formData.get('company'),
          contact: formData.get('contact'),
          email: formData.get('email'),
          budget: parseInt(formData.get('budget')),
          goal: formData.get('goal'),
          platform: formData.get('platform'),
          deadline: formData.get('deadline'),
          description: formData.get('description'),
          categories: categories,
          status: 'draft',
          createdAt: new Date().toISOString()
        };

        try {
          const docRef = await db.collection('campaigns').add(campaignData);
          
          // Ulo≈æ i profil firmy (pokud je≈°tƒõ nen√≠)
          await db.collection('firms').doc(currentUser.uid).set({
            company: campaignData.company,
            contact: campaignData.contact,
            email: campaignData.email,
            role: 'firma',
            updatedAt: new Date().toISOString()
          }, { merge: true });

          alert('‚úÖ Kampa≈à vytvo≈ôena! ID: ' + docRef.id);
          e.target.reset();
          
          // Reload kampan√≠
          await loadCampaigns(currentUser.uid);
        } catch (error) {
          console.error('Chyba vytv√°≈ôen√≠ kampanƒõ:', error);
          alert('‚ùå Chyba p≈ôi vytv√°≈ôen√≠ kampanƒõ');
        }
      });

      // Naƒç√≠st statistiky
      async function loadStats(userId) {
        try {
          // Simulace dat
          document.getElementById('totalSpent').textContent = '145 800 Kƒç';
          document.getElementById('totalSpentSidebar').textContent = '145 800 Kƒç';
          document.getElementById('activeCampaigns').textContent = '3';
          document.getElementById('totalReach').textContent = '425K';
          document.getElementById('escrowAmount').textContent = '28 500 Kƒç';
          document.getElementById('availableCredit').textContent = '50 000 Kƒç';
        } catch (error) {
          console.error('Chyba naƒç√≠t√°n√≠ stats:', error);
        }
      }

      // Naƒç√≠st kampanƒõ
      async function loadCampaigns(userId) {
        const container = document.getElementById('activeCampaignsWidget');
        
        try {
          const snapshot = await db.collection('campaigns')
            .where('userId', '==', userId)
            .orderBy('createdAt', 'desc')
            .limit(5)
            .get();

          if (snapshot.empty) {
            container.innerHTML = `
              <div class="text-center py-6 text-white/40 text-sm">
                <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                Zat√≠m ≈æ√°dn√© kampanƒõ
              </div>
            `;
            if (window.lucide) lucide.createIcons();
            return;
          }

          const campaigns = [];
          snapshot.forEach(doc => {
            campaigns.push({ id: doc.id, ...doc.data() });
          });

          container.innerHTML = campaigns.map(campaign => `
            <div class="campaign-card p-3 rounded-xl bg-neutral-900/60 border border-white/10">
              <div class="flex items-center justify-between mb-2">
                <div class="font-semibold text-sm">${campaign.campaignName || 'Bez n√°zvu'}</div>
                <span class="status-badge badge-${campaign.status || 'draft'}">
                  ${getStatusLabel(campaign.status)}
                </span>
              </div>
              <div class="text-xs text-white/60">Rozpoƒçet: <span class="text-white font-semibold">${formatNumber(campaign.budget)} Kƒç</span></div>
              <div class="text-xs text-white/50">
                ${campaign.platform ? campaign.platform.charAt(0).toUpperCase() + campaign.platform.slice(1) : 'Multi-platforma'}
                ${campaign.deadline ? ' ‚Ä¢ ' + campaign.deadline : ''}
              </div>
            </div>
          `).join('');

          if (window.lucide) lucide.createIcons();

        } catch (error) {
          console.error('Chyba naƒç√≠t√°n√≠ kampan√≠:', error);
          container.innerHTML = `
            <div class="text-center py-6 text-white/40 text-sm">
              <i data-lucide="alert-circle" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
              Chyba naƒç√≠t√°n√≠ kampan√≠
            </div>
          `;
          if (window.lucide) lucide.createIcons();
        }
      }

      // Helper funkce
      function getStatusLabel(status) {
        const labels = {
          draft: 'Koncept',
          active: 'Aktivn√≠',
          pending: 'ƒåek√°',
          completed: 'Hotovo'
        };
        return labels[status] || 'Nezn√°m√Ω';
      }

      function formatNumber(num) {
        if (!num) return '0';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
      }

      // Odhl√°≈°en√≠
      document.getElementById('logout').addEventListener('click', async () => {
        try {
          await auth.signOut();
          window.location.href = 'index.html';
        } catch (error) {
          console.error('Chyba odhl√°≈°en√≠:', error);
        }
      });

      // Notifikace
      document.getElementById('notificationBtn')?.addEventListener('click', () => {
        alert('üì¨ Funkce notifikac√≠ bude brzy p≈ôid√°na!');
      });

      // Dob√≠t kredit
      document.getElementById('addCreditBtn')?.addEventListener('click', () => {
        alert('üí≥ Funkce dobit√≠ kreditu bude brzy p≈ôid√°na!');
      });

    });

    // Inicializace ikon
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) {
        lucide.createIcons();
      }
    });
  </script>
</body>
</html>
