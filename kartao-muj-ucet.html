<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao.cz ‚Äì M≈Øj √∫ƒçet</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üë§</text></svg>">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
          },
        },
      },
    };
  </script>

  <!-- Firebase + spoleƒçn√° inicializace -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, #db58f6 0, transparent 55%),
                  radial-gradient(circle at bottom right, #fbbf24 0, #020617 55%);
    }
    .shadow-soft {
      box-shadow: 0 18px 45px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body class="text-white">
  <!-- HLAVIƒåKA -->
  <header class="border-b border-white/10 bg-neutral-950/80 backdrop-blur sticky top-0 z-10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center shadow-soft">
          <span class="font-bold text-lg">K</span>
        </div>
        <div>
          <div class="font-extrabold tracking-tight">Kartao.cz</div>
          <div class="text-xs text-white/60 -mt-0.5">S√≠≈• influencer≈Ø a tv≈Ørc≈Ø</div>
        </div>
      </a>

      <button id="btn-logout" class="px-3 py-1.5 rounded-xl text-sm border border-white/20 hover:bg-white/10">
        Odhl√°sit se
      </button>
    </div>
  </header>

  <!-- OBSAH -->
  <main class="max-w-3xl mx-auto px-4 py-10">
    <div class="rounded-2xl bg-neutral-900/90 border border-white/10 p-6 md:p-8 shadow-soft">
      <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight mb-2">
        M≈Øj √∫ƒçet
      </h1>
      <p class="text-sm text-white/60 mb-6">
        P≈ôehled z√°kladn√≠ch √∫daj≈Ø o va≈°em √∫ƒçtu na Kartao.cz.
      </p>

      <!-- Stav naƒç√≠t√°n√≠ / chyb -->
      <div id="account-message" class="hidden mb-5 text-sm rounded-lg px-3 py-2 border"></div>

      <!-- Karta s √∫daji -->
      <div id="account-card" class="space-y-4 hidden">
        <div>
          <div class="text-xs uppercase tracking-wide text-white/40 mb-1.5">E-mail</div>
          <div id="user-email" class="text-sm md:text-base font-semibold break-all">‚Äî</div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <div class="text-xs uppercase tracking-wide text-white/40 mb-1.5">Stav e-mailu</div>
            <div id="user-verified" class="inline-flex items-center gap-2 text-sm">
              ‚Äî
            </div>
          </div>
          <div>
            <div class="text-xs uppercase tracking-wide text-white/40 mb-1.5">P≈ôihl√°≈°en√≠ p≈ôes</div>
            <div id="user-provider" class="text-sm">‚Äî</div>
          </div>
        </div>

        <div>
          <div class="text-xs uppercase tracking-wide text-white/40 mb-1.5">Jm√©no (pokud je k dispozici)</div>
          <div id="user-name" class="text-sm md:text-base">‚Äî</div>
        </div>

        <div class="pt-4 border-t border-white/10 mt-4">
          <div class="text-xs uppercase tracking-wide text-white/40 mb-2">Rychl√© akce</div>
          <div class="flex flex-wrap gap-3">
            <a href="zalozit-kartu.html" class="px-4 py-2 rounded-xl bg-gradient-to-r from-fuchsia-500 to-amber-400 text-sm font-semibold text-neutral-900 hover:brightness-110 transition">
              Zalo≈æit kartu
            </a>
            <a href="kartao-marketplace.html" class="px-4 py-2 rounded-xl border border-white/15 text-sm text-white/80 hover:bg-white/10 transition">
              Vyhledat kampanƒõ
            </a>
            <a href="kartao-marketplace.html" class="px-4 py-2 rounded-xl border border-white/15 text-sm text-white/80 hover:bg-white/10 transition">
              Vyhledat kampanƒõ
            </a>
            <a href="kartao-marketplace.html" class="px-4 py-2 rounded-xl border border-white/15 text-sm text-white/80 hover:bg-white/10 transition">
              Vyhledat kampanƒõ
              <a href="kartao-marketplace.html" class="px-4 py-2 rounded-xl border border-white/15 text-sm text-white/80 hover:bg-white/10 transition">
              Vyhledat kampanƒõ
            </a>
            </a>
          </div>
        </div>
      </div>

      <!-- Fallback pro nep≈ôihl√°≈°en√© / redirect -->
      <div id="account-loading" class="text-sm text-white/60">
        Naƒç√≠t√°m √∫daje o √∫ƒçtu‚Ä¶
      </div>
    </div>
  </main>

  <script>
    const msgBox     = document.getElementById("account-message");
    const card       = document.getElementById("account-card");
    const loadingBox = document.getElementById("account-loading");
    const btnLogout  = document.getElementById("btn-logout");

    const elEmail    = document.getElementById("user-email");
    const elVerified = document.getElementById("user-verified");
    const elProvider = document.getElementById("user-provider");
    const elName     = document.getElementById("user-name");

    function showAccountMessage(text, type = "info") {
      if (!msgBox) return;
      msgBox.textContent = text;
      msgBox.classList.remove("hidden", "border-red-400", "bg-red-900/60", "border-amber-300", "bg-amber-900/30");
      if (type === "error") {
        msgBox.classList.add("border-red-400", "bg-red-900/60");
      } else {
        msgBox.classList.add("border-amber-300", "bg-amber-900/30");
      }
    }

    function hideAccountMessage() {
      if (!msgBox) return;
      msgBox.classList.add("hidden");
      msgBox.textContent = "";
    }

    // Pomocn√° funkce ‚Äì z providerId udƒõl√°me hezk√Ω text
    function humanProvider(providerId) {
      if (!providerId) return "E-mail a heslo";
      if (providerId === "password") return "E-mail a heslo";
      if (providerId === "google.com") return "Google";
      if (providerId === "facebook.com") return "Facebook";
      return providerId;
    }

    // Reakce na zmƒõnu p≈ôihl√°≈°en√©ho u≈æivatele
    auth.onAuthStateChanged(async (user) => {
      hideAccountMessage();

      if (!user) {
        // nen√≠ p≈ôihl√°≈°en ‚Üí p≈ôesmƒõruj na login str√°nky s n√°vratem sem
        if (loadingBox) loadingBox.textContent = "Nejste p≈ôihl√°≈°en√Ω, p≈ôesmƒõrov√°v√°m na p≈ôihl√°≈°en√≠‚Ä¶";
        window.location.href = "login.html?next=kartao-muj-ucet.html";
        return;
      }

      // P≈ôihl√°≈°en√Ω u≈æivatel ‚Äì zobrazit kartu
      if (loadingBox) loadingBox.classList.add("hidden");
      if (card) card.classList.remove("hidden");

      const providerData = user.providerData && user.providerData[0] ? user.providerData[0] : null;

      elEmail.textContent    = user.email || "‚Äî";
      elVerified.textContent = user.emailVerified ? "Ovƒõ≈ôen√Ω e-mail" : "Neovƒõ≈ôen√Ω e-mail";
      elProvider.textContent = humanProvider(providerData ? providerData.providerId : "password");
      elName.textContent     = user.displayName || "‚Äî";

      // Zkus√≠me dot√°hnout data z Firestore (kolekce users, dokument = uid)
      try {
        if (typeof db !== "undefined") {
          const docRef = db.collection("users").doc(user.uid);
          const snap   = await docRef.get();
          if (snap.exists) {
            const data = snap.data();
            if (data.displayName) {
              elName.textContent = data.displayName;
            }
          }
        }
      } catch (err) {
        console.error("Chyba p≈ôi naƒç√≠t√°n√≠ profilu z Firestore:", err);
      }

      if (!user.emailVerified) {
        showAccountMessage("V√°≈° e-mail je≈°tƒõ nen√≠ ovƒõ≈ôen√Ω. Zkontrolujte schr√°nku (i spam) ‚Äì bez ovƒõ≈ôen√≠ nemus√≠ nƒõkter√© funkce fungovat naplno.");
      }
    });

    // Odhl√°≈°en√≠
    if (btnLogout) {
      btnLogout.addEventListener("click", async () => {
        try {
          await auth.signOut();
          window.location.href = "index.html";
        } catch (err) {
          console.error(err);
          showAccountMessage("Odhl√°≈°en√≠ se nepoda≈ôilo: " + err.message, "error");
        }
      });
    }
  </script>
</body>
</html>
