<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao.cz ‚Äì M≈Øj √∫ƒçet</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üë§</text></svg>">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fuchsia: tailwind.colors.fuchsia,
            amber: tailwind.colors.amber,
            neutral: tailwind.colors.neutral,
            emerald: tailwind.colors.emerald,
            sky: tailwind.colors.sky,
            rose: tailwind.colors.rose,
          },
          boxShadow: {
            card: "0 24px 80px rgba(15,23,42,0.85)",
          },
        },
      },
    };
  </script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, rgba(236,72,153,0.15), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(251,191,36,0.18), transparent 55%),
                  radial-gradient(circle at bottom left, rgba(56,189,248,0.1), transparent 55%),
                  #020617;
    }

    .glass {
      background: radial-gradient(circle at top left, rgba(248,250,252,0.12), rgba(15,23,42,0.96));
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }
  </style>
</head>
<body class="text-slate-100">
  <div class="relative min-h-screen flex flex-col">
    <!-- Dekorativn√≠ kruhy v pozad√≠ -->
    <div class="pointer-events-none fixed inset-0 overflow-hidden">
      <div class="absolute -top-32 -right-24 h-72 w-72 rounded-full bg-fuchsia-500/10 blur-3xl"></div>
      <div class="absolute -bottom-32 -left-24 h-80 w-80 rounded-full bg-amber-400/10 blur-3xl"></div>
      <div class="absolute top-1/3 -left-32 h-64 w-64 rounded-full bg-sky-400/10 blur-3xl"></div>
    </div>

    <!-- Horn√≠ li≈°ta -->
    <header class="relative z-10 w-full">
      <div class="mx-auto max-w-6xl px-4 pt-6 flex items-center justify-between">
        <a id="backLink" href="#" class="inline-flex items-center gap-2 text-sm text-slate-300 hover:text-white transition">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-900/70 ring-1 ring-slate-700/60">
            ‚Üê
          </span>
          Zpƒõt na dashboard
        </a>

        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-900/80 ring-1 ring-slate-700/70 shadow-lg shadow-black/40">
          <div class="relative flex h-8 w-8 items-center justify-center rounded-2xl bg-gradient-to-br from-amber-400 via-fuchsia-500 to-sky-400 shadow-md shadow-amber-500/40">
            <span class="text-xl">K</span>
          </div>
          <div class="flex flex-col leading-none">
            <span class="text-xs font-semibold tracking-wide text-slate-200">Kartao.cz</span>
            <span class="text-[10px] uppercase tracking-[0.18em] text-slate-400">m≈Øj √∫ƒçet</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Obsah -->
    <main class="relative z-10 flex-1 flex items-center justify-center px-4 py-8">
      <div class="mx-auto flex w-full max-w-5xl flex-col gap-6 lg:flex-row lg:items-stretch">
        <!-- Info panel vlevo -->
        <section class="glass relative w-full max-w-sm rounded-3xl border border-slate-700/70 p-6 lg:p-7 shadow-card flex flex-col gap-4">
          <div class="flex items-center gap-4">
            <div class="relative h-14 w-14 rounded-2xl bg-gradient-to-br from-amber-400 via-fuchsia-500 to-sky-400 flex items-center justify-center text-2xl shadow-lg shadow-amber-500/40">
              <span id="avatarInitial">U</span>
            </div>
            <div class="flex flex-col">
              <span class="text-xs uppercase tracking-[0.20em] text-slate-400">M≈Øj √∫ƒçet</span>
              <span id="displayName" class="text-lg font-semibold text-slate-50">U≈æivatel Kartao</span>
              <span id="roleLabel" class="text-xs text-slate-400 mt-0.5">Naƒç√≠t√°m roli‚Ä¶</span>
            </div>
          </div>

          <div class="mt-2 space-y-2 text-sm text-slate-200/90">
            <div class="flex items-center gap-2">
              <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
              <span id="emailLabel">‚Äì</span>
            </div>
            <p class="text-xs text-slate-400">
              Tyto √∫daje jsou propojen√© s Firebase √∫ƒçtem. E‚Äëmail je pou≈æ√≠v√°n pro p≈ôihl√°≈°en√≠ a obnovu hesla.
            </p>
          </div>

          <div class="mt-auto flex flex-wrap items-center gap-2 pt-2">
            <span class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-2.5 py-1 text-[11px] text-slate-300 ring-1 ring-slate-700/80">
              <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
              <span>Bezpeƒçn√© ulo≈æen√≠ v Firebase</span>
            </span>
            <span id="roleBadge" class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-2.5 py-1 text-[11px] text-slate-300 ring-1 ring-slate-700/80">
              <span>üë§</span>
              <span>Naƒç√≠t√°m roli‚Ä¶</span>
            </span>
          </div>
        </section>

        <!-- Formul√°≈ô vpravo -->
        <section class="relative w-full lg:max-w-xl flex flex-col gap-4">
          <!-- Hl√°≈°ka -->
          <div id="messageBox" class="hidden rounded-2xl border border-emerald-500/50 bg-emerald-500/10 px-3 py-2 text-[11px] text-emerald-50"></div>

          <!-- Loader -->
          <div id="loader" class="hidden flex items-center gap-2 text-xs text-slate-300">
            <span class="h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span>
            Naƒç√≠t√°m √∫daje √∫ƒçtu‚Ä¶
          </div>

          <form id="accountForm" class="space-y-5 rounded-3xl border border-slate-700/70 bg-black/70 p-6 shadow-card">
            <div class="flex items-center justify-between gap-3 mb-1">
              <div class="flex flex-col">
                <span class="text-xs font-semibold uppercase tracking-[0.20em] text-slate-400">Z√°kladn√≠ √∫daje</span>
                <span class="text-sm text-slate-200">Uprav si zobrazovan√© jm√©no, p≈ôezd√≠vku a kontakty.</span>
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
              <div class="sm:col-span-2">
                <label for="email" class="mb-1 block text-xs font-medium text-slate-300">E‚Äëmail (p≈ôihla≈°ovac√≠)</label>
                <input id="email" type="email" disabled class="w-full rounded-2xl border border-slate-700 bg-slate-900/60 px-3 py-2 text-sm text-slate-400 outline-none ring-0" />
              </div>

              <div>
                <label for="name" class="mb-1 block text-xs font-medium text-slate-300">Jm√©no / n√°zev</label>
                <input id="name" type="text" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-amber-400 focus:ring-2 focus:ring-amber-400/40" placeholder="Tvoje jm√©no nebo n√°zev firmy" />
              </div>

              <div>
                <label for="nickname" class="mb-1 block text-xs font-medium text-slate-300">P≈ôezd√≠vka / znaƒçka</label>
                <input id="nickname" type="text" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-fuchsia-400 focus:ring-2 focus:ring-fuchsia-400/40" placeholder="Nap≈ô. @kartao_influencer" />
              </div>

              <div>
                <label for="phone" class="mb-1 block text-xs font-medium text-slate-300">Telefon (nepovinn√©)</label>
                <input id="phone" type="tel" class="w-full rounded-2xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none ring-0 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2 focus:ring-emerald-400/40" placeholder="+420 ..." />
              </div>
            </div>

            <div class="space-y-3 pt-2 border-t border-slate-800/70 mt-2">
              <div class="flex items-center justify-between">
                <div class="flex flex-col">
                  <span class="text-xs font-semibold uppercase tracking-[0.20em] text-slate-400">Zabezpeƒçen√≠</span>
                  <span class="text-xs text-slate-400">Heslo neum√≠me zobrazit, ale m≈Ø≈æe≈° si ho zmƒõnit.</span>
                </div>
                <button id="resetPasswordBtn" type="button" class="text-xs rounded-full border border-slate-700 bg-slate-900/80 px-3 py-1.5 text-slate-100 hover:border-amber-400 hover:text-amber-100">
                  Poslat odkaz na reset hesla
                </button>
              </div>
            </div>

            <div class="space-y-3 pt-2 border-t border-slate-800/70 mt-2">
              <div class="flex items-center justify-between">
                <div class="flex flex-col">
                  <span class="text-xs font-semibold uppercase tracking-[0.20em] text-slate-400">Role √∫ƒçtu</span>
                  <span id="roleDescription" class="text-xs text-slate-400">Naƒç√≠t√°m‚Ä¶</span>
                </div>
                <span id="roleChip" class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-3 py-1 text-[11px] text-slate-200 ring-1 ring-slate-700/80">
                  <span>üë§</span>
                  <span>Naƒç√≠t√°m‚Ä¶</span>
                </span>
              </div>
            </div>

            <div class="flex items-center justify-between pt-3">
              <button id="logoutBtn" type="button" class="text-xs text-rose-300 hover:text-rose-200">
                Odhl√°sit se z tohoto za≈ô√≠zen√≠
              </button>
              <button type="submit" class="inline-flex items-center gap-2 rounded-2xl bg-gradient-to-r from-emerald-400 via-sky-400 to-amber-300 px-5 py-2.5 text-sm font-semibold text-slate-950 shadow-lg shadow-emerald-500/40 hover:brightness-110">
                <span>Ulo≈æit zmƒõny</span>
              </button>
            </div>
          </form>
        </section>
      </div>
    </main>

    <!-- Spodn√≠ info -->
    <footer class="relative z-10 border-t border-slate-800/80 bg-black/40">
      <div class="mx-auto flex max-w-6xl flex-wrap items-center justify-between gap-3 px-4 py-4 text-[11px] text-slate-500">
        <span>¬© <span id="year"></span> Kartao.cz ‚Äì digit√°ln√≠ ekosyst√©m spoluprac√≠.</span>
        <div class="flex flex-wrap items-center gap-3">
          <span class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-2.5 py-1 ring-1 ring-slate-700/80">
            <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
            <span>√öƒçet propojen√Ω s Firebase</span>
          </span>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // Rok v patiƒçce
    document.getElementById("year").textContent = new Date().getFullYear();

    // Firebase config ‚Äì stejn√Ω jako v login.html
    const firebaseConfig = {
      apiKey: "AIzaSyC-jRAsCQ7dn3xT-JUxG1Jg675Sej7vp2o",
      authDomain: "kartao-97df7.firebaseapp.com",
      projectId: "kartao-97df7",
      storageBucket: "kartao-97df7.firebasestorage.app",
      messagingSenderId: "1041236043484",
      appId: "1:1041236043484:web:6b916ba41fb82aeb2bf619",
      measurementId: "G-77NDPH3TXM"
    };

    if (!firebase.apps || !firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM prvky
    const loader = document.getElementById("loader");
    const messageBox = document.getElementById("messageBox");
    const accountForm = document.getElementById("accountForm");
    const backLink = document.getElementById("backLink");

    const emailInput = document.getElementById("email");
    const nameInput = document.getElementById("name");
    const nicknameInput = document.getElementById("nickname");
    const phoneInput = document.getElementById("phone");

    const displayNameEl = document.getElementById("displayName");
    const avatarInitialEl = document.getElementById("avatarInitial");
    const emailLabelEl = document.getElementById("emailLabel");
    const roleLabelEl = document.getElementById("roleLabel");
    const roleBadgeEl = document.getElementById("roleBadge");
    const roleDescriptionEl = document.getElementById("roleDescription");
    const roleChipEl = document.getElementById("roleChip");

    const resetPasswordBtn = document.getElementById("resetPasswordBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    function setLoading(isLoading) {
      loader.classList.toggle("hidden", !isLoading);
      accountForm.classList.toggle("opacity-50", isLoading);
    }

    function showMessage(text, type = "success") {
      messageBox.textContent = text;
      messageBox.classList.remove("hidden");
      if (type === "success") {
        messageBox.classList.remove("border-rose-500/50", "bg-rose-500/10");
        messageBox.classList.add("border-emerald-500/50", "bg-emerald-500/10");
      } else {
        messageBox.classList.remove("border-emerald-500/50", "bg-emerald-500/10");
        messageBox.classList.add("border-rose-500/50", "bg-rose-500/10");
      }
    }

    function hideMessage() {
      messageBox.classList.add("hidden");
    }

    function applyRoleUI(role) {
      let label = "Influencer √∫ƒçet";
      let desc = "Tento √∫ƒçet je veden√Ω jako influencer / tv≈Ørce obsahu.";
      let chipIcon = "‚≠ê";
      let backHref = "moje-karta.html";

      if (role === "firma") {
        label = "Firemn√≠ √∫ƒçet";
        desc = "Tento √∫ƒçet je veden√Ω jako firma / znaƒçka / agentura.";
        chipIcon = "üè¢";
        backHref = "moje-firma.html";
      }

      roleLabelEl.textContent = label;
      roleDescriptionEl.textContent = desc;
      roleBadgeEl.innerHTML = `<span>${chipIcon}</span><span>${label}</span>`;
      roleChipEl.innerHTML = `<span>${chipIcon}</span><span>${label}</span>`;
      backLink.href = backHref;
    }

    function applyUserUI(user, data) {
      const email = user.email || data.email || "";
      const name = data.name || user.displayName || "U≈æivatel Kartao";
      const nickname = data.nickname || "";
      const phone = data.phone || "";
      const role = data.role || "influencer";

      emailInput.value = email;
      emailLabelEl.textContent = email || "Bez e‚Äëmailu";
      nameInput.value = name;
      nicknameInput.value = nickname;
      phoneInput.value = phone;

      displayNameEl.textContent = name;
      avatarInitialEl.textContent = name.trim().charAt(0).toUpperCase() || "U";

      applyRoleUI(role);
    }

    // Naƒçten√≠ u≈æivatele
    setLoading(true);
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      try {
        const primaryRef = db.collection("users").doc(user.uid);
        const fallbackRef = db.collection("user").doc(user.uid);

        let doc = await primaryRef.get();
        if (!doc.exists) {
          // fallback na starou kolekci "user"
          doc = await fallbackRef.get();
        }

        const data = doc.exists ? doc.data() : {};
        applyUserUI(user, data || {});
      } catch (err) {
        console.error("Chyba p≈ôi naƒç√≠t√°n√≠ √∫ƒçtu:", err);
        showMessage("Nepoda≈ôilo se naƒç√≠st √∫daje √∫ƒçtu.", "error");
      } finally {
        setLoading(false);
      }
    });

    // Ulo≈æen√≠ zmƒõn
    accountForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      hideMessage();
      setLoading(true);

      const user = auth.currentUser;
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const payload = {
        email: user.email || emailInput.value.trim(),
        name: nameInput.value.trim() || null,
        nickname: nicknameInput.value.trim() || null,
        phone: phoneInput.value.trim() || null,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
      };

      try {
        const primaryRef = db.collection("users").doc(user.uid);
        const fallbackRef = db.collection("user").doc(user.uid);

        // zapisujeme do obou kolekc√≠, aby byl profil sjednocen√Ω
        await primaryRef.set(payload, { merge: true });
        await fallbackRef.set(payload, { merge: true });
        showMessage("√ödaje byly √∫spƒõ≈°nƒõ ulo≈æeny.");
      } catch (err) {
        console.error("Chyba p≈ôi ukl√°d√°n√≠ √∫ƒçtu:", err);
        showMessage("Nepoda≈ôilo se ulo≈æit zmƒõny.", "error");
      } finally {
        setLoading(false);
      }
    });

    // Reset hesla
    resetPasswordBtn.addEventListener("click", async () => {
      hideMessage();
      const user = auth.currentUser;
      if (!user || !user.email) {
        showMessage("Nepoda≈ôilo se zjistit e‚Äëmail √∫ƒçtu.", "error");
        return;
      }

      try {
        await auth.sendPasswordResetEmail(user.email);
        showMessage("Odeslali jsme ti e‚Äëmail s odkazem na zmƒõnu hesla.");
      } catch (err) {
        console.error("Chyba p≈ôi resetu hesla:", err);
        showMessage("Nepoda≈ôilo se odeslat e‚Äëmail pro zmƒõnu hesla.", "error");
      }
    });

    // Odhl√°≈°en√≠
    logoutBtn.addEventListener("click", async () => {
      try {
        await auth.signOut();
        window.location.href = "login.html";
      } catch (err) {
        console.error("Chyba p≈ôi odhl√°≈°en√≠:", err);
        showMessage("Nepoda≈ôilo se odhl√°sit.", "error");
      }
    });
  </script>
</body>
</html>
