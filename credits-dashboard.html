<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kartao ‚Äì Kreditn√≠ syst√©m</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üí∞</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { 
      background: radial-gradient(circle at top right, rgba(219, 88, 246, 0.15), transparent 50%),
                  radial-gradient(circle at bottom left, rgba(251, 191, 36, 0.12), transparent 60%),
                  #0a0a0a;
    }
    .card {
      background: rgba(23, 23, 23, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      backdrop-filter: blur(12px);
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 1.2rem;
      border-radius: 0.85rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #db58f6 0%, #fbbf24 100%);
      color: #fff;
      border: none;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(219, 88, 246, 0.3);
    }
    .btn-outline {
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      background: transparent;
    }
    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(219, 88, 246, 0.5);
    }
    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
    }
    .progress-bar {
      background: rgba(219, 88, 246, 0.2);
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-fill {
      background: linear-gradient(135deg, #db58f6 0%, #fbbf24 100%);
      height: 100%;
      transition: width 0.3s ease;
    }
    .achievement-card {
      border: 2px solid transparent;
      background: linear-gradient(#171717, #171717) padding-box,
                  linear-gradient(135deg, #db58f6, #fbbf24) border-box;
    }
    .task-card {
      transition: all 0.3s;
    }
    .task-card:hover {
      transform: translateY(-2px);
      border-color: rgba(219, 88, 246, 0.4);
    }
    .task-completed {
      opacity: 0.6;
      background: rgba(34, 197, 94, 0.1);
      border-color: rgba(34, 197, 94, 0.3);
    }
    .level-badge {
      background: linear-gradient(135deg, #db58f6 0%, #fbbf24 100%);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-weight: bold;
      font-size: 0.75rem;
    }
    .credits-counter {
      font-size: 2rem;
      font-weight: bold;
      background: linear-gradient(135deg, #db58f6 0%, #fbbf24 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .floating-ad {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      max-width: 300px;
      display: none;
    }
  </style>
</head>
<body class="min-h-screen text-white">
  
  <!-- HEADER -->
  <header class="sticky top-0 z-50 border-b border-white/10 bg-neutral-950/80 backdrop-blur-lg">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="creator-dashboard.html" class="flex items-center gap-3 group">
        <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center group-hover:scale-110 transition-transform">
          <i data-lucide="coins" class="w-5 h-5 text-white"></i>
        </div>
        <div>
          <div class="font-bold text-lg">Kreditn√≠ syst√©m</div>
          <div class="text-xs text-white/60">Pl≈à √∫koly a z√≠sk√°vej kredity</div>
        </div>
      </a>
      
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-fuchsia-500/20 to-amber-400/20 border border-fuchsia-400/30">
          <i data-lucide="coins" class="w-5 h-5 text-amber-400"></i>
          <span class="credits-counter" id="userCredits">0</span>
          <span class="text-white/70 text-sm">kredit≈Ø</span>
        </div>
        <div class="level-badge" id="userLevel">Level 1</div>
        <a href="creator-dashboard.html" class="btn btn-outline text-sm">
          <i data-lucide="arrow-left" class="w-4 h-4"></i>
          Zpƒõt
        </a>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    
    <div class="grid lg:grid-cols-3 gap-6">
      
      <!-- LEV√ù SLOUPEC (2/3) -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- DENN√ç √öKOLY -->
        <section class="card p-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold flex items-center gap-2">
              <i data-lucide="check-circle" class="w-5 h-5 text-fuchsia-400"></i>
              Denn√≠ √∫koly
            </h2>
            <div class="text-sm text-white/60">
              Obnov√≠ se za <span id="resetCountdown" class="text-fuchsia-400 font-bold">12:34:56</span>
            </div>
          </div>
          
          <div id="dailyTasks" class="space-y-4">
            <!-- Denn√≠ √∫koly se naƒçtou zde -->
          </div>
        </section>

        <!-- SLEDOVAT REKLAMU -->
        <section class="card p-6">
          <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
            <i data-lucide="play-circle" class="w-5 h-5 text-green-400"></i>
            Sleduj reklamy a z√≠skej kredity
          </h2>
          <p class="text-white/70 mb-4">Sleduj kr√°tk√© reklamy a z√≠skej 5 kredit≈Ø za ka≈ædou. M≈Ø≈æe≈° sledovat a≈æ 5 reklam dennƒõ.</p>
          
          <div class="flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-green-500/10 to-blue-500/10 border border-green-500/20">
            <div>
              <div class="font-semibold">Sledovan√Ωch reklam dnes</div>
              <div class="text-sm text-white/60">
                <span id="adsWatchedToday" class="text-green-400 font-bold">0</span> / 5
              </div>
            </div>
            <button id="watchAdBtn" class="btn btn-success">
              <i data-lucide="play" class="w-4 h-4"></i>
              Sledovat reklamu (5 kredit≈Ø)
            </button>
          </div>
        </section>

        <!-- V√ùMƒöNA KREDIT≈Æ -->
        <section class="card p-6">
          <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
            <i data-lucide="gift" class="w-5 h-5 text-amber-400"></i>
            V√Ωmƒõna kredit≈Ø za odmƒõny
          </h2>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div class="p-4 rounded-xl border border-white/10 hover:border-fuchsia-400/40 transition cursor-pointer" onclick="redeemReward('BOOST_PROFILE', 100)">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-purple-500 to-pink-500 grid place-items-center">
                  <i data-lucide="trending-up" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">Zv√Ωrazn√Ω profil</div>
                  <div class="text-xs text-white/60">24 hodin</div>
                </div>
              </div>
              <div class="text-sm text-white/80 mb-3">Tv≈Øj profil se zobraz√≠ na prvn√≠ch m√≠stech v marketplace po dobu 24 hodin.</div>
              <div class="flex items-center justify-between">
                <span class="text-amber-400 font-bold">100 kredit≈Ø</span>
                <button class="btn btn-primary text-sm">Vymƒõnit</button>
              </div>
            </div>

            <div class="p-4 rounded-xl border border-white/10 hover:border-fuchsia-400/40 transition cursor-pointer" onclick="redeemReward('ANALYTICS_PRO', 150)">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-blue-500 to-cyan-500 grid place-items-center">
                  <i data-lucide="bar-chart-3" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">Pokroƒçil√© anal√Ωzy</div>
                  <div class="text-xs text-white/60">1 mƒõs√≠c</div>
                </div>
              </div>
              <div class="text-sm text-white/80 mb-3">Detailn√≠ statistiky v√Ωkonu, analytics a doporuƒçen√≠ pro zlep≈°en√≠.</div>
              <div class="flex items-center justify-between">
                <span class="text-amber-400 font-bold">150 kredit≈Ø</span>
                <button class="btn btn-primary text-sm">Vymƒõnit</button>
              </div>
            </div>

            <div class="p-4 rounded-xl border border-white/10 hover:border-fuchsia-400/40 transition cursor-pointer" onclick="redeemReward('PRIORITY_SUPPORT', 200)">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-emerald-500 to-teal-500 grid place-items-center">
                  <i data-lucide="headphones" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">Prioritn√≠ podpora</div>
                  <div class="text-xs text-white/60">Trvale</div>
                </div>
              </div>
              <div class="text-sm text-white/80 mb-3">Rychlej≈°√≠ odpovƒõdi na dotazy a prioritn√≠ ≈ôe≈°en√≠ probl√©m≈Ø.</div>
              <div class="flex items-center justify-between">
                <span class="text-amber-400 font-bold">200 kredit≈Ø</span>
                <button class="btn btn-primary text-sm">Vymƒõnit</button>
              </div>
            </div>

            <div class="p-4 rounded-xl border border-white/10 hover:border-fuchsia-400/40 transition cursor-pointer" onclick="redeemReward('BADGE_PREMIUM', 300)">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-yellow-500 to-orange-500 grid place-items-center">
                  <i data-lucide="crown" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">Pr√©miov√Ω odznak</div>
                  <div class="text-xs text-white/60">Trvale</div>
                </div>
              </div>
              <div class="text-sm text-white/80 mb-3">Speci√°ln√≠ odznak u tv√©ho jm√©na, kter√Ω tƒõ odli≈°√≠ od ostatn√≠ch.</div>
              <div class="flex items-center justify-between">
                <span class="text-amber-400 font-bold">300 kredit≈Ø</span>
                <button class="btn btn-primary text-sm">Vymƒõnit</button>
              </div>
            </div>
          </div>
        </section>

      </div>

      <!-- PRAV√ù SLOUPEC (1/3) -->
      <div class="space-y-6">
        
        <!-- STATISTIKY -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="bar-chart" class="w-4 h-4 text-fuchsia-400"></i>
            Moje statistiky
          </h3>
          
          <div class="space-y-4">
            <div class="p-3 rounded-xl bg-gradient-to-r from-fuchsia-500/10 to-amber-400/10 border border-fuchsia-400/20">
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm text-white/70">Level</span>
                <span id="levelDisplay" class="text-fuchsia-400 font-bold">1</span>
              </div>
              <div class="progress-bar h-2 mb-1">
                <div id="levelProgress" class="progress-fill" style="width: 0%"></div>
              </div>
              <div class="text-xs text-white/50">
                <span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP
              </div>
            </div>

            <div class="p-3 rounded-xl bg-green-500/10 border border-green-500/20">
              <div class="text-xs text-white/60 mb-1">Celkem z√≠sk√°no</div>
              <div class="text-xl font-bold text-green-400" id="totalCreditsEarned">0 kredit≈Ø</div>
            </div>

            <div class="p-3 rounded-xl bg-blue-500/10 border border-blue-500/20">
              <div class="text-xs text-white/60 mb-1">Celkem utraceno</div>
              <div class="text-xl font-bold text-blue-400" id="totalCreditsSpent">0 kredit≈Ø</div>
            </div>

            <div class="p-3 rounded-xl bg-orange-500/10 border border-orange-500/20">
              <div class="text-xs text-white/60 mb-1">Denn√≠ s√©rie</div>
              <div class="text-xl font-bold text-orange-400" id="streakCounter">0 dn√≠</div>
            </div>
          </div>
        </section>

        <!-- ACHIEVEMENTY -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="trophy" class="w-4 h-4 text-amber-400"></i>
            Achievementy
          </h3>
          
          <div id="achievements" class="space-y-3">
            <!-- Achievementy se naƒçtou zde -->
          </div>
          
          <button id="viewAllAchievements" class="btn btn-outline w-full mt-4 text-sm">
            <i data-lucide="eye" class="w-4 h-4"></i>
            Zobrazit v≈°echny
          </button>
        </section>

        <!-- AKTIVN√ç ODMƒöNY -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="star" class="w-4 h-4 text-green-400"></i>
            Aktivn√≠ odmƒõny
          </h3>
          
          <div id="activeRewards" class="space-y-3">
            <div class="text-center py-4 text-white/60 text-sm">
              <i data-lucide="gift-icon" class="w-6 h-6 mx-auto mb-2 opacity-50"></i>
              ≈Ω√°dn√© aktivn√≠ odmƒõny
            </div>
          </div>
        </section>

        <!-- HISTORIE TRANSAKC√ç -->
        <section class="card p-5">
          <h3 class="font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="history" class="w-4 h-4 text-blue-400"></i>
            Posledn√≠ aktivity
          </h3>
          
          <div id="recentTransactions" class="space-y-2 max-h-60 overflow-y-auto">
            <!-- Transakce se naƒçtou zde -->
          </div>
          
          <button id="viewAllTransactions" class="btn btn-outline w-full mt-4 text-sm">
            <i data-lucide="list" class="w-4 h-4"></i>
            Zobrazit historii
          </button>
        </section>

      </div>

    </div>
  </main>

  <!-- FLOATING AD -->
  <div id="floatingAd" class="floating-ad">
    <div class="card p-4">
      <div class="flex items-center justify-between mb-2">
        <div class="text-sm font-semibold">üé¨ Nov√° reklama!</div>
        <button onclick="closeFloatingAd()" class="text-white/60 hover:text-white">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
      </div>
      <div class="text-xs text-white/70 mb-3">Z√≠skej 5 kredit≈Ø za 30 sekund sledov√°n√≠</div>
      <button onclick="watchFloatingAd()" class="btn btn-success w-full text-sm">
        <i data-lucide="play" class="w-4 h-4"></i>
        Sledovat reklamu
      </button>
    </div>
  </div>

  <!-- AD MODAL -->
  <div id="adModal" class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center">
    <div class="card p-6 max-w-md mx-4">
      <div class="text-center">
        <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-tr from-green-500 to-blue-500 rounded-full grid place-items-center">
          <i data-lucide="play" class="w-10 h-10 text-white"></i>
        </div>
        <h3 class="text-xl font-bold mb-2">Sledov√°n√≠ reklamy</h3>
        <p class="text-white/70 mb-4">Sleduj reklamu do konce a z√≠skej 5 kredit≈Ø</p>
        
        <div id="adVideo" class="w-full h-40 bg-neutral-800 rounded-lg mb-4 flex items-center justify-center">
          <div class="text-white/60">üì∫ Simulace reklamy</div>
        </div>
        
        <div class="flex items-center justify-between mb-4">
          <span class="text-sm text-white/60">Zb√Ωv√°</span>
          <span id="adTimer" class="text-lg font-bold text-fuchsia-400">30s</span>
        </div>
        
        <div class="progress-bar h-2 mb-4">
          <div id="adProgress" class="progress-fill" style="width: 0%"></div>
        </div>
        
        <button id="skipAdBtn" class="btn btn-outline w-full" disabled>
          <i data-lucide="skip-forward" class="w-4 h-4"></i>
          P≈ôeskoƒçit reklamu (5s)
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>
  <script src="credits-system.js"></script>

  <script>
    let creditsSystem;
    let currentUser;
    let adTimer;
    let adsWatchedToday = 0;

    document.addEventListener('DOMContentLoaded', async () => {
      // Inicializace ikon
      if (window.lucide) lucide.createIcons();

      // Inicializace kreditn√≠ho syst√©mu
      creditsSystem = new CreditsSystem();

      // Auth listener
      firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
          window.location.href = 'login.html';
          return;
        }

        currentUser = user;
        console.log('‚úÖ P≈ôihl√°≈°en jako:', user.email);

        await loadUserData();
        await loadDailyTasks();
        await loadAchievements();
        await loadActiveRewards();
        await loadRecentTransactions();
        startCountdown();
        showRandomFloatingAd();
      });
    });

    // Naƒçten√≠ u≈æivatelsk√Ωch dat
    async function loadUserData() {
      try {
        const credits = await creditsSystem.getUserCredits(currentUser.uid);
        if (credits) {
          document.getElementById('userCredits').textContent = credits.availableCredits || 0;
          document.getElementById('userLevel').textContent = `Level ${credits.level || 1}`;
          document.getElementById('levelDisplay').textContent = credits.level || 1;
          document.getElementById('totalCreditsEarned').textContent = `${credits.totalCredits || 0} kredit≈Ø`;
          document.getElementById('totalCreditsSpent').textContent = `${credits.usedCredits || 0} kredit≈Ø`;
          document.getElementById('streakCounter').textContent = `${credits.streak || 0} dn√≠`;

          // Progress bar pro level
          const currentXP = credits.experience || 0;
          const currentLevel = credits.level || 1;
          const currentLevelXP = Math.pow(currentLevel - 1, 2) * 100;
          const nextLevelXP = Math.pow(currentLevel, 2) * 100;
          const progressPercent = ((currentXP - currentLevelXP) / (nextLevelXP - currentLevelXP)) * 100;

          document.getElementById('currentXP').textContent = currentXP - currentLevelXP;
          document.getElementById('nextLevelXP').textContent = nextLevelXP - currentLevelXP;
          document.getElementById('levelProgress').style.width = Math.max(0, Math.min(100, progressPercent)) + '%';
        }
      } catch (error) {
        console.error('Chyba naƒç√≠t√°n√≠ u≈æivatelsk√Ωch dat:', error);
      }
    }

    // Naƒçten√≠ denn√≠ch √∫kol≈Ø
    async function loadDailyTasks() {
      try {
        const tasks = await creditsSystem.getDailyTasks(currentUser.uid);
        const container = document.getElementById('dailyTasks');
        
        if (tasks.length === 0) {
          container.innerHTML = '<div class="text-center py-4 text-white/60">≈Ω√°dn√© √∫koly pro dnes</div>';
          return;
        }

        container.innerHTML = tasks.map(task => `
          <div class="task-card p-4 rounded-xl border border-white/10 ${task.completed ? 'task-completed' : ''}" data-task-id="${task.id}">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-fuchsia-500 to-amber-400 grid place-items-center">
                  ${getTaskIcon(task.type)}
                </div>
                <div>
                  <div class="font-semibold">${task.name}</div>
                  <div class="text-xs text-white/60">${task.credits} kredit≈Ø</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                ${task.completed ? 
                  '<span class="text-green-400"><i data-lucide="check-circle" class="w-5 h-5"></i></span>' :
                  `<span class="text-white/60">${task.progress}/${task.target}</span>`
                }
              </div>
            </div>
            <div class="progress-bar h-1.5">
              <div class="progress-fill" style="width: ${(task.progress / task.target) * 100}%"></div>
            </div>
          </div>
        `).join('');

        if (window.lucide) lucide.createIcons();
      } catch (error) {
        console.error('Chyba naƒç√≠t√°n√≠ denn√≠ch √∫kol≈Ø:', error);
      }
    }

    // Ikony pro √∫koly
    function getTaskIcon(taskType) {
      const icons = {
        DAILY_LOGIN: '<i data-lucide="log-in" class="w-5 h-5 text-white"></i>',
        WATCH_AD: '<i data-lucide="play-circle" class="w-5 h-5 text-white"></i>',
        SOCIAL_SHARE: '<i data-lucide="share-2" class="w-5 h-5 text-white"></i>',
        PROFILE_UPDATE: '<i data-lucide="user" class="w-5 h-5 text-white"></i>',
        WATCH_TUTORIAL: '<i data-lucide="video" class="w-5 h-5 text-white"></i>'
      };
      return icons[taskType] || '<i data-lucide="target" class="w-5 h-5 text-white"></i>';
    }

    // Sledov√°n√≠ reklamy
    document.getElementById('watchAdBtn').addEventListener('click', async () => {
      if (adsWatchedToday >= 5) {
        alert('Dnes u≈æ jsi sledoval maxim√°ln√≠ poƒçet reklam (5)');
        return;
      }

      showAdModal();
    });

    function showAdModal() {
      const modal = document.getElementById('adModal');
      const timer = document.getElementById('adTimer');
      const progress = document.getElementById('adProgress');
      const skipBtn = document.getElementById('skipAdBtn');
      
      modal.classList.remove('hidden');
      
      let timeLeft = 30;
      timer.textContent = timeLeft + 's';
      skipBtn.disabled = true;
      skipBtn.innerHTML = '<i data-lucide="skip-forward" class="w-4 h-4"></i> P≈ôeskoƒçit reklamu (5s)';

      adTimer = setInterval(async () => {
        timeLeft--;
        timer.textContent = timeLeft + 's';
        progress.style.width = ((30 - timeLeft) / 30 * 100) + '%';

        if (timeLeft === 25) {
          skipBtn.disabled = false;
          skipBtn.innerHTML = '<i data-lucide="skip-forward" class="w-4 h-4"></i> P≈ôeskoƒçit reklamu';
        }

        if (timeLeft <= 0) {
          clearInterval(adTimer);
          await completeAdWatch();
        }
      }, 1000);

      skipBtn.onclick = async () => {
        if (timeLeft <= 25) {
          clearInterval(adTimer);
          await completeAdWatch();
        }
      };
    }

    async function completeAdWatch() {
      try {
        const adId = 'ad_' + Date.now();
        const result = await creditsSystem.watchAd(currentUser.uid, adId);
        
        adsWatchedToday++;
        document.getElementById('adsWatchedToday').textContent = adsWatchedToday;
        
        // Ukryj modal
        document.getElementById('adModal').classList.add('hidden');
        
        // Aktualizuj UI
        await loadUserData();
        await loadDailyTasks();
        
        // Zobraz ozn√°men√≠
        showNotification('‚úÖ Z√≠skal jsi 5 kredit≈Ø za sledov√°n√≠ reklamy!', 'success');
        
        if (adsWatchedToday >= 5) {
          document.getElementById('watchAdBtn').disabled = true;
          document.getElementById('watchAdBtn').textContent = 'Limit dosa≈æen (5/5)';
        }

      } catch (error) {
        console.error('Chyba p≈ôi sledov√°n√≠ reklamy:', error);
        showNotification('‚ùå Chyba p≈ôi sledov√°n√≠ reklamy', 'error');
      }
    }

    // V√Ωmƒõna kredit≈Ø za odmƒõnu
    async function redeemReward(rewardType, cost) {
      try {
        const credits = await creditsSystem.getUserCredits(currentUser.uid);
        if (!credits || credits.availableCredits < cost) {
          showNotification('‚ùå Nedostatek kredit≈Ø', 'error');
          return;
        }

        if (confirm(`Opravdu chce≈° vymƒõnit ${cost} kredit≈Ø za tuto odmƒõnu?`)) {
          await creditsSystem.redeemCredits(currentUser.uid, rewardType, cost);
          await loadUserData();
          await loadActiveRewards();
          showNotification('‚úÖ Odmƒõna √∫spƒõ≈°nƒõ vymƒõnƒõna!', 'success');
        }
      } catch (error) {
        console.error('Chyba p≈ôi v√Ωmƒõnƒõ odmƒõny:', error);
        showNotification('‚ùå Chyba p≈ôi v√Ωmƒõnƒõ odmƒõny', 'error');
      }
    }

    // Naƒçten√≠ achievement≈Ø
    async function loadAchievements() {
      try {
        const credits = await creditsSystem.getUserCredits(currentUser.uid);
        const achievements = credits?.achievements || [];
        const container = document.getElementById('achievements');
        
        if (achievements.length === 0) {
          container.innerHTML = `
            <div class="text-center py-4 text-white/60 text-sm">
              <i data-lucide="trophy" class="w-6 h-6 mx-auto mb-2 opacity-50"></i>
              Zat√≠m ≈æ√°dn√© achievementy
            </div>
          `;
          return;
        }

        container.innerHTML = achievements.slice(-3).map(achievement => `
          <div class="achievement-card p-3 rounded-xl">
            <div class="flex items-center gap-3">
              <div class="text-2xl">${achievement.icon}</div>
              <div class="flex-1">
                <div class="font-semibold text-sm">${achievement.name}</div>
                <div class="text-xs text-white/60">${achievement.description}</div>
              </div>
              <div class="text-amber-400 font-bold text-sm">+${achievement.credits || 0}</div>
            </div>
          </div>
        `).join('');

      } catch (error) {
        console.error('Chyba naƒç√≠t√°n√≠ achievement≈Ø:', error);
      }
    }

    // Naƒçten√≠ aktivn√≠ch odmƒõn
    async function loadActiveRewards() {
      try {
        const rewards = await creditsSystem.getActiveRewards(currentUser.uid);
        const container = document.getElementById('activeRewards');
        
        if (rewards.length === 0) {
          container.innerHTML = `
            <div class="text-center py-4 text-white/60 text-sm">
              <i data-lucide="gift" class="w-6 h-6 mx-auto mb-2 opacity-50"></i>
              ≈Ω√°dn√© aktivn√≠ odmƒõny
            </div>
          `;
          return;
        }

        container.innerHTML = rewards.map(reward => `
          <div class="p-3 rounded-xl bg-green-500/10 border border-green-500/20">
            <div class="flex items-center justify-between mb-1">
              <div class="font-semibold text-sm">${getRewardName(reward.type)}</div>
              <span class="text-green-400 text-xs">Aktivn√≠</span>
            </div>
            ${reward.expiresAt ? `
              <div class="text-xs text-white/60">
                Vypr≈°√≠: ${new Date(reward.expiresAt).toLocaleDateString('cs-CZ')}
              </div>
            ` : '<div class="text-xs text-white/60">Trval√° odmƒõna</div>'}
          </div>
        `).join('');

      } catch (error) {
        console.error('Chyba naƒç√≠t√°n√≠ aktivn√≠ch odmƒõn:', error);
      }
    }

    function getRewardName(rewardType) {
      const names = {
        BOOST_PROFILE: 'Zv√Ωrazn√Ω profil',
        ANALYTICS_PRO: 'Pokroƒçil√© anal√Ωzy',
        PRIORITY_SUPPORT: 'Prioritn√≠ podpora',
        BADGE_PREMIUM: 'Pr√©miov√Ω odznak'
      };
      return names[rewardType] || rewardType;
    }

    // Naƒçten√≠ posledn√≠ch transakc√≠
    async function loadRecentTransactions() {
      try {
        const transactions = await creditsSystem.getTransactionHistory(currentUser.uid, 10);
        const container = document.getElementById('recentTransactions');
        
        if (transactions.length === 0) {
          container.innerHTML = `
            <div class="text-center py-4 text-white/60 text-sm">
              ≈Ω√°dn√© transakce
            </div>
          `;
          return;
        }

        container.innerHTML = transactions.map(transaction => `
          <div class="p-2 rounded-lg bg-neutral-900/60 border border-white/10">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="text-sm font-medium">${getTransactionDescription(transaction)}</div>
                <div class="text-xs text-white/50">${new Date(transaction.createdAt).toLocaleString('cs-CZ')}</div>
              </div>
              <div class="text-sm font-bold ${transaction.credits > 0 ? 'text-green-400' : 'text-red-400'}">
                ${transaction.credits > 0 ? '+' : ''}${transaction.credits}
              </div>
            </div>
          </div>
        `).join('');

      } catch (error) {
        console.error('Chyba naƒç√≠t√°n√≠ transakc√≠:', error);
      }
    }

    function getTransactionDescription(transaction) {
      if (transaction.type === 'EARNED') {
        return transaction.taskName || 'Z√≠skan√© kredity';
      } else if (transaction.type === 'SPENT') {
        return transaction.reason || 'Utracen√© kredity';
      } else if (transaction.type === 'ACHIEVEMENT') {
        return `üèÜ ${transaction.achievementName}`;
      }
      return transaction.type;
    }

    // Odpoƒçet do reset denn√≠ch √∫kol≈Ø
    function startCountdown() {
      function updateCountdown() {
        const now = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        
        const diff = tomorrow.getTime() - now.getTime();
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('resetCountdown').textContent = 
          `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);
    }

    // Floating ad
    function showRandomFloatingAd() {
      setTimeout(() => {
        if (adsWatchedToday < 5 && Math.random() < 0.3) {
          document.getElementById('floatingAd').style.display = 'block';
          
          setTimeout(() => {
            document.getElementById('floatingAd').style.display = 'none';
          }, 10000);
        }
        
        // Rekurzivn√≠ vol√°n√≠ s n√°hodn√Ωm intervalem
        showRandomFloatingAd();
      }, Math.random() * 60000 + 30000); // 30s - 90s
    }

    function closeFloatingAd() {
      document.getElementById('floatingAd').style.display = 'none';
    }

    function watchFloatingAd() {
      closeFloatingAd();
      showAdModal();
    }

    // Notifikace
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl border max-w-sm ${
        type === 'success' ? 'bg-green-500/10 border-green-500/20 text-green-400' :
        type === 'error' ? 'bg-red-500/10 border-red-500/20 text-red-400' :
        'bg-blue-500/10 border-blue-500/20 text-blue-400'
      }`;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    // Event listenery pro dal≈°√≠ funkce
    document.getElementById('viewAllAchievements')?.addEventListener('click', () => {
      showNotification('üí´ Funkce zobrazen√≠ v≈°ech achievement≈Ø bude brzy p≈ôid√°na!');
    });

    document.getElementById('viewAllTransactions')?.addEventListener('click', () => {
      showNotification('üìã Funkce zobrazen√≠ historie transakc√≠ bude brzy p≈ôid√°na!');
    });

    // Automatick√© p≈ôid√°n√≠ kredit≈Ø za p≈ôihl√°≈°en√≠
    firebase.auth().onAuthStateChanged(async (user) => {
      if (user && creditsSystem) {
        try {
          await creditsSystem.updateTaskProgress(user.uid, 'DAILY_LOGIN');
        } catch (error) {
          console.error('Chyba p≈ôi denn√≠m p≈ôihl√°≈°en√≠:', error);
        }
      }
    });
  </script>
</body>
</html>